root@vultr:~# rmquick-auth-fix.sh
rmquick-auth-fix.sh: command not found
root@vultr:~# rm quick-auth-fix.sh
root@vultr:~# nano quick-auth-fix.sh
root@vultr:~# chmod +x quick-auth-fix.sh
./quick-auth-fix.sh
╔══════════════════════════════════════════════════════════════╗
║                  QUICK AUTH FIX                              ║
╚══════════════════════════════════════════════════════════════╝

📝 Creating server-side auth middleware...
✓ Created auth middleware and routes
📝 Updating routes.ts to use auth middleware...
file:///var/www/url-campaign/update-routes.js:1
const fs = require('fs');
           ^

ReferenceError: require is not defined in ES module scope, you can use import in                                                                             stead
This file is being treated as an ES module because it has a '.js' file extension                                                                              and '/var/www/url-campaign/package.json' contains "type": "module". To treat it                                                                              as a CommonJS script, rename it to use the '.cjs' file extension.
    at file:///var/www/url-campaign/update-routes.js:1:12
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117                                                                             :5)

Node.js v20.19.1
✓ Routes updated with auth middleware
📝 Updating server index.ts to register auth routes...
file:///var/www/url-campaign/update-index.js:1
const fs = require('fs');
           ^

ReferenceError: require is not defined in ES module scope, you can use import in                                                                             stead
This file is being treated as an ES module because it has a '.js' file extension                                                                              and '/var/www/url-campaign/package.json' contains "type": "module". To treat it                                                                              as a CommonJS script, rename it to use the '.cjs' file extension.
    at file:///var/www/url-campaign/update-index.js:1:12
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117                                                                             :5)

Node.js v20.19.1
✓ Server index updated to register auth routes
📝 Adding client-side login page...
✓ Created login page component
📝 Ensuring Login route exists in App.tsx...
file:///var/www/url-campaign/check-app-routes.js:1
const fs = require('fs');
           ^

ReferenceError: require is not defined in ES module scope, you can use import in                                                                             stead
This file is being treated as an ES module because it has a '.js' file extension                                                                              and '/var/www/url-campaign/package.json' contains "type": "module". To treat it                                                                              as a CommonJS script, rename it to use the '.cjs' file extension.
    at file:///var/www/url-campaign/check-app-routes.js:1:12
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117                                                                             :5)

Node.js v20.19.1
✓ Ensured login route exists in App.tsx
📝 Creating simplified auth context file...
✓ Created simplified auth context
📝 Creating ProtectedRoute component...
✓ Created ProtectedRoute component
🔄 Rebuilding and restarting application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bu                                                                             ndle --format=esm --outdir=dist

vite v5.4.14 building for production...
✓ 3 modules transformed.
x Build failed in 511ms
error during build:
[vite:esbuild] Transform failed with 2 errors:
/var/www/url-campaign/client/src/App.tsx:50:2: ERROR: The character "}" is not v                                                                             alid inside a JSX element
/var/www/url-campaign/client/src/App.tsx:54:4: ERROR: Unexpected "return"
file: /var/www/url-campaign/client/src/App.tsx:50:2

The character "}" is not valid inside a JSX element
48 |        </Switch>
49 |      );
50 |    }
   |    ^
51 |
52 |    if (isLoginRoute) {

Unexpected "return"
52 |    if (isLoginRoute) {
53 |      // Login route without navbar or protected route wrapper
54 |      return (
   |      ^
55 |        <Switch>
56 |          <Route path="/login" component={LoginPage} />

    at failureErrorWithLog (/var/www/url-campaign/node_modules/vite/node_modules                                                                             /esbuild/lib/main.js:1472:15)
    at /var/www/url-campaign/node_modules/vite/node_modules/esbuild/lib/main.js:                                                                             755:50
    at responseCallbacks.<computed> (/var/www/url-campaign/node_modules/vite/nod                                                                             e_modules/esbuild/lib/main.js:622:9)
    at handleIncomingPacket (/var/www/url-campaign/node_modules/vite/node_module                                                                             s/esbuild/lib/main.js:677:12)
    at Socket.readFromStdout (/var/www/url-campaign/node_modules/vite/node_modul                                                                             es/esbuild/lib/main.js:600:7)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
    at Readable.push (node:internal/streams/readable:392:5)
    at Pipe.onStreamRead (node:internal/stream_base_commons:191:23)
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [url-campaign](ids: [ 0 ])
[PM2] [url-campaign](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ url-campaign       │ fork     │ 5    │ online    │ 0%       │ 1.4mb    │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
✓ Application rebuilt and restarted
📝 Updating Nginx configuration...
nginx: [warn] conflicting server name "views.yoyoprime.com" on 0.0.0.0:80, ignor                                                                             ed
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
✓ Nginx configuration updated
╔══════════════════════════════════════════════════════════════╗
║                 QUICK AUTH FIX COMPLETE                      ║
╚══════════════════════════════════════════════════════════════╝

✓ Auth middleware created on server
✓ Auth routes registered
✓ Login page added to client
✓ Auth context created
✓ ProtectedRoute component added
✓ Nginx configured for auth

Your login page should now be accessible at:
https://views.yoyoprime.com/login

Use this API key to login: TraffiCS10928

Nginx is also configured to automatically add the API key to requests,
but the login page is now available for direct access.
root@vultr:~#
