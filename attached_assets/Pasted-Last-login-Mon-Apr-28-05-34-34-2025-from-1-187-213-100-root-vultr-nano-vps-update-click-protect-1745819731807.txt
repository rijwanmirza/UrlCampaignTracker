Last login: Mon Apr 28 05:34:34 2025 from 1.187.213.100
root@vultr:~# nano vps-update-click-protection.sh
root@vultr:~# ^C
root@vultr:~# chmod +x vps-update-click-protection.sh
root@vultr:~# nano deploy-frontend-updates.sh
root@vultr:~# ^C
root@vultr:~# chmod +x deploy-frontend-updates.sh
root@vultr:~# chmod +xdeploy-frontend-updates.sh
chmod: missing operand after ‘+xdeploy-frontend-updates.sh’
Try 'chmod --help' for more information.
root@vultr:~# ^C
root@vultr:~# ./vps-update-click-protection.sh^C
root@vultr:~# root@vultr:~# ./vps-update-click-protection.sh^C
^C
root@vultr:~# ^C
root@vultr:~# ./vps-update-click-protection.sh
╔══════════════════════════════════════════════════════════════╗
║       URL CAMPAIGN MANAGER - CLICK PROTECTION UPDATE         ║
╚══════════════════════════════════════════════════════════════╝

📋 PRE-DEPLOYMENT CHECKLIST:
1. Make sure PostgreSQL is running
2. Ensure your application is deployed at /var/www/url-campaign or modify the pa                                                                             ths below
3. Have your database credentials ready

Current configuration:
🔹 Application directory: /var/www/url-campaign
🔹 Database user: postgres
🔹 Database name: postgres
🔹 PM2 app name: url-campaign

Is this configuration correct? (y/n): y
Starting deployment...

📦 Backing up current application...
✓ Backup created at /root/url-campaign-backup-20250428054934

🗃️ Backing up database...
✓ Database backup created at /root/url-campaign-db-20250428054942.sql

🛑 Stopping application...
[PM2] Applying action stopProcessId on app [url-campaign](ids: [ 0 ])
[PM2] [url-campaign](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ url-campaign       │ fork     │ 0    │ stopped   │ 0%       │ 0b       │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
✓ Application stopped

📝 Creating database migration file...
✓ Database migration file created at /var/www/url-campaign/click-protection-migr                                                                             ation.sql

🔄 Applying database migration...
CREATE TABLE
CREATE INDEX
CREATE FUNCTION
NOTICE:  trigger "url_clicks_protection_trigger" for relation "urls" does not ex                                                                             ist, skipping
DROP TRIGGER
CREATE TRIGGER
ERROR:  relation "system_settings" does not exist
LINE 1: INSERT INTO system_settings (key, value, created_at, updated...
                    ^
✓ Database migration applied

📄 Updating server-side click protection code...
🔧 Removing click limit validation...
file:///var/www/url-campaign/fix-click-limit-validation.js:7
const fs = require('fs');
           ^

ReferenceError: require is not defined in ES module scope, you can use import in                                                                             stead
This file is being treated as an ES module because it has a '.js' file extension                                                                              and '/var/www/url-campaign/package.json' contains "type": "module". To treat it                                                                              as a CommonJS script, rename it to use the '.cjs' file extension.
    at file:///var/www/url-campaign/fix-click-limit-validation.js:7:12
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117                                                                             :5)

Node.js v20.19.1
✓ Validator fix applied

📄 Adding original URL record sync functionality...
🔧 Adding original URL record sync functionality...
file:///var/www/url-campaign/fix-storage-sync.js:7
const fs = require('fs');
           ^

ReferenceError: require is not defined in ES module scope, you can use import in                                                                             stead
This file is being treated as an ES module because it has a '.js' file extension                                                                              and '/var/www/url-campaign/package.json' contains "type": "module". To treat it                                                                              as a CommonJS script, rename it to use the '.cjs' file extension.
    at file:///var/www/url-campaign/fix-storage-sync.js:7:12
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117                                                                             :5)

Node.js v20.19.1
✓ Storage fix applied

📄 Adding Original URL Records routes...
🔧 Adding Original URL Records routes...
file:///var/www/url-campaign/fix-routes-original-records.js:7
const fs = require('fs');
           ^

ReferenceError: require is not defined in ES module scope, you can use import in                                                                             stead
This file is being treated as an ES module because it has a '.js' file extension                                                                              and '/var/www/url-campaign/package.json' contains "type": "module". To treat it                                                                              as a CommonJS script, rename it to use the '.cjs' file extension.
    at file:///var/www/url-campaign/fix-routes-original-records.js:7:12
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117                                                                             :5)

Node.js v20.19.1
✓ Routes fix applied

📊 Creating original URL records table...
NOTICE:  relation "original_url_records" already exists, skipping
CREATE TABLE
NOTICE:  relation "original_url_records_name_idx" already exists, skipping
CREATE INDEX
✓ Original URL records table created/updated

🛡️ Applying click protection trigger...
CREATE FUNCTION
DROP TRIGGER
CREATE TRIGGER
ERROR:  relation "system_settings" does not exist
LINE 1: INSERT INTO system_settings (key, value, created_at, updated...
                    ^
✓ Click protection trigger applied

🚀 Starting application...
[PM2] Applying action restartProcessId on app [url-campaign](ids: [ 0 ])
[PM2] [url-campaign](0) ✓
[PM2] Process successfully started
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ url-campaign       │ fork     │ 0    │ online    │ 0%       │ 3.5mb    │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
✓ Application started

💾 Saving PM2 startup configuration...
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
✓ PM2 configuration saved

╔══════════════════════════════════════════════════════════════╗
║                DEPLOYMENT COMPLETED SUCCESSFULLY             ║
╚══════════════════════════════════════════════════════════════╝

The URL Campaign Manager has been updated with:
✓ Click protection to prevent automatic click quantity changes
✓ Original URL Records feature for master URL data management
✓ Unlimited click quantity validation (limits removed)

To verify the changes:
1. Visit your application URL
2. Navigate to the 'Original URL Records' section
3. Create a record with a high click limit
4. Use the sync function to update campaign URLs

If you encounter any issues:
1. Check PM2 logs: pm2 logs url-campaign
2. Restore backup if needed: cp -r /root/url-campaign-backup-20250428054934/* /v                                                                             ar/www/url-campaign/
3. Restore database: sudo -u postgres psql postgres < /root/url-campaign-db-2025                                                                             0428054942.sql

Backup files:
- Application: /root/url-campaign-backup-20250428054934
- Database: /root/url-campaign-db-20250428054942.sql

root@vultr:~# ./deploy-frontend-updates.sh
╔══════════════════════════════════════════════════════════════╗
║             FRONTEND UPDATES FOR CLICK PROTECTION            ║
╚══════════════════════════════════════════════════════════════╝

📝 Creating Original URL Records frontend page...
✓ Original URL Records page component created
📝 Updating App.tsx to add the new route...
✓ App.tsx updated with new route
⚠️ Navigation component not found at /var/www/url-campaign/client/src/components/                                                                             navigation.tsx
⚠️ You will need to manually add a link to /original-url-records in your navigati                                                                             on
🔄 Rebuilding frontend...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bu                                                                             ndle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (7) src/lib/queryClient.tsBrowserslist: browsers data (caniuse-lite                                                                             ) is 6 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#read                                                                             me
✓ 2225 modules transformed.
../dist/public/index.html                   2.02 kB │ gzip:   0.86 kB
../dist/public/assets/index-VrTeNYwy.css   66.77 kB │ gzip:  11.58 kB
../dist/public/assets/index-n2wHv7gs.js   711.02 kB │ gzip: 207.21 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollu                                                                             pjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 15.84s
▲ [WARNING] Duplicate member "spentValuePausedCampaigns" in class body [duplicat                                                                             e-class-member]

    server/trafficstar-service.ts:1507:10:
      1507 │   private spentValuePausedCampaigns: Map<number, { pausedAt: Dat...
           ╵           ~~~~~~~~~~~~~~~~~~~~~~~~~

  The original member "spentValuePausedCampaigns" is here:

    server/trafficstar-service.ts:76:10:
      76 │   private spentValuePausedCampaigns: Map<number, {
         ╵           ~~~~~~~~~~~~~~~~~~~~~~~~~

▲ [WARNING] Duplicate member "budgetAdjustedCampaigns" in class body [duplicate-                                                                             class-member]

    server/trafficstar-service.ts:1514:10:
      1514 │   private budgetAdjustedCampaigns: Map<number, string> = new Map();
           ╵           ~~~~~~~~~~~~~~~~~~~~~~~

  The original member "budgetAdjustedCampaigns" is here:

    server/trafficstar-service.ts:72:10:
      72 │   private budgetAdjustedCampaigns: Map<number, string> = new Map();
         ╵           ~~~~~~~~~~~~~~~~~~~~~~~

2 warnings

  dist/index.js  242.4kb

⚡ Done in 50ms
✓ Frontend rebuilt
🚀 Restarting application...
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [url-campaign](ids: [ 0 ])
[PM2] [url-campaign](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ url-campaign       │ fork     │ 1    │ online    │ 0%       │ 1.4mb    │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
✓ Application restarted
╔══════════════════════════════════════════════════════════════╗
║               FRONTEND DEPLOYMENT COMPLETE                   ║
╚══════════════════════════════════════════════════════════════╝

✓ Original URL Records page has been added to your application
✓ You can now access it at: http://your-domain/original-url-records

If you encounter any issues:
1. Check the browser console for JavaScript errors
2. Restore the backup files if needed:
   - cp /var/www/url-campaign/client/src/App.tsx.bak /var/www/url-campaign/clien                                                                             t/src/App.tsx
3. Rebuild and restart: npm run build && pm2 restart url-campaign
