root@d026e9724:/var/www/urlapp# nano fix-connection-refused.sh
root@d026e9724:/var/www/urlapp# chmod +x fix-connection-refused.sh
./fix-connection-refused.sh
🔍 Diagnosing connection refused issue...
📡 Checking if application is listening on port 3000...
Listening status:
❌ No process is listening on port 3000. Restarting application...
🔄 Checking PM2 status...
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 3  │ urlapp           │ default     │ N/A     │ fork    │ 0        │ 0      │ 68   │ errored   │ 0%       │ 0b       │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
Module
┌────┬──────────────────────────────┬───────────────┬──────────┬──────────┬──────┬──────────┬──────────┬──────────┐
│ id │ module                       │ version       │ pid      │ status   │ ↺    │ cpu      │ mem      │ user     │
├────┼──────────────────────────────┼───────────────┼──────────┼──────────┼──────┼──────────┼──────────┼──────────┤
│ 1  │ pm2-logrotate                │ 2.7.0         │ 22531    │ online   │ 2    │ 0%       │ 63.1mb   │ root     │
└────┴──────────────────────────────┴───────────────┴──────────┴──────────┴──────┴──────────┴──────────┴──────────┘
🔄 Restarting application...
[PM2] Applying action stopProcessId on app [urlapp](ids: [ 3 ])
[PM2] [urlapp](3) ✓
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 3  │ urlapp           │ default     │ N/A     │ fork    │ 0        │ 0      │ 68   │ stopped   │ 0%       │ 0b       │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
Module
┌────┬──────────────────────────────┬───────────────┬──────────┬──────────┬──────┬──────────┬──────────┬──────────┐
│ id │ module                       │ version       │ pid      │ status   │ ↺    │ cpu      │ mem      │ user     │
├────┼──────────────────────────────┼───────────────┼──────────┼──────────┼──────┼──────────┼──────────┼──────────┤
│ 1  │ pm2-logrotate                │ 2.7.0         │ 22531    │ online   │ 2    │ 0%       │ 63.1mb   │ root     │
└────┴──────────────────────────────┴───────────────┴──────────┴──────────┴──────┴──────────┴──────────┴──────────┘
[PM2] Starting /var/www/urlapp/dist/index.js in fork_mode (1 instance)
[PM2] Done.
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 3  │ urlapp           │ default     │ N/A     │ fork    │ 0        │ 0      │ 68   │ stopped   │ 0%       │ 0b       │ root     │ disabled │
│ 4  │ urlapp           │ default     │ 1.0.0   │ fork    │ 43472    │ 0s     │ 0    │ online    │ 0%       │ 18.3mb   │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
Module
┌────┬──────────────────────────────┬───────────────┬──────────┬──────────┬──────┬──────────┬──────────┬──────────┐
│ id │ module                       │ version       │ pid      │ status   │ ↺    │ cpu      │ mem      │ user     │
├────┼──────────────────────────────┼───────────────┼──────────┼──────────┼──────┼──────────┼──────────┼──────────┤
│ 1  │ pm2-logrotate                │ 2.7.0         │ 22531    │ online   │ 2    │ 0%       │ 63.1mb   │ root     │
└────┴──────────────────────────────┴───────────────┴──────────┴──────────┴──────┴──────────┴──────────┴──────────┘
Listening status after restart:
❌ Application still not listening. Trying manual start...
🔄 Starting application manually...
file:///var/www/urlapp/dist/index.js:646
      throw new Error(
            ^

Error: DATABASE_URL must be set. Did you forget to provision a database?
    at server/db.ts (file:///var/www/urlapp/dist/index.js:646:13)
    at __init (file:///var/www/urlapp/dist/index.js:4:56)
    at file:///var/www/urlapp/dist/index.js:4916:1
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)

Node.js v20.19.1
Listening status after manual start:
❌ Manual start failed. Checking logs...
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)

Node.js v20.19.1
file:///var/www/urlapp/dist/index.js:646
      throw new Error(
            ^

Error: DATABASE_URL must be set. Did you forget to provision a database?
    at server/db.ts (file:///var/www/urlapp/dist/index.js:646:13)
    at __init (file:///var/www/urlapp/dist/index.js:4:56)
    at file:///var/www/urlapp/dist/index.js:4916:1
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)

Node.js v20.19.1
file:///var/www/urlapp/dist/index.js:646
      throw new Error(
            ^

Error: DATABASE_URL must be set. Did you forget to provision a database?
    at server/db.ts (file:///var/www/urlapp/dist/index.js:646:13)
    at __init (file:///var/www/urlapp/dist/index.js:4:56)
    at file:///var/www/urlapp/dist/index.js:4916:1
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)

Node.js v20.19.1
file:///var/www/urlapp/dist/index.js:646
      throw new Error(
            ^

Error: DATABASE_URL must be set. Did you forget to provision a database?
    at server/db.ts (file:///var/www/urlapp/dist/index.js:646:13)
    at __init (file:///var/www/urlapp/dist/index.js:4:56)
    at file:///var/www/urlapp/dist/index.js:4916:1
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)

Node.js v20.19.1
file:///var/www/urlapp/dist/index.js:646
      throw new Error(
            ^

Error: DATABASE_URL must be set. Did you forget to provision a database?
    at server/db.ts (file:///var/www/urlapp/dist/index.js:646:13)
    at __init (file:///var/www/urlapp/dist/index.js:4:56)
    at file:///var/www/urlapp/dist/index.js:4916:1
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)

Node.js v20.19.1
file:///var/www/urlapp/dist/index.js:646
      throw new Error(
            ^

Error: DATABASE_URL must be set. Did you forget to provision a database?
    at server/db.ts (file:///var/www/urlapp/dist/index.js:646:13)
    at __init (file:///var/www/urlapp/dist/index.js:4:56)
    at file:///var/www/urlapp/dist/index.js:4916:1
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)

Node.js v20.19.1
file:///var/www/urlapp/dist/index.js:646
      throw new Error(
            ^

Error: DATABASE_URL must be set. Did you forget to provision a database?
    at server/db.ts (file:///var/www/urlapp/dist/index.js:646:13)
    at __init (file:///var/www/urlapp/dist/index.js:4:56)
    at file:///var/www/urlapp/dist/index.js:4916:1
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)

Node.js v20.19.1
file:///var/www/urlapp/dist/index.js:646
      throw new Error(
            ^

Error: DATABASE_URL must be set. Did you forget to provision a database?
    at server/db.ts (file:///var/www/urlapp/dist/index.js:646:13)
    at __init (file:///var/www/urlapp/dist/index.js:4:56)
    at file:///var/www/urlapp/dist/index.js:4916:1
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)

Node.js v20.19.1
Error: DATABASE_URL must be set. Did you forget to provision a database?
    at server/db.ts (file:///var/www/urlapp/dist/index.js:646:13)
    at __init (file:///var/www/urlapp/dist/index.js:4:56)
    at file:///var/www/urlapp/dist/index.js:4916:1
    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
🔄 Trying to connect to application locally...
Local connection result: 000
❌ Cannot connect locally. Checking for issues in the application...
🔄 Checking localhost firewall rules...
🔄 Checking application binding address in index.ts...
85:app.listen(PORT, '0.0.0.0', () => {
🔄 Updating application to bind to both 0.0.0.0 and localhost...
🔄 Starting the fixed application...
[PM2] Applying action stopProcessId on app [urlapp](ids: [ 3, 4 ])
[PM2] [urlapp](3) ✓
[PM2] [urlapp](4) ✓
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 3  │ urlapp           │ default     │ N/A     │ fork    │ 0        │ 0      │ 68   │ stopped   │ 0%       │ 0b       │ root     │ disabled │
│ 4  │ urlapp           │ default     │ 1.0.0   │ fork    │ 0        │ 0      │ 0    │ stopped   │ 0%       │ 0b       │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
Module
┌────┬──────────────────────────────┬───────────────┬──────────┬──────────┬──────┬──────────┬──────────┬──────────┐
│ id │ module                       │ version       │ pid      │ status   │ ↺    │ cpu      │ mem      │ user     │
├────┼──────────────────────────────┼───────────────┼──────────┼──────────┼──────┼──────────┼──────────┼──────────┤
│ 1  │ pm2-logrotate                │ 2.7.0         │ 22531    │ online   │ 2    │ 0%       │ 63.0mb   │ root     │
└────┴──────────────────────────────┴───────────────┴──────────┴──────────┴──────┴──────────┴──────────┴──────────┘
[PM2] Starting /var/www/urlapp/dist/index-fixed.js in fork_mode (1 instance)
[PM2] Done.
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 3  │ urlapp           │ default     │ N/A     │ fork    │ 0        │ 0      │ 68   │ stopped   │ 0%       │ 0b       │ root     │ disabled │
│ 4  │ urlapp           │ default     │ 1.0.0   │ fork    │ 0        │ 0      │ 0    │ stopped   │ 0%       │ 0b       │ root     │ disabled │
│ 5  │ urlapp           │ default     │ 1.0.0   │ fork    │ 43541    │ 0s     │ 0    │ online    │ 0%       │ 45.3mb   │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
Module
┌────┬──────────────────────────────┬───────────────┬──────────┬──────────┬──────┬──────────┬──────────┬──────────┐
│ id │ module                       │ version       │ pid      │ status   │ ↺    │ cpu      │ mem      │ user     │
├────┼──────────────────────────────┼───────────────┼──────────┼──────────┼──────┼──────────┼──────────┼──────────┤
│ 1  │ pm2-logrotate                │ 2.7.0         │ 22531    │ online   │ 2    │ 0%       │ 63.0mb   │ root     │
└────┴──────────────────────────────┴───────────────┴──────────┴──────────┴──────┴──────────┴──────────┴──────────┘
Final local connection result: 000
🔄 Checking Nginx configuration...
2025/05/09 21:50:50 [warn] 43569#43569: conflicting server name "viralplayer.xyz" on 0.0.0.0:80, ignored
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
✅ All fixes applied. Check if the application is now accessible.
If you're still having issues, try rebooting the server: sudo reboot
root@d026e9724:/var/www/urlapp#
