root@vultr:~# nano fix-database-connection.sh
root@vultr:~# chmod +x fix-database-connection.sh
./fix-database-connection.sh
╔══════════════════════════════════════════════════════════════╗
║            DATABASE CONNECTION FIX                           ║
╚══════════════════════════════════════════════════════════════╝

🔍 Checking PostgreSQL status...
localhost:5432 - accepting connections
✓ PostgreSQL is running and accessible
📦 Creating database backup...
✓ Database backup created at /root/url-campaign-db-fix-20250428071811/database-backup.sql
🔍 Testing database connection and tables...
🔒 Setting up click protection trigger...
NOTICE:  trigger "prevent_click_limit_update" for relation "urls" does not exist, skipping
CREATE FUNCTION
DROP TRIGGER
CREATE TRIGGER
✓ Click protection trigger setup complete
🛑 Stopping the application...
[PM2] Applying action stopProcessId on app [url-campaign](ids: [ 0 ])
[PM2] [url-campaign](0) ✓
┌────┬─────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name            │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼─────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ url-campaign    │ default     │ 1.0.0   │ fork    │ 0        │ 0      │ 0    │ stopped   │ 0%       │ 0b       │ root     │ disabled │
└────┴─────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
✓ Application stopped
📝 Setting up environment variables...
✓ Environment variables configured
📝 Creating enhanced start script...
✓ Enhanced start script created
📝 Creating CommonJS ecosystem file...
✓ CommonJS ecosystem file created
🚀 Starting the application...
[PM2] Applying action restartProcessId on app [url-campaign](ids: [ 0 ])
[PM2] [url-campaign](0) ✓
┌────┬─────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name            │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼─────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ url-campaign    │ default     │ 1.0.0   │ fork    │ 5361     │ 0s     │ 0    │ online    │ 0%       │ 3.5mb    │ root     │ disabled │
└────┴─────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
✓ Application started with PM2
╔══════════════════════════════════════════════════════════════╗
║                 DATABASE FIX COMPLETE                        ║
╚══════════════════════════════════════════════════════════════╝

✓ PostgreSQL connection verified
✓ Database tables and schema fixed
✓ Click protection trigger installed
✓ Environment variables configured
✓ Application restarted with proper database connection

Your site should now be working properly at: https://views.yoyoprime.com

If you still encounter issues:
1. Check database connection with: sudo -u postgres psql -c 'SELECT version();'
2. Check application logs: pm2 logs url-campaign
3. Check tables existence: sudo -u postgres psql -c '\dt'
root@vultr:~#
