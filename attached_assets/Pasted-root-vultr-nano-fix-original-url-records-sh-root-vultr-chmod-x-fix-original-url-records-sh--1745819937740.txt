root@vultr:~# nano fix-original-url-records.sh
root@vultr:~# chmod +x fix-original-url-records.sh
root@vultr:~# ./fix-original-url-records.sh
╔══════════════════════════════════════════════════════════════╗
║             FIXING ORIGINAL URL RECORDS PAGE                 ║
╚══════════════════════════════════════════════════════════════╝

📦 Creating backup before fixes...
✓ Backup created at /root/url-campaign-fix-backup-20250428055757

🔧 Creating missing system_settings table...
CREATE TABLE
INSERT 0 1
INSERT 0 1
✓ system_settings table created

📝 Creating module-compatible navigation fix script...
🔧 Fixing navigation menu...
/var/www/url-campaign/fix-navigation.cjs:171
  const appTsxPath = path.join(appDir, 'client/src/App.tsx');
        ^

SyntaxError: Identifier 'appTsxPath' has already been declared
    at wrapSafe (node:internal/modules/cjs/loader:1472:18)
    at Module._compile (node:internal/modules/cjs/loader:1501:20)
    at Module._extensions..js (node:internal/modules/cjs/loader:1613:10)
    at Module.load (node:internal/modules/cjs/loader:1275:32)
    at Module._load (node:internal/modules/cjs/loader:1096:12)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_ma                                                                             in:164:12)
    at node:internal/main/run_main_module:28:49

Node.js v20.19.1
✓ Navigation fix applied

📝 Ensuring Original URL Records page is correctly created...
✓ Original URL Records page component exists
🔧 Ensuring App.tsx has the Original URL Records route...
Adding import for OriginalUrlRecordsPage...
✓ Ensured App.tsx has the correct route

🔧 Adding Original URL Records API routes...
Found routes file at /var/www/url-campaign/server/routes.ts
Adding Original URL Records API routes...
Created routes file at /var/www/url-campaign/add-original-url-routes.js
You'll need to manually add these routes to /var/www/url-campaign/server/routes.                                                                             ts
The new routes begin with app.get('/api/original-url-records',...
Attempting to add routes automatically...
Found insertion point at line 80
sed: -e expression #1, char 13: extra characters after command
✓ Added Original URL Records API routes to /var/www/url-campaign/server/routes.t                                                                             s
🚀 Rebuilding and restarting application...

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bu                                                                             ndle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming (18) ../node_modules/react/jsx-runtime.jsBrowserslist: browsers dat                                                                             a (caniuse-lite) is 6 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#read                                                                             me
✓ 2227 modules transformed.
../dist/public/index.html                   2.02 kB │ gzip:   0.86 kB
../dist/public/assets/index-VrTeNYwy.css   66.77 kB │ gzip:  11.58 kB
../dist/public/assets/index-CLgBaKhD.js   724.50 kB │ gzip: 209.80 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 15.86s
▲ [WARNING] Duplicate member "spentValuePausedCampaigns" in class body [duplicate-class-member]

    server/trafficstar-service.ts:1507:10:
      1507 │   private spentValuePausedCampaigns: Map<number, { pausedAt: Date, recheckAt: Date, disabledThresholdForDate: string }> = new Map();
           ╵           ~~~~~~~~~~~~~~~~~~~~~~~~~

  The original member "spentValuePausedCampaigns" is here:

    server/trafficstar-service.ts:76:10:
      76 │   private spentValuePausedCampaigns: Map<number, {
         ╵           ~~~~~~~~~~~~~~~~~~~~~~~~~

▲ [WARNING] Duplicate member "budgetAdjustedCampaigns" in class body [duplicate-class-member]

    server/trafficstar-service.ts:1514:10:
      1514 │   private budgetAdjustedCampaigns: Map<number, string> = new Map();
           ╵           ~~~~~~~~~~~~~~~~~~~~~~~

  The original member "budgetAdjustedCampaigns" is here:

    server/trafficstar-service.ts:72:10:
      72 │   private budgetAdjustedCampaigns: Map<number, string> = new Map();
         ╵           ~~~~~~~~~~~~~~~~~~~~~~~

2 warnings

  dist/index.js  242.4kb

⚡ Done in 57ms
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [url-campaign](ids: [ 0 ])
[PM2] [url-campaign](0) ✓
┌────┬─────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name            │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼─────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ url-campaign    │ default     │ 1.0.0   │ fork    │ 1777     │ 0s     │ 2    │ online    │ 0%       │ 1.4mb    │ root     │ disabled │
└────┴─────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
✓ Application rebuilt and restarted

╔══════════════════════════════════════════════════════════════╗
║                     FIX COMPLETED                            ║
╚══════════════════════════════════════════════════════════════╝

✓ The Original URL Records feature should now be fully functional
✓ You can access it at: https://views.yoyoprime.com/original-url-records

If you still encounter any issues:
1. Check PM2 logs: pm2 logs url-campaign
2. Check server errors: sudo -u postgres psql postgres -c "SELECT * FROM system_settings;"
3. Verify the URL Records table: sudo -u postgres psql postgres -c "SELECT * FROM original_url_records LIMIT 5;"
4. Check if trigger exists: sudo -u postgres psql postgres -c "SELECT * FROM pg_trigger WHERE tgname = 'url_clicks_protection_trigger';"

Backup of your application is available at: /root/url-campaign-fix-backup-20250428055757

root@vultr:~#
