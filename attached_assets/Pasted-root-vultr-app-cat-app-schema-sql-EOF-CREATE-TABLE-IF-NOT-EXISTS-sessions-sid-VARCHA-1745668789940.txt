root@vultr:/app# cat > /app/schema.sql << 'EOF'
CREATE TABLE IF NOT EXISTS sessions (
  sid VARCHAR(255) PRIMARY KEY,
  sess JSONB NOT NULL,
  expire TIMESTAMP NOT NULL
);

CREATE INDEX IF NOT EXISTS IDX_session_expire ON sessions (expire);

CREATE TABLE IF NOT EXISTS users (
  id VARCHAR(255) PRIMARY KEY NOT NULL,
  username VARCHAR(255) UNIQUE NOT NULL,
  email VARCHAR(255) UNIQUE,
  first_name VARCHAR(255),
  last_name VARCHAR(255),
  bio TEXT,
  profile_image_url VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Add any other tables your application needs here
EOF

# Run the SQL script
PGPASSWORD=postgres psql -U postgres -h localhost -d postgres -f /app/schema.sql
CREATE TABLE
CREATE INDEX
CREATE TABLE
root@vultr:/app# pm2 logs url-manager
[TAILING] Tailing last 15 lines for [url-manager] process (change the value with --lines option)
/root/.pm2/logs/url-manager-error.log last 15 lines:
/root/.pm2/logs/url-manager-out.log last 15 lines:
0|url-mana |
0|url-mana | ğŸ” DEBUG: Loaded saved config with autoDeleteMinutes: 60
0|url-mana | ğŸ” DEBUG: Gmail reader initialized with autoDeleteMinutes: 60
0|url-mana | 11:46:03 AM [gmail-reader] Loaded 0 previously processed email IDs
0|url-mana | 11:46:04 AM [express] serving on port 5000
0|url-mana | 11:46:04 AM [startup] Error auto-configuring integrations: [object Object]
0|url-mana |
0|url-mana | > rest-express@1.0.0 dev
0|url-mana | > NODE_ENV=development tsx server/index.ts
0|url-mana |
0|url-mana | ğŸ” DEBUG: Loaded saved config with autoDeleteMinutes: 60
0|url-mana | ğŸ” DEBUG: Gmail reader initialized with autoDeleteMinutes: 60
0|url-mana | 11:54:46 AM [gmail-reader] Loaded 0 previously processed email IDs
0|url-mana | 11:54:46 AM [express] serving on port 5000
0|url-mana | 11:54:46 AM [startup] Error auto-configuring integrations: [object Object]

^C
root@vultr:/app# cat > /app/gmail_config.json << 'EOF'
{
  "user": "your_gmail@gmail.com",
  "password": "your_app_password",
  "host": "imap.gmail.com",
  "port": 993,
  "tls": true,
  "tlsOptions": {
    "rejectUnauthorized": false
  },
  "whitelistSenders": ["sender@example.com"],
  "subjectPattern": "New Order",
  "messagePattern": {
    "orderIdRegex": "Order ID: ([A-Z0-9]+)",
    "urlRegex": "URL: (https?:\\/\\/[^\\s]+)",
    "quantityRegex": "Quantity: (\\d+)"
  },
  "defaultCampaignId": 1,
  "autoDeleteMinutes": 60
}
EOF
root@vultr:/app# cat > /app/gmail_credentials.json << 'EOF'
{
  "installed": {
    "client_id": "",
    "project_id": "",
    "auth_uri": "https://accounts.google.com/o/oauth2/auth",
    "token_uri": "https://oauth2.googleapis.com/token",
    "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
    "client_secret": "",
    "redirect_uris": ["urn:ietf:wg:oauth:2.0:oob", "http://localhost"]
  }
}
EOF

cat > /app/gmail_token.json << 'EOF'
{}
EOF

# Create empty log file
touch /app/processed_emails.log
chmod 666 /app/processed_emails.log
root@vultr:/app# cat > /app/gmail_credentials.json << 'EOF'
{
  "installed": {
    "client_id": "",
    "project_id": "",
    "auth_uri": "https://accounts.google.com/o/oauth2/auth",
    "token_uri": "https://oauth2.googleapis.com/token",
    "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
    "client_secret": "",
    "redirect_uris": ["urn:ietf:wg:oauth:2.0:oob", "http://localhost"]
  }
}
EOF
cat > /app/gmail_token.json << 'EOF'
{}
EOF
root@vultr:/app# touch /app/processed_emails.log
chmod 666 /app/processed_emails.log
root@vultr:/app# cat > /etc/nginx/sites-available/url-manager << 'EOF'
server {
    listen 80;
    listen [::]:80;
    server_name _;
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    # For handling WebSockets properly
    location /ws {
        proxy_pass http://127.0.0.1:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
EOF
root@vultr:/app# ln -sf /etc/nginx/sites-available/url-manager /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default
root@vultr:/app# nginx -t
systemctl restart nginx
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
root@vultr:/app# pm2 restart url-manager
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [url-manager](ids: [ 0 ])
[PM2] [url-manager](0) âœ“
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name           â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ url-manager    â”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 19656    â”‚ 0s     â”‚ 1    â”‚ online    â”‚ 0%       â”‚ 4.0kb    â”‚ root     â”‚ disabled â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
root@vultr:/app# pm2 restart url-manager
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [url-manager](ids: [ 0 ])
[PM2] [url-manager](0) âœ“
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name           â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚ uptime â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ url-manager    â”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 19717    â”‚ 0s     â”‚ 2    â”‚ online    â”‚ 0%       â”‚ 4.0kb    â”‚ root     â”‚ disabled â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
root@vultr:/app# pm2 logs url-manager
[TAILING] Tailing last 15 lines for [url-manager] process (change the value with --lines option)
/root/.pm2/logs/url-manager-error.log last 15 lines:
/root/.pm2/logs/url-manager-out.log last 15 lines:
0|url-mana |
0|url-mana | ğŸ” DEBUG: Loaded saved config with autoDeleteMinutes: 60
0|url-mana | ğŸ” DEBUG: Gmail reader initialized with autoDeleteMinutes: 60
0|url-mana | 11:59:08 AM [gmail-reader] Loaded 0 previously processed email IDs
0|url-mana | 11:59:08 AM [express] serving on port 5000
0|url-mana | 11:59:08 AM [startup] Error auto-configuring integrations: [object Object]
0|url-mana |
0|url-mana | > rest-express@1.0.0 dev
0|url-mana | > NODE_ENV=development tsx server/index.ts
0|url-mana |
0|url-mana | ğŸ” DEBUG: Loaded saved config with autoDeleteMinutes: 60
0|url-mana | ğŸ” DEBUG: Gmail reader initialized with autoDeleteMinutes: 60
0|url-mana | 11:59:17 AM [gmail-reader] Loaded 0 previously processed email IDs
0|url-mana | 11:59:17 AM [express] serving on port 5000
0|url-mana | 11:59:17 AM [startup] Error auto-configuring integrations: [object Object]


