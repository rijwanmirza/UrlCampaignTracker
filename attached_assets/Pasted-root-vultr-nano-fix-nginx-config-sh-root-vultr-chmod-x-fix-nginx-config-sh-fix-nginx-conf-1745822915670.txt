root@vultr:~# nano fix-nginx-config.sh
root@vultr:~# chmod +x fix-nginx-config.sh
./fix-nginx-config.sh
╔══════════════════════════════════════════════════════════════╗
║          FIX NGINX CONFIGURATION FOR 502 ERROR               ║
╚══════════════════════════════════════════════════════════════╝

📋 Checking Nginx service status...
     Active: active (running) since Mon 2025-04-28 06:25:21 UTC; 22min ago
✓ Nginx service status checked
📋 Verifying application status with PM2...
│ 0  │ url-campaign    │ default     │ 1.0.0   │ fork    │ 2697     │ 20m    │ 0                                                                                 │ online    │ 0%       │ 48.5mb   │ root     │ disabled │
✓ Application status verified
🔌 Checking ports that are listening...
LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    users:(("nginx",pid=26                                                                             10,fd=6),("nginx",pid=2609,fd=6))
LISTEN 0      511          0.0.0.0:443       0.0.0.0:*    users:(("nginx",pid=26                                                                             10,fd=7),("nginx",pid=2609,fd=7))
LISTEN 0      511             [::]:80           [::]:*    users:(("nginx",pid=26                                                                             10,fd=9),("nginx",pid=2609,fd=9))
LISTEN 0      511             [::]:443          [::]:*    users:(("nginx",pid=26                                                                             10,fd=8),("nginx",pid=2609,fd=8))
✓ Listening ports checked
🔌 Checking if port 5000 is being used...
./fix-nginx-config.sh: line 53: netstat: command not found
⚠️ Port 5000 is not being used by any process
Found process ID: 2697
./fix-nginx-config.sh: line 61: netstat: command not found
Process is not listening on any ports
📝 Creating fresh Nginx configuration...
Using default port 5000
Using Nginx configuration file: /etc/nginx/sites-available/default
✓ Backed up existing Nginx configuration
✓ Created fresh Nginx configuration and error pages
🔍 Validating Nginx configuration...
nginx: [warn] conflicting server name "views.yoyoprime.com" on 0.0.0.0:80, ignor                                                                             ed
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
✓ Nginx configuration is valid
🔄 Restarting Nginx...
✓ Nginx restarted successfully
📝 Creating test script to check Node.js application directly...
✓ Created test script at /tmp/test-app.sh
You can run this script to test connections:
/tmp/test-app.sh
🔍 Checking if the application is serving content...
⚠️ Application is not responding directly
Checking process status...
✓ Process is still running
╔══════════════════════════════════════════════════════════════╗
║                  NGINX FIX COMPLETED                         ║
╚══════════════════════════════════════════════════════════════╝

✓ A completely fresh Nginx configuration has been created
✓ Custom error pages have been set up

Your site should now be accessible at: https://views.yoyoprime.com

If you still encounter issues:
1. Check the application logs: pm2 logs url-campaign
2. Check Nginx error logs: tail -f /var/log/nginx/error.log
3. Test direct connection: /tmp/test-app.sh

If all else fails, you can restore from backup:
cp -r /root/url-campaign-backup-*/* /var/www/url-campaign/
sudo -u postgres psql postgres < /root/url-campaign-backup-*/database-*.sql
pm2 restart url-campaign
systemctl restart nginx
root@vultr:~#
