root@d026e9724:/var/www/UrlCampaignTracker# # Edit the storage.ts file
nano /var/www/UrlCampaignTracker/server/storage.ts
root@d026e9724:/var/www/UrlCampaignTracker# # First, let's find where the fullSystemCleanup function is and examine it
cd /var/www/UrlCampaignTracker

# Look for the function and see the context
grep -A 20 "fullSystemCleanup" server/storage.ts

# Now add the line before campaigns deletion using sed
# This looks for a line containing "DELETE FROM campaigns" and adds our line before it
sed -i '/DELETE FROM campaigns/i \    await this.pool.query(\'DELETE FROM gmail_campaign_assignments\');\n    console.log(`âœ… SYSTEM RESET: Deleted all Gmail campaign assignments`);' server/storage.ts
  fullSystemCleanup(): Promise<{
    campaignsDeleted: number,
    urlsDeleted: number,
    originalUrlRecordsDeleted: number,
    youtubeUrlRecordsDeleted: number,
    trafficstarCampaignsDeleted: number,
    urlBudgetLogsDeleted: number,
    urlClickRecordsDeleted: number,
    urlClickLogsDeleted: number,
    campaignClickRecordsDeleted: number
  }>;
}

export class DatabaseStorage implements IStorage {
  // Ultra-optimized multi-level caching system for millions of redirects per second

  // Primary weighted distribution cache for campaign URLs
  private campaignUrlsCache: Map<number, {
    lastUpdated: number,
    activeUrls: UrlWithActiveStatus[],
    weightedDistribution: {
--
  async fullSystemCleanup(): Promise<{
    campaignsDeleted: number,
    urlsDeleted: number,
    originalUrlRecordsDeleted: number,
    youtubeUrlRecordsDeleted: number,
    trafficstarCampaignsDeleted: number,
    urlBudgetLogsDeleted: number,
    urlClickRecordsDeleted: number,
    urlClickLogsDeleted: number,
    campaignClickRecordsDeleted: number
  }> {
    try {
      // First, count how many items we'll delete
      const allCampaigns = await this.getCampaigns();
      let totalUrls = 0;

      for (const campaign of allCampaigns) {
        totalUrls += campaign.urls.length;
      }

      // Count original URL records
-bash: syntax error near unexpected token `)'
root@d026e9724:/var/www/UrlCampaignTracker#
