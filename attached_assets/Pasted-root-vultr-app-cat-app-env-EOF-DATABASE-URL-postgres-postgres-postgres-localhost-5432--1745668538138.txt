root@vultr:/app# cat > /app/.env << 'EOF'
DATABASE_URL=postgres://postgres:postgres@localhost:5432/postgres
PGUSER=postgres
PGHOST=localhost
PGDATABASE=postgres
PGPORT=5432
PGPASSWORD=postgres
TRAFFICSTAR_API_KEY=eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjOGJmY2YyZi1lZjJlLTQwZGYtYTg4ZC1kYjQ3NmI4MTFiOGMifQ.eyJpYXQiOjE3NDA5MTI1MTUsImp0aSI6ImNjNWQ2MWVkLTg5NjEtNDA4YS1iYmRhLTNhOTdkYWYwYWM4NCIsImlzcyI6Imh0dHBzOi8vaWQudHJhZmZpY3N0YXJzLmNvbS9yZWFsbXMvdHJhZmZpY3N0YXJzIiwiYXVkIjoiaHR0cHM6Ly9pZC50cmFmZmljc3RhcnMuY29tL3JlYWxtcy90cmFmZmljc3RhcnMiLCJzdWIiOiJmN2RlZTQyMy0zYzY3LTQxYjItODE4My1lZTdmZjBmMTUwOGIiLCJ0eXAiOiJPZmZsaW5lIiwiYXpwIjoiY29yZS1hcGkiLCJzZXNzaW9uX3N0YXRlIjoiYTgyNTM5MmYtZjQ1OS00Yjg5LTkzNmEtZDcyNDcwODVlMDczIiwic2NvcGUiOiJvcGVuaWQgZW1haWwgb2ZmbGluZV9hY2Nlc3MgcHJvZmlsZSIsInNpZCI6ImE4MjUzOTJmLWY0NTktNGI4OS05MzZhLWQ3MjQ3MDg1ZTA3MyJ9.Zw6cuWlQCZcbqHX3jF1VIl6rpyWjN58zW8_s9al0Yl8
NODE_ENV=development
EOF
root@vultr:/app# cat > /app/start.sh << 'EOF'
#!/bin/bash
cd /app
export NODE_ENV=development
export DATABASE_URL=postgres://postgres:postgres@localhost:5432/postgres
export PGUSER=postgres
export PGHOST=localhost
export PGDATABASE=postgres
export PGPORT=5432
export PGPASSWORD=postgres
export TRAFFICSTAR_API_KEY="eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjOGJmY2YyZi1lZjJlLTQwZGYtYTg4ZC1kYjQ3NmI4MTFiOGMifQ.eyJpYXQiOjE3NDA5MTI1MTUsImp0aSI6ImNjNWQ2MWVkLTg5NjEtNDA4YS1iYmRhLTNhOTdkYWYwYWM4NCIsImlzcyI6Imh0dHBzOi8vaWQudHJhZmZpY3N0YXJzLmNvbS9yZWFsbXMvdHJhZmZpY3N0YXJzIiwiYXVkIjoiaHR0cHM6Ly9pZC50cmFmZmljc3RhcnMuY29tL3JlYWxtcy90cmFmZmljc3RhcnMiLCJzdWIiOiJmN2RlZTQyMy0zYzY3LTQxYjItODE4My1lZTdmZjBmMTUwOGIiLCJ0eXAiOiJPZmZsaW5lIiwiYXpwIjoiY29yZS1hcGkiLCJzZXNzaW9uX3N0YXRlIjoiYTgyNTM5MmYtZjQ1OS00Yjg5LTkzNmEtZDcyNDcwODVlMDczIiwic2NvcGUiOiJvcGVuaWQgZW1haWwgb2ZmbGluZV9hY2Nlc3MgcHJvZmlsZSIsInNpZCI6ImE4MjUzOTJmLWY0NTktNGI4OS05MzZhLWQ3MjQ3MDg1ZTA3MyJ9.Zw6cuWlQCZcbqHX3jF1VIl6rpyWjN58zW8_s9al0Yl8"
exec npm run dev
EOF

chmod +x /app/start.sh
root@vultr:/app# sudo -u postgres psql -c "DROP USER IF EXISTS postgres;"
sudo -u postgres psql -c "CREATE USER postgres WITH SUPERUSER PASSWORD 'postgres';"
sudo -u postgres psql -c "CREATE DATABASE postgres OWNER postgres;"
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE postgres TO postgres;"
Password for user postgres:
ERROR:  current user cannot be dropped
Password for user postgres:
psql: error: connection to server on socket "/var/run/postgresql/.s.PGSQL.5432" failed: FATAL:  password authentication failed for user "postgres"
Password for user postgres:
ERROR:  database "postgres" already exists
Password for user postgres:
psql: error: connection to server on socket "/var/run/postgresql/.s.PGSQL.5432" failed: FATAL:  password authentication failed for user "postgres"
root@vultr:/app# pm2 delete url-manager
pm2 start /app/start.sh --name url-manager
pm2 save
[PM2] Applying action deleteProcessId on app [url-manager](ids: [ 0 ])
[PM2] [url-manager](0) ✓
┌────┬───────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name      │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
└────┴───────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
[PM2] Starting /app/start.sh in fork_mode (1 instance)
[PM2] Done.
┌────┬────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name           │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ url-manager    │ default     │ 1.0.0   │ fork    │ 19537    │ 0s     │ 0    │ online    │ 0%       │ 3.4mb    │ root     │ disabled │
└────┴────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
root@vultr:/app# cat > /app/schema.sql << 'EOF'
CREATE TABLE IF NOT EXISTS sessions (
  sid VARCHAR(255) PRIMARY KEY,
  sess JSONB NOT NULL,
  expire TIMESTAMP NOT NULL
);

CREATE INDEX IF NOT EXISTS IDX_session_expire ON sessions (expire);

CREATE TABLE IF NOT EXISTS users (
  id VARCHAR(255) PRIMARY KEY NOT NULL,
  username VARCHAR(255) UNIQUE NOT NULL,
  email VARCHAR(255) UNIQUE,
  first_name VARCHAR(255),
  last_name VARCHAR(255),
  bio TEXT,
  profile_image_url VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Add any other tables your application needs here
EOF

# Run the SQL script
PGPASSWORD=postgres psql -U postgres -h localhost -d postgres -f /app/schema.sql
CREATE TABLE
CREATE INDEX
CREATE TABLE
root@vultr:/app# pm2 logs url-manager
[TAILING] Tailing last 15 lines for [url-manager] process (change the value with --lines option)
/root/.pm2/logs/url-manager-error.log last 15 lines:
/root/.pm2/logs/url-manager-out.log last 15 lines:
0|url-mana |
0|url-mana | 🔍 DEBUG: Loaded saved config with autoDeleteMinutes: 60
0|url-mana | 🔍 DEBUG: Gmail reader initialized with autoDeleteMinutes: 60
0|url-mana | 11:46:03 AM [gmail-reader] Loaded 0 previously processed email IDs
0|url-mana | 11:46:04 AM [express] serving on port 5000
0|url-mana | 11:46:04 AM [startup] Error auto-configuring integrations: [object Object]
0|url-mana |
0|url-mana | > rest-express@1.0.0 dev
0|url-mana | > NODE_ENV=development tsx server/index.ts
0|url-mana |
0|url-mana | 🔍 DEBUG: Loaded saved config with autoDeleteMinutes: 60
0|url-mana | 🔍 DEBUG: Gmail reader initialized with autoDeleteMinutes: 60
0|url-mana | 11:54:46 AM [gmail-reader] Loaded 0 previously processed email IDs
0|url-mana | 11:54:46 AM [express] serving on port 5000
0|url-mana | 11:54:46 AM [startup] Error auto-configuring integrations: [object Object]
