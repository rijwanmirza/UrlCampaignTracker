
> rest-express@1.0.0 dev
URL Budget Manager initializedver/index.ts
TrafficStar API Service initialized
[youtube-api] INFO: YouTube API Service initialized
ğŸ” DEBUG: Loaded saved config with autoDeleteMinutes: 2
ğŸ” DEBUG: Gmail reader initialized with autoDeleteMinutes: 2
10:31:16 AM [gmail-reader] Loaded 0 previously processed email IDs
TrafficStar Reports API test routes registered
Server monitoring initialized - collecting stats every minute
ğŸ”„ Running fix for missing URL click logs...
10:31:16 AM [express] serving on port 5000
10:31:17 AM [access] Access check for path: /
10:31:17 AM [access] Access denied for path: / - no valid session or API key
10:31:18 AM [key-manager] API key manager initialized
10:31:18 AM [express] API key manager initialized successfully
âœ… Fixed 0 URLs with missing click logs
â­ï¸ Skipped 2 URLs with existing log files
ğŸ”„ Auto-fix for missing URL click logs completed: Fixed 0 URLs with missing click logs
10:31:18 AM [access] Access code updated to: b
10:31:18 AM [access-code-manager] Access code manager initialized with code from database
10:31:18 AM [express] Access code manager initialized successfully
ğŸ” Cache miss - fetching fresh URLs for campaign ID: 2
ğŸ” Cache miss - fetching fresh URLs for campaign ID: 1
ğŸ” DEBUG: Updating Gmail config with autoDeleteMinutes: undefined
ğŸ” DEBUG: Updated Gmail config autoDeleteMinutes is now: 2
ğŸ” DEBUG: Saving Gmail config with campaignAssignments: [{"campaignId":1,"minClickLimit":1,"maxClickLimit":1000,"active":true},{"campaignId":2,"minClickLimit":1001,"maxClickLimit":10000000000,"active":true}]
ğŸ” DEBUG: Saved config with autoDeleteMinutes: 2
10:31:19 AM [gmail-reader] SMTP connection verified successfully
10:31:19 AM [gmail-reader] Gmail credentials verified successfully, starting reader...
10:31:19 AM [gmail-reader] ğŸ“§ Starting Gmail reader with auto-delete enabled: 2 minutes
10:31:19 AM [gmail-reader] Gmail reader started successfully and monitoring emails from help@donot-reply.in
ğŸ” DEBUG: Found TrafficStar API key in environment variables, ensuring it is saved in database
[connection] Connected to host
<= '* OK Gimap ready for requests from 34.127.83.21 sy8mb170542794pjb'
=> 'A0 CAPABILITY'
<= '* CAPABILITY IMAP4rev1 UNSELECT IDLE NAMESPACE QUOTA ID XLIST CHILDREN X-GM-EXT-1 XYZZY SASL-IR AUTH=XOAUTH2 AUTH=PLAIN AUTH=PLAIN-CLIENTTOKEN AUTH=OAUTHBEARER'
<= 'A0 OK Thats all she wrote! sy8mb170542794pjb'
=> 'A1 LOGIN "compaignwalabhai@gmail.com" "hciuemplthdkwfho"'
ğŸ” DEBUG: TrafficStar API key already saved in database
Scheduling TrafficStar spent value updates every 30 minutes
Running scheduled update of TrafficStar campaign spent values
TrafficStar spent value updates scheduled successfully
ğŸ” DEBUG: Successfully scheduled TrafficStar spent value updates
10:31:19 AM [express] TrafficStar API initialized successfully
Initializing Traffic Generator scheduler
Running initial traffic generator check on startup
Running Traffic Generator for all enabled campaigns
Traffic Generator scheduler initialized successfully
10:31:19 AM [express] Traffic Generator scheduler initialized successfully
ğŸš€ Initializing independent worker system for traffic management
ğŸš€ Initializing independent workers for traffic management
ğŸš€ Starting independent worker: spent-value-checker
âš¡ Running spent-value-checker worker immediately on startup
ğŸ’° Running independent spent value check
ğŸ” Running independent spent value checks for all campaigns
ğŸš€ Starting independent worker: url-threshold-checker
âš¡ Running url-threshold-checker worker immediately on startup
ğŸ“Š Running independent URL threshold check
ğŸ” Running independent URL threshold checks for all campaigns
ğŸš€ Starting independent worker: empty-url-checker
âš¡ Running empty-url-checker worker immediately on startup
ğŸ” Running independent empty URL check
ğŸ” Running independent empty URL checks for all campaigns
Checking for campaigns with no active URLs to pause TrafficStar campaigns
ğŸš€ Starting independent worker: status-monitor
âš¡ Running status-monitor worker immediately on startup
ğŸ”„ Running independent status monitoring checks
ğŸ” Running independent campaign status monitoring checks
âœ… All independent workers started successfully
âœ… Independent worker system started successfully
10:31:19 AM [express] Independent worker system initialized successfully
10:31:19 AM [express] Budget update scheduler initialized successfully
[youtube-api] INFO: YouTube API checks scheduled with dynamic timing
10:31:19 AM [express] YouTube API service initialized successfully
âŒ Error processing URL threshold checks: TypeError: Cannot convert undefined or null to object
    at Function.entries (<anonymous>)
    at orderSelectedFields (/home/runner/workspace/node_modules/src/utils.ts:77:16)
    at <anonymous> (/home/runner/workspace/node_modules/src/utils.ts:88:19)
    at Array.reduce (<anonymous>)
    at orderSelectedFields (/home/runner/workspace/node_modules/src/utils.ts:77:32)
    at <anonymous> (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:979:23)
    at Object.startActiveSpan (/home/runner/workspace/node_modules/src/tracing.ts:27:11)
    at PgSelectBase._prepare (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:978:17)
    at <anonymous> (/home/runner/workspace/node_modules/src/pg-core/query-builders/select.ts:1009:16)
    at Object.startActiveSpan (/home/runner/workspace/node_modules/src/tracing.ts:27:11)
Updating spent value for campaign 1 (TrafficStar ID: 995224)
Getting spent value for campaign 995224 for date 2025-05-09
Processing 2 campaigns with traffic generator enabled
Processing Traffic Generator for campaign 1
Processing Traffic Generator for campaign 2
Campaign 2 has no TrafficStar ID - skipping
Found 1 campaigns with TrafficStar integration
âŒ Error checking empty URLs for campaign 1: TypeError: Cannot read properties of undefined (reading 'count')
    at processEmptyUrlChecks (/home/runner/workspace/server/independent-processing.ts:532:24)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async IndependentWorker.task (/home/runner/workspace/server/independent-worker-scheduler.ts:64:7)
    at async IndependentWorker.start (/home/runner/workspace/server/independent-worker.ts:38:9)
âœ… No campaigns currently being monitored
Processing Traffic Generator for campaign 1 with TrafficStar ID 995224
Fetching spent value for campaign 995224 on 2025-05-09
Getting campaign 995224 details
[youtube-api] INFO: [youtube-api-scheduler] Campaign 1: Last check: 2025-05-09T10:01:14.005Z, Interval: 30 minutes, Time remaining: 0 minutes
[youtube-api] INFO: [youtube-api-scheduler] Campaign 1: Interval elapsed, processing now
[youtube-api] INFO: Processing YouTube checks for campaign 1
[youtube-api] INFO: Found 35 YouTube URLs to check for campaign 1
[youtube-api] INFO: [YOUTUBE-API] Making request for 35 videos: vpy11yVtMpQ, PyzwgvLNojQ, enycSwZAFaY...
[youtube-api] INFO: [YOUTUBE-API] Response received with 35 videos in 185ms
[youtube-api] INFO: YouTube checks completed for campaign 1
Report API request parameters: campaign_id=995224&date_from=2025-05-09&date_to=2025-05-09&group_by=day&columns=amount
Making direct request to: https://api.trafficstars.com/v1.1/advertiser/custom/report/by-day?campaign_id=995224&date_from=2025-05-09&date_to=2025-05-09&group_by=day&columns=amount
Report API raw response type: object
Parsing report data from TrafficStar API
Report data is an array, using original parser logic
Found report amount: 22.896472 for day 2025-05-09
Campaign 995224 spent value from reports API: $22.8965
Campaign 1 spent value updated to: $22.8965
Finished scheduled update of TrafficStar campaign spent values
<= '* CAPABILITY IMAP4rev1 UNSELECT IDLE NAMESPACE QUOTA ID XLIST CHILDREN X-GM-EXT-1 UIDPLUS COMPRESS=DEFLATE ENABLE MOVE CONDSTORE ESEARCH UTF8=ACCEPT LIST-EXTENDED LIST-STATUS LITERAL- SPECIAL-USE APPENDLIMIT=35651584'
<= 'A1 OK compaignwalabhai@gmail.com authenticated (Success)'
=> 'A2 NAMESPACE'
<= '* NAMESPACE (("" "/")) NIL NIL'
<= 'A2 OK Success'
=> 'A3 LIST "" ""'
Campaign 995224 spent value from campaign object helper: $22.9000
Campaign 1 spent value: $22.9000
Using campaign-specific thresholds for campaign 1: minimum=8000, remaining=20000
ğŸ“Š Using campaign-specific thresholds for campaign 1: Auto-Pause=8000 clicks, Auto-Activate=20000 clicks
TRAFFIC-GENERATOR: Handling campaign 995224 by spent value - current spent: $22.9000
ğŸŸ¢ HIGH SPEND ($22.9000 >= $10.00): Campaign 995224 has spent $10.00 or more
TRAFFIC-GENERATOR: Getting REAL-TIME status for campaign 995224
Getting campaign 995224 details
<= '* LIST (\\Noselect) "/" "/"'
<= 'A3 OK Success'
10:31:20 AM [gmail-reader] IMAP connection established
10:31:20 AM [gmail-reader] Auto-delete enabled: emails will be deleted 2 minutes after processing
10:31:20 AM [gmail-reader] Running email auto-delete check with interval set to 2 minutes
10:31:20 AM [gmail-reader] Current IMAP connection state: authenticated
10:31:20 AM [gmail-reader] Scanning for processed emails older than 2025-05-09T10:29:20.752Z (2 minutes ago)
10:31:20 AM [gmail-reader] No emails found that are successfully processed and older than 2 minutes
=> 'A4 SELECT "INBOX" (CONDSTORE)'
<= '* FLAGS (\\Answered \\Flagged \\Draft \\Deleted \\Seen $NotPhishing $Phishing)'
<= '* OK [PERMANENTFLAGS (\\Answered \\Flagged \\Draft \\Deleted \\Seen $NotPhishing $Phishing \\*)] Flags permitted.'
<= '* OK [UIDVALIDITY 1] UIDs valid.'
<= '* 11 EXISTS'
<= '* 0 RECENT'
<= '* OK [UIDNEXT 14821] Predicted next UID.'
<= '* OK [HIGHESTMODSEQ 10482987]'
<= 'A4 OK [READ-WRITE] INBOX selected. (Success)'
10:31:20 AM [gmail-reader] Searching for ALL messages in inbox - found in mailbox: 11
=> 'A5 UID SEARCH ALL'
<= '* SEARCH 11452 11762 12778 12808 13039 13513 13798 13997 14363 14530 14715'
<= 'A5 OK SEARCH completed (Success)'
10:31:21 AM [gmail-reader] Found 11 emails in mailbox
=> 'A6 UID FETCH 11452,11762,12778,12808,13039,13513,13798,13997,14363,14530,14715 (X-GM-THRID X-GM-MSGID X-GM-LABELS MODSEQ UID FLAGS INTERNALDATE BODY[])'
TRAFFIC-GENERATOR: TrafficStar campaign 995224 REAL status is total_budget_is_reached, active=true
<= '* 1 FETCH (X-GM-THRID 1828079680993441670 X-GM-MSGID 1828079680993441670 X-GM-LABELS ("\\\\Important") UID 11452 MODSEQ (5005983) INTERNALDATE "31-Mar-2025 03:44:00 +0000" FLAGS (\\Seen) BODY[] {31758}'
Campaign 1 price per thousand: $0.1030
Campaign 1 is already in high_spend_budget_updated state - checking for new URLs added after budget calculation
ğŸ” Checking for new URLs added after budget calculation for campaign 1
ğŸ“Š Found 1 campaigns with TrafficStar integration
Campaign 1 budget calculation time: 2025-05-09T10:29:28.190Z
No new URLs found added after budget calculation for campaign 1
Finished running Traffic Generator for all enabled campaigns
ğŸ’² Checking spent value for campaign 1 (TrafficStar ID: 995224)
âŒ Error checking spent value for campaign 1: TypeError: trafficStarService.getSpentValueForCampaign is not a function
    at processSpentValueForCampaign (/home/runner/workspace/server/independent-processing.ts:95:48)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async processSpentValueChecks (/home/runner/workspace/server/independent-processing.ts:53:9)
    at async IndependentWorker.task (/home/runner/workspace/server/independent-worker-scheduler.ts:40:7)
    at async IndependentWorker.start (/home/runner/workspace/server/independent-worker.ts:38:9)