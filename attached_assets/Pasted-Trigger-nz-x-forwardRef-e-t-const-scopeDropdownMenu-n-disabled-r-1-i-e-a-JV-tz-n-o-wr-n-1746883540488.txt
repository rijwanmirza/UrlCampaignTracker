Trigger",nz=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...i}=e,a=JV(tz,n),o=wr(n);return s.jsx(Hae,{asChild:!0,...o,children:s.jsx(Me.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:sx(t,a.triggerRef),onPointerDown:he(e.onPointerDown,l=>{!r&&l.button===0&&l.ctrlKey===!1&&(a.onOpenToggle(),a.open||l.preventDefault())}),onKeyDown:he(e.onKeyDown,l=>{r||(["Enter"," "].includes(l.key)&&a.onOpenToggle(),l.key==="ArrowDown"&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});nz.displayName=tz;var ose="DropdownMenuPortal",rz=e=>{const{__scopeDropdownMenu:t,...n}=e,r=wr(t);return s.jsx(qae,{...r,...n})};rz.displayName=ose;var iz="DropdownMenuContent",az=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=JV(iz,n),a=wr(n),o=x.useRef(!1);return s.jsx(Kae,{id:i.contentId,"aria-labelledby":i.triggerId,...a,...r,ref:t,onCloseAutoFocus:he(e.onCloseAutoFocus,l=>{var c;o.current||(c=i.triggerRef.current)==null||c.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:he(e.onInteractOutside,l=>{const c=l.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0,d=c.button===2||u;(!i.modal||d)&&(o.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});az.displayName=iz;var lse="DropdownMenuGroup",cse=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(Gae,{...i,...r,ref:t})});cse.displayName=lse;var use="DropdownMenuLabel",sz=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(Yae,{...i,...r,ref:t})});sz.displayName=use;var dse="DropdownMenuItem",oz=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(Qae,{...i,...r,ref:t})});oz.displayName=dse;var fse="DropdownMenuCheckboxItem",lz=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(Xae,{...i,...r,ref:t})});lz.displayName=fse;var hse="DropdownMenuRadioGroup",pse=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(Zae,{...i,...r,ref:t})});pse.displayName=hse;var mse="DropdownMenuRadioItem",cz=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(Jae,{...i,...r,ref:t})});cz.displayName=mse;var gse="DropdownMenuItemIndicator",uz=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(ese,{...i,...r,ref:t})});uz.displayName=gse;var vse="DropdownMenuSeparator",dz=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(tse,{...i,...r,ref:t})});dz.displayName=vse;var yse="DropdownMenuArrow",xse=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(nse,{...i,...r,ref:t})});xse.displayName=yse;var bse="DropdownMenuSubTrigger",fz=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(rse,{...i,...r,ref:t})});fz.displayName=bse;var wse="DropdownMenuSubContent",hz=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=wr(n);return s.jsx(ise,{...i,...r,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});hz.displayName=wse;var jse=ez,Sse=nz,Cse=rz,pz=az,mz=sz,gz=oz,vz=lz,yz=cz,xz=uz,bz=dz,wz=fz,jz=hz;const EN=jse,ON=Sse,_se=x.forwardRef(({className:e,inset:t,children:n,...r},i)=>s.jsxs(wz,{ref:i,className:fe("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...r,children:[n,s.jsx(dx,{className:"ml-auto h-4 w-4"})]}));_se.displayName=wz.displayName;const Nse=x.forwardRef(({className:e,...t},n)=>s.jsx(jz,{ref:n,className:fe("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));Nse.displayName=jz.displayName;const Bx=x.forwardRef(({className:e,sideOffset:t=4,...n},r)=>s.jsx(Cse,{children:s.jsx(pz,{ref:r,sideOffset:t,className:fe("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));Bx.displayName=pz.displayName;const Xn=x.forwardRef(({className:e,inset:t,...n},r)=>s.jsx(gz,{ref:r,className:fe("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",e),...n}));Xn.displayName=gz.displayName;const Pse=x.forwardRef(({className:e,children:t,checked:n,...r},i)=>s.jsxs(vz,{ref:i,className:fe("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:n,...r,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(xz,{children:s.jsx(Uo,{className:"h-4 w-4"})})}),t]}));Pse.displayName=vz.displayName;const Tse=x.forwardRef(({className:e,children:t,...n},r)=>s.jsxs(yz,{ref:r,className:fe("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[s.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:s.jsx(xz,{children:s.jsx(UY,{className:"h-2 w-2 fill-current"})})}),t]}));Tse.displayName=yz.displayName;const Sz=x.forwardRef(({className:e,inset:t,...n},r)=>s.jsx(mz,{ref:r,className:fe("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));Sz.displayName=mz.displayName;const Gh=x.forwardRef(({className:e,...t},n)=>s.jsx(bz,{ref:n,className:fe("-mx-1 my-1 h-px bg-muted",e),...t}));Gh.displayName=bz.displayName;function jc(){const[e,t]=x.useState(typeof window<"u"&&window.innerWidth<800);return x.useEffect(()=>{const n=()=>{const r=window.innerWidth<800;t(r)};return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),e}function kse({campaignId:e,urls:t,onRefresh:n,campaign:r}){const{toast:i}=xn(),a=ki();jc();const[o,l]=x.useState(null),[c,u]=x.useState(!1),[d,f]=x.useState(!1),[h,p]=x.useState(null),[g,m]=x.useState(!1),[v,b]=x.useState(""),[y,w]=x.useState("all"),[C,j]=x.useState(10),[S,_]=x.useState([]),N=t.filter(q=>{const pe=v===""||q.name.toLowerCase().includes(v.toLowerCase())||q.targetUrl.toLowerCase().includes(v.toLowerCase());if(q.status==="completed")return!1;let Se=!0;return y!=="all"?Se=q.status===y:Se=q.status!=="deleted",pe&&Se}),P=[...N].sort((q,pe)=>pe.id-q.id),O=Math.max(9999,C),T=P.slice(0,O),E=yt({mutationFn:async({id:q,action:pe,data:Se})=>{if(pe==="update")return(await Qe("PUT",`/api/urls/${q}`,Se)).json();if(pe==="delete")return await Qe("DELETE",`/api/urls/${q}`),{id:q}},onSuccess:()=>{u(!1),l(null),a.invalidateQueries({queryKey:[`/api/campaigns/${e}`]}),n&&n(),i({title:"URL Updated",description:"The URL status has been updated successfully."})},onError:q=>{i({title:"Action Failed",description:"Failed to perform action. Please try again.",variant:"destructive"}),console.error("URL action failed:",q)}}),k=q=>{const pe=t.find(Se=>Se.id===q);pe&&E.mutate({id:q,action:"update",data:{name:pe.name,targetUrl:pe.targetUrl,clickLimit:pe.clickLimit,status:"active"}})},D=q=>{const pe=t.find(Se=>Se.id===q);pe&&E.mutate({id:q,action:"update",data:{name:pe.name,targetUrl:pe.targetUrl,clickLimit:pe.clickLimit,status:"paused"}})},A=()=>{o&&E.mutate({id:o,action:"delete"})},B=q=>{const pe=`${window.location.origin}/r/${e}/${q.id}`;navigator.clipboard.writeText(pe).then(()=>{i({title:"URL Copied",description:"The URL has been copied to clipboard"})}).catch(()=>{i({title:"Copy Failed",description:"Failed to copy URL to clipboard",variant:"destructive"})})},F=({url:q})=>{const pe=Math.min(100,q.clicks/q.clickLimit*100);return s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:s.jsx("div",{className:`h-2.5 rounded-full ${pe===100?"bg-gray-500":"bg-primary"}`,style:{width:`${pe}%`}})})},R=()=>{S.length===T.length?_([]):_(T.map(q=>q.id))},U=q=>{S.includes(q)?_(S.filter(pe=>pe!==q)):_([...S,q])},G=yt({mutationFn:async({urlIds:q,action:pe})=>Qe("POST","/api/urls/bulk",{urlIds:q,action:pe}),onSuccess:()=>{a.invalidateQueries({queryKey:[`/api/campaigns/${e}`]}),_([]),f(!1),n&&n(),i({title:"Success",description:"Bulk action completed successfully"})},onError:q=>{i({title:"Error",description:"Failed to perform bulk action",variant:"destructive"}),console.error("Bulk action failed:",q)}}),$=()=>{G.mutate({urlIds:S,action:"activate"})},Q=()=>{G.mutate({urlIds:S,action:"pause"})},ae=()=>{G.mutate({urlIds:S,action:"delete"})};return N.length===0?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-col md:flex-row gap-3 mb-2",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(Jl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),s.jsx(ye,{placeholder:"Search URLs...",value:v,onChange:q=>b(q.target.value),className:"pl-10"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(Nt,{value:y,onValueChange:w,children:[s.jsx(bt,{className:"w-[150px]",children:s.jsx(Pt,{placeholder:"Status Filter"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"all",children:"All Status"}),s.jsx(X,{value:"active",children:"Active"}),s.jsx(X,{value:"paused",children:"Paused"})]})]}),s.jsxs(Nt,{value:C.toString(),onValueChange:q=>j(parseInt(q)),children:[s.jsx(bt,{className:"w-[80px]",children:s.jsx(Pt,{placeholder:"Limit"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"10",children:"10"}),s.jsx(X,{value:"50",children:"50"}),s.jsx(X,{value:"100",children:"100"}),s.jsx(X,{value:"200",children:"200"}),s.jsx(X,{value:"500",children:"500"}),s.jsx(X,{value:"1000",children:"1000"}),s.jsxs(s.Fragment,{children:[s.jsx(X,{value:"2000",children:"2000"}),s.jsx(X,{value:"5000",children:"5000"}),s.jsx(X,{value:"9999",children:"All URLs"})]})]})]})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 text-center",children:[s.jsx("p",{className:"text-gray-500 mb-4",children:"No URLs found matching your filters."}),s.jsxs("div",{className:"flex justify-center gap-2",children:[s.jsx(Y,{variant:"outline",size:"sm",onClick:()=>{b(""),w("all")},children:"Clear Filters"}),s.jsx(Pn,{href:"/urls",children:s.jsx(Y,{variant:"outline",size:"sm",children:"View All URLs"})})]})]})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-col md:flex-row gap-3 mb-2",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(Jl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),s.jsx(ye,{placeholder:"Search URLs...",value:v,onChange:q=>b(q.target.value),className:"pl-10"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(Nt,{value:y,onValueChange:w,children:[s.jsx(bt,{className:"w-[150px]",children:s.jsx(Pt,{placeholder:"Status Filter"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"all",children:"All Status"}),s.jsx(X,{value:"active",children:"Active"}),s.jsx(X,{value:"paused",children:"Paused"})]})]}),s.jsxs(Nt,{value:C.toString(),onValueChange:q=>j(parseInt(q)),children:[s.jsx(bt,{className:"w-[80px]",children:s.jsx(Pt,{placeholder:"Limit"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"10",children:"10"}),s.jsx(X,{value:"50",children:"50"}),s.jsx(X,{value:"100",children:"100"}),s.jsx(X,{value:"200",children:"200"}),s.jsx(X,{value:"500",children:"500"}),s.jsx(X,{value:"1000",children:"1000"}),s.jsxs(s.Fragment,{children:[s.jsx(X,{value:"2000",children:"2000"}),s.jsx(X,{value:"5000",children:"5000"}),s.jsx(X,{value:"9999",children:"All URLs"})]})]})]})]})]}),T.length>0&&S.length===0&&s.jsx("div",{className:"p-2 bg-blue-50 rounded border border-blue-200 mb-2",children:s.jsxs(Y,{size:"sm",variant:"outline",className:"w-full gap-1 border-blue-300 text-blue-700",onClick:R,children:[s.jsx(Uo,{className:"h-3 w-3"}),"Select All URLs on This Page (",T.length,")"]})}),S.length>0&&s.jsxs("div",{className:"p-2 bg-gray-50 rounded border flex flex-wrap items-center gap-2 mb-2",children:[s.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[S.length," selected"]}),s.jsxs("div",{className:"ml-auto flex flex-wrap gap-2",children:[s.jsx(Y,{size:"sm",variant:"outline",onClick:R,className:"gap-1",children:S.length===T.length?s.jsxs(s.Fragment,{children:[s.jsx(Sn,{className:"h-3 w-3"}),"Deselect All"]}):s.jsxs(s.Fragment,{children:[s.jsx(Uo,{className:"h-3 w-3"}),"Select All"]})}),s.jsxs(Y,{size:"sm",variant:"outline",onClick:$,className:"gap-1",children:[s.jsx(Va,{className:"h-3 w-3"}),"Activate"]}),s.jsxs(Y,{size:"sm",variant:"outline",onClick:Q,className:"gap-1",children:[s.jsx($s,{className:"h-3 w-3"}),"Pause"]}),s.jsxs(Y,{size:"sm",variant:"outline",className:"gap-1 text-red-500 border-red-200 hover:bg-red-50",onClick:()=>f(!0),children:[s.jsx(Sn,{className:"h-3 w-3"}),"Delete"]})]})]}),s.jsx("div",{className:"overflow-hidden rounded-lg border",children:s.jsxs(ma,{children:[s.jsx(ga,{children:s.jsxs(Rt,{children:[s.jsx(Ce,{className:"w-[40px]",children:s.jsx(Un,{checked:S.length>0&&S.length===T.length,onCheckedChange:R,"aria-label":"Select all"})}),s.jsx(Ce,{className:"w-[40px]",children:"ID"}),s.jsx(Ce,{children:"Name"}),s.jsx(Ce,{children:"Target URL"}),s.jsx(Ce,{children:"Status"}),s.jsx(Ce,{children:"Clicks"}),s.jsx(Ce,{children:"Price"}),s.jsx(Ce,{className:"text-right",children:"Actions"})]})}),s.jsx(va,{children:T.map(q=>s.jsxs(Rt,{children:[s.jsx(ge,{className:"px-2",children:s.jsx(Un,{checked:S.includes(q.id),onCheckedChange:()=>U(q.id),"aria-label":`Select URL ${q.id}`})}),s.jsx(ge,{className:"font-mono text-xs",children:q.id}),s.jsx(ge,{className:"font-medium",children:q.name}),s.jsx(ge,{className:"max-w-[200px] truncate",children:s.jsxs("a",{href:q.targetUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:[q.targetUrl,s.jsx(Ds,{className:"h-3 w-3"})]})}),s.jsx(ge,{children:s.jsx(Ft,{variant:q.status==="active"?"default":"secondary",className:"capitalize",children:q.status})}),s.jsx(ge,{children:s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("span",{className:"text-sm font-medium",children:[q.clicks," / ",q.clickLimit," / ",q.originalClickLimit]}),s.jsx("span",{className:"text-xs text-gray-500 mb-1",children:"received / required / original"}),s.jsx(F,{url:q})]})}),s.jsx(ge,{children:r&&r.pricePerThousand?s.jsxs("span",{children:["$",(Number(r.pricePerThousand)*(q.clickLimit-q.clicks)/1e3).toFixed(4),"/$",(Number(r.pricePerThousand)*q.clickLimit/1e3).toFixed(4)]}):s.jsx("span",{className:"text-gray-400",children:"-"})}),s.jsx(ge,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end items-center gap-2",children:[s.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>B(q),title:"Copy URL",children:s.jsx(Uu,{className:"h-4 w-4"})}),s.jsxs(EN,{children:[s.jsx(ON,{asChild:!0,children:s.jsx(Y,{variant:"ghost",size:"icon",children:s.jsx(fx,{className:"h-4 w-4"})})}),s.jsxs(Bx,{align:"end",children:[s.jsxs(Xn,{onClick:()=>{p(q),m(!0)},children:[s.jsx(Bu,{className:"h-4 w-4 mr-2"}),"Edit URL"]}),q.status==="paused"&&s.jsxs(Xn,{onClick:()=>k(q.id),children:[s.jsx(Va,{className:"h-4 w-4 mr-2"}),"Activate"]}),q.status==="active"&&s.jsxs(Xn,{onClick:()=>D(q.id),children:[s.jsx($s,{className:"h-4 w-4 mr-2"}),"Pause"]}),s.jsxs(Xn,{className:"text-red-600",onClick:()=>{l(q.id),u(!0)},children:[s.jsx(Sn,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})})]},q.id))})]})}),s.jsx(Us,{open:c,onOpenChange:u,children:s.jsxs(Ka,{children:[s.jsxs(Ga,{children:[s.jsx(Qa,{children:"Delete URL"}),s.jsx(Xa,{children:"Are you sure you want to delete this URL? This action will mark it as deleted but it can be viewed in the URL history."})]}),s.jsxs(Ya,{children:[s.jsx(Ja,{onClick:()=>l(null),children:"Cancel"}),s.jsx(Za,{onClick:A,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),s.jsx(Us,{open:d,onOpenChange:f,children:s.jsxs(Ka,{children:[s.jsxs(Ga,{children:[s.jsxs(Qa,{children:["Delete ",S.length," URLs?"]}),s.jsxs(Xa,{children:["Are you sure you want to delete ",S.length," URLs? They will be marked as deleted and will no longer receive traffic."]})]}),s.jsxs(Ya,{children:[s.jsx(Ja,{children:"Cancel"}),s.jsx(Za,{onClick:ae,className:"bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]})}),s.jsx(ti,{open:g,onOpenChange:q=>{m(q),q||p(null)},children:s.jsx(Dr,{className:"sm:max-w-[500px]",children:h&&s.jsx(wN,{url:h,onSuccess:()=>{m(!1),p(null),n&&n()}})})})]})}const Ese=H.object({name:H.string().min(1,"Name is required").max(100,"Name must be 100 characters or less"),targetUrl:H.string().min(1,"Target URL is required").url("Please enter a valid URL (including http:// or https://)"),clickLimit:H.number().min(1,"Click limit must be at least 1")});function Ose({open:e,onOpenChange:t,campaignId:n,onSuccess:r,editingUrl:i}){const{toast:a}=xn(),[o,l]=x.useState(!1),c=!!i,u=Ki({resolver:Gi(Ese),defaultValues:{name:(i==null?void 0:i.name)||"",targetUrl:(i==null?void 0:i.targetUrl)||"",clickLimit:(i==null?void 0:i.clickLimit)||100}}),d=yt({mutationFn:async h=>(console.log("URL Form - Submitting data:",h),c&&i?Qe("PUT",`/api/urls/${i.id}`,h):Qe("POST",`/api/campaigns/${n}/urls`,h)),onSuccess:()=>{a({title:c?"URL Updated":"URL Created",description:c?`"${u.getValues("name")}" has been updated successfully`:`"${u.getValues("name")}" has been added to the campaign`}),u.reset(),t(!1),r()},onError:h=>{a({title:"Error",description:h instanceof Error?h.message:`Failed to ${c?"update":"create"} URL`,variant:"destructive"})},onSettled:()=>{l(!1)}}),f=h=>{l(!0),d.mutate(h)};return s.jsx(ti,{open:e,onOpenChange:t,children:s.jsxs(Dr,{className:"sm:max-w-[550px]",children:[s.jsx(Ji,{children:s.jsx(ea,{children:c?"Edit URL":"Add New URL"})}),s.jsx(Da,{...u,children:s.jsxs("form",{onSubmit:u.handleSubmit(f),className:"space-y-6",children:[s.jsx(Ee,{control:u.control,name:"name",render:({field:h})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"URL Name"}),s.jsx(ke,{children:s.jsx(ye,{placeholder:"My URL",...h})}),s.jsx(it,{children:"A descriptive name to identify this URL"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:u.control,name:"targetUrl",render:({field:h})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Target URL"}),s.jsx(ke,{children:s.jsx(ye,{placeholder:"https://example.com",...h})}),s.jsx(it,{children:"The URL where users will be redirected to"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:u.control,name:"clickLimit",render:({field:h})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Click Limit"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",min:1,...h,onChange:p=>{console.log("Click limit input changed:",p.target.value);const g=p.target.value===""?"":parseInt(p.target.value);console.log("Parsed click limit value:",g),isNaN(g)?h.onChange(""):h.onChange(g)},value:h.value})}),s.jsx(it,{children:"Maximum number of clicks before this URL becomes inactive"}),s.jsx(De,{})]})}),c&&s.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[s.jsxs("p",{className:"text-sm text-gray-500",children:["Current clicks: ",s.jsx("span",{className:"font-medium",children:i==null?void 0:i.clicks})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:s.jsx("div",{className:"h-2 rounded-full bg-primary",style:{width:`${Math.min(100,((i==null?void 0:i.clicks)||0)/((i==null?void 0:i.clickLimit)||1)*100)}%`}})})]}),s.jsxs($a,{children:[s.jsx(Y,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:o,children:"Cancel"}),s.jsx(Y,{type:"submit",disabled:o,children:o?c?"Updating...":"Adding...":c?"Update URL":"Add URL"})]})]})})]})})}function Ase({campaign:e}){const t=Math.min(100,e.totalClicks>0&&e.remainingClicks>0?e.totalClicks/(e.totalClicks+e.remainingClicks)*100:0);return s.jsx("div",{className:"mb-6",children:s.jsxs(qe,{children:[s.jsxs(Xe,{className:"flex flex-row items-center justify-between pb-2",children:[s.jsx(Ze,{className:"text-sm font-medium",children:"Total Clicks"}),s.jsx(eQ,{className:"h-4 w-4 text-muted-foreground"})]}),s.jsxs(Ke,{children:[s.jsx("div",{className:"text-2xl font-bold",children:e.totalClicks}),s.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[e.remainingClicks.toLocaleString()," remaining clicks available"]}),s.jsx("div",{className:"mt-3 h-2 rounded-full bg-gray-100",children:s.jsx("div",{className:"h-full bg-primary rounded-full",style:{width:`${t}%`}})})]})]})})}function Rse(){const{toast:e}=xn(),t=ki(),[n,r]=x.useState(!1),i=jc();Ir();const[a,o]=If("/campaigns/:id"),l=a&&(o!=null&&o.id)?parseInt(o.id):void 0;Tt({queryKey:["/api/campaigns"]});const{data:c,isLoading:u}=Tt({queryKey:l?[`/api/campaigns/${l}`]:["empty-query"],enabled:!!l}),d=c?wZ(c):void 0,f=p=>`${window.location.origin}/c/${p}`,h=()=>{if(!c)return;const p=f(c.id);navigator.clipboard.writeText(p).then(()=>{e({title:"URL Copied",description:"Campaign rotation URL has been copied to clipboard",variant:"success"})}).catch(()=>{e({title:"Copy Failed",description:"Failed to copy URL to clipboard",variant:"destructive"})})};return s.jsx("div",{className:"flex flex-col",children:s.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50",children:!l||u?s.jsx("div",{className:"h-full flex items-center justify-center flex-col p-6",children:s.jsx("div",{className:"text-center max-w-md",children:u?s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"h-12 w-12 rounded-full border-4 border-t-primary border-gray-200 animate-spin mb-4"}),s.jsx("h2",{className:"mt-4 text-xl font-semibold text-gray-700",children:"Loading Campaign..."})]}):s.jsxs(s.Fragment,{children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),s.jsx("h2",{className:"mt-4 text-xl font-semibold text-gray-700",children:"No Campaign Selected"}),s.jsx("p",{className:"mt-2 text-gray-500",children:"Please select a campaign from the Campaigns page or create a new one to get started."})]})})}):d?s.jsxs("div",{className:"p-4 md:p-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6",children:[s.jsx("div",{children:s.jsx("div",{className:"flex items-center gap-3",children:s.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-800",children:d.name})})}),s.jsxs("div",{className:"mt-4 md:mt-0 flex flex-wrap gap-2",children:[s.jsxs(Y,{variant:"outline",onClick:h,className:"gap-1.5 flex-1 md:flex-none",size:i?"sm":"default",children:[s.jsx(Uu,{className:"h-4 w-4"}),"Copy URL"]}),s.jsx(Y,{onClick:()=>r(!0),className:"flex-1 md:flex-none",size:i?"sm":"default",children:"Add URL"})]})]}),s.jsx(nae,{campaign:d}),s.jsx(Ase,{campaign:d}),s.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mt-8 mb-4 gap-3",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center",children:[s.jsx("h2",{className:"text-lg md:text-xl font-bold",children:"Active URLs"}),s.jsx("span",{className:"md:ml-3 text-xs md:text-sm text-gray-500",children:"Only showing active & paused URLs (completed URLs are removed)"})]}),s.jsx(Pn,{href:"/urls",children:s.jsxs(Y,{variant:"outline",size:"sm",className:"gap-1.5 w-full md:w-auto",children:[s.jsx(YY,{className:"h-4 w-4"}),"View URL History"]})})]}),s.jsx(kse,{campaignId:d.id,urls:d.urls.filter(p=>p.status!=="completed"),campaign:c,onRefresh:()=>{t.invalidateQueries({queryKey:[`/api/campaigns/${d.id}`]})}}),s.jsx(Ose,{open:n,onOpenChange:r,campaignId:d.id,onSuccess:()=>{t.invalidateQueries({queryKey:[`/api/campaigns/${d.id}`]}),t.invalidateQueries({queryKey:["/api/campaigns"]})}})]}):null})})}var[Vx,s$e]=da("Tooltip",[nl]),zx=nl(),Cz="TooltipProvider",Mse=700,$1="tooltip.open",[Dse,AN]=Vx(Cz),_z=e=>{const{__scopeTooltip:t,delayDuration:n=Mse,skipDelayDuration:r=300,disableHoverableContent:i=!1,children:a}=e,[o,l]=x.useState(!0),c=x.useRef(!1),u=x.useRef(0);return x.useEffect(()=>{const d=u.current;return()=>window.clearTimeout(d)},[]),s.jsx(Dse,{scope:t,isOpenDelayed:o,delayDuration:n,onOpen:x.useCallback(()=>{window.clearTimeout(u.current),l(!1)},[]),onClose:x.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>l(!0),r)},[r]),isPointerInTransitRef:c,onPointerInTransitChange:x.useCallback(d=>{c.current=d},[]),disableHoverableContent:i,children:a})};_z.displayName=Cz;var Wx="Tooltip",[$se,Hx]=Vx(Wx),Nz=e=>{const{__scopeTooltip:t,children:n,open:r,defaultOpen:i=!1,onOpenChange:a,disableHoverableContent:o,delayDuration:l}=e,c=AN(Wx,e.__scopeTooltip),u=zx(t),[d,f]=x.useState(null),h=bi(),p=x.useRef(0),g=o??c.disableHoverableContent,m=l??c.delayDuration,v=x.useRef(!1),[b=!1,y]=ra({prop:r,defaultProp:i,onChange:_=>{_?(c.onOpen(),document.dispatchEvent(new CustomEvent($1))):c.onClose(),a==null||a(_)}}),w=x.useMemo(()=>b?v.current?"delayed-open":"instant-open":"closed",[b]),C=x.useCallback(()=>{window.clearTimeout(p.current),v.current=!1,y(!0)},[y]),j=x.useCallback(()=>{window.clearTimeout(p.current),y(!1)},[y]),S=x.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{v.current=!0,y(!0)},m)},[m,y]);return x.useEffect(()=>()=>window.clearTimeout(p.current),[]),s.jsx(_x,{...u,children:s.jsx($se,{scope:t,contentId:h,open:b,stateAttribute:w,trigger:d,onTriggerChange:f,onTriggerEnter:x.useCallback(()=>{c.isOpenDelayed?S():C()},[c.isOpenDelayed,S,C]),onTriggerLeave:x.useCallback(()=>{g?j():window.clearTimeout(p.current)},[j,g]),onOpen:C,onClose:j,disableHoverableContent:g,children:n})})};Nz.displayName=Wx;var I1="TooltipTrigger",Pz=x.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,i=Hx(I1,n),a=AN(I1,n),o=zx(n),l=x.useRef(null),c=ut(t,l,i.onTriggerChange),u=x.useRef(!1),d=x.useRef(!1),f=x.useCallback(()=>u.current=!1,[]);return x.useEffect(()=>()=>document.removeEventListener("pointerup",f),[f]),s.jsx(Xp,{asChild:!0,...o,children:s.jsx(Me.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...r,ref:c,onPointerMove:he(e.onPointerMove,h=>{h.pointerType!=="touch"&&!d.current&&!a.isPointerInTransitRef.current&&(i.onTriggerEnter(),d.current=!0)}),onPointerLeave:he(e.onPointerLeave,()=>{i.onTriggerLeave(),d.current=!1}),onPointerDown:he(e.onPointerDown,()=>{u.current=!0,document.addEventListener("pointerup",f,{once:!0})}),onFocus:he(e.onFocus,()=>{u.current||i.onOpen()}),onBlur:he(e.onBlur,i.onClose),onClick:he(e.onClick,i.onClose)})})});Pz.displayName=I1;var Ise="TooltipPortal",[o$e,Lse]=Vx(Ise,{forceMount:void 0}),Xu="TooltipContent",Tz=x.forwardRef((e,t)=>{const n=Lse(Xu,e.__scopeTooltip),{forceMount:r=n.forceMount,side:i="top",...a}=e,o=Hx(Xu,e.__scopeTooltip);return s.jsx(Fr,{present:r||o.open,children:o.disableHoverableContent?s.jsx(kz,{side:i,...a,ref:t}):s.jsx(Fse,{side:i,...a,ref:t})})}),Fse=x.forwardRef((e,t)=>{const n=Hx(Xu,e.__scopeTooltip),r=AN(Xu,e.__scopeTooltip),i=x.useRef(null),a=ut(t,i),[o,l]=x.useState(null),{trigger:c,onClose:u}=n,d=i.current,{onPointerInTransitChange:f}=r,h=x.useCallback(()=>{l(null),f(!1)},[f]),p=x.useCallback((g,m)=>{const v=g.currentTarget,b={x:g.clientX,y:g.clientY},y=zse(b,v.getBoundingClientRect()),w=Wse(b,y),C=Hse(m.getBoundingClientRect()),j=Kse([...w,...C]);l(j),f(!0)},[f]);return x.useEffect(()=>()=>h(),[h]),x.useEffect(()=>{if(c&&d){const g=v=>p(v,d),m=v=>p(v,c);return c.addEventListener("pointerleave",g),d.addEventListener("pointerleave",m),()=>{c.removeEventListener("pointerleave",g),d.removeEventListener("pointerleave",m)}}},[c,d,p,h]),x.useEffect(()=>{if(o){const g=m=>{const v=m.target,b={x:m.clientX,y:m.clientY},y=(c==null?void 0:c.contains(v))||(d==null?void 0:d.contains(v)),w=!qse(b,o);y?h():w&&(h(),u())};return document.addEventListener("pointermove",g),()=>document.removeEventListener("pointermove",g)}},[c,d,o,u,h]),s.jsx(kz,{...e,ref:a})}),[Use,Bse]=Vx(Wx,{isInside:!1}),kz=x.forwardRef((e,t)=>{const{__scopeTooltip:n,children:r,"aria-label":i,onEscapeKeyDown:a,onPointerDownOutside:o,...l}=e,c=Hx(Xu,n),u=zx(n),{onClose:d}=c;return x.useEffect(()=>(document.addEventListener($1,d),()=>document.removeEventListener($1,d)),[d]),x.useEffect(()=>{if(c.trigger){const f=h=>{const p=h.target;p!=null&&p.contains(c.trigger)&&d()};return window.addEventListener("scroll",f,{capture:!0}),()=>window.removeEventListener("scroll",f,{capture:!0})}},[c.trigger,d]),s.jsx(gc,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:a,onPointerDownOutside:o,onFocusOutside:f=>f.preventDefault(),onDismiss:d,children:s.jsxs(Nx,{"data-state":c.stateAttribute,...u,...l,ref:t,style:{...l.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[s.jsx(x_,{children:r}),s.jsx(Use,{scope:n,isInside:!0,children:s.jsx(pY,{id:c.contentId,role:"tooltip",children:i||r})})]})})});Tz.displayName=Xu;var Ez="TooltipArrow",Vse=x.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,i=zx(n);return Bse(Ez,n).isInside?null:s.jsx(Px,{...i,...r,ref:t})});Vse.displayName=Ez;function zse(e,t){const n=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),i=Math.abs(t.right-e.x),a=Math.abs(t.left-e.x);switch(Math.min(n,r,i,a)){case a:return"left";case i:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function Wse(e,t,n=5){const r=[];switch(t){case"top":r.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":r.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":r.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":r.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return r}function Hse(e){const{top:t,right:n,bottom:r,left:i}=e;return[{x:i,y:t},{x:n,y:t},{x:n,y:r},{x:i,y:r}]}function qse(e,t){const{x:n,y:r}=e;let i=!1;for(let a=0,o=t.length-1;a<t.length;o=a++){const l=t[a].x,c=t[a].y,u=t[o].x,d=t[o].y;c>r!=d>r&&n<(u-l)*(r-c)/(d-c)+l&&(i=!i)}return i}function Kse(e){const t=e.slice();return t.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),Gse(t)}function Gse(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const i=e[r];for(;t.length>=2;){const a=t[t.length-1],o=t[t.length-2];if((a.x-o.x)*(i.y-o.y)>=(a.y-o.y)*(i.x-o.x))t.pop();else break}t.push(i)}t.pop();const n=[];for(let r=e.length-1;r>=0;r--){const i=e[r];for(;n.length>=2;){const a=n[n.length-1],o=n[n.length-2];if((a.x-o.x)*(i.y-o.y)>=(a.y-o.y)*(i.x-o.x))n.pop();else break}n.push(i)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var Yse=_z,Qse=Nz,Xse=Pz,Oz=Tz;const Jb=Yse,ew=Qse,tw=Xse,Rg=x.forwardRef(({className:e,sideOffset:t=4,...n},r)=>s.jsx(Oz,{ref:r,sideOffset:t,className:fe("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));Rg.displayName=Oz.displayName;const Zse=$J.extend({name:H.string().min(1,"Campaign name is required").max(100,"Campaign name must be 100 characters or less"),customPath:H.string().max(50,"Custom path must be 50 characters or less").regex(/^[a-z0-9-]*$/,"Only lowercase letters, numbers, and hyphens are allowed").optional(),pricePerThousand:H.number().min(0,"Price must be at least 0").max(1e4,"Price can't exceed $10,000").optional()}),Jse={[xt.DIRECT]:"Direct (Simple Redirect)",[xt.META_REFRESH]:"Meta Refresh",[xt.DOUBLE_META_REFRESH]:"Double Meta Refresh",[xt.HTTP_307]:"HTTP 307 Redirect",[xt.HTTP2_307_TEMPORARY]:"HTTP/2.0 307 Temporary",[xt.HTTP2_FORCED_307]:"HTTP/2.0 Forced 307"};function eoe({open:e,onOpenChange:t,onSuccess:n}){const{toast:r}=xn(),[i,a]=x.useState(!1),{data:o=[],isLoading:l}=Tt({queryKey:["/api/trafficstar/saved-campaigns"],retry:!1,staleTime:3e4}),c=Ki({resolver:Gi(Zse),defaultValues:{name:"",redirectMethod:xt.DIRECT,customPath:"",multiplier:1,pricePerThousand:0,trafficstarCampaignId:""}}),u=yt({mutationFn:async f=>(console.log("Creating campaign with data:",f),await Qe("POST","/api/campaigns",f)),onSuccess:f=>{r({title:"Campaign Created",description:`"${f.name}" has been created successfully`,variant:"success"}),c.reset(),t(!1),n&&n(f)},onError:f=>{r({title:"Error",description:f instanceof Error?f.message:"Failed to create campaign",variant:"destructive"})},onSettled:()=>{a(!1)}}),d=f=>{a(!0),u.mutate(f)};return s.jsx(ti,{open:e,onOpenChange:t,children:s.jsxs(Dr,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[s.jsx(Ji,{children:s.jsx(ea,{children:"Create New Campaign"})}),s.jsx(Da,{...c,children:s.jsxs("form",{onSubmit:c.handleSubmit(d),className:"space-y-4",children:[s.jsx(Ee,{control:c.control,name:"name",render:({field:f})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Campaign Name"}),s.jsx(ke,{children:s.jsx(ye,{placeholder:"Enter campaign name",...f})}),s.jsx(De,{})]})}),s.jsx(Ee,{control:c.control,name:"redirectMethod",render:({field:f})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Redirect Method"}),s.jsxs(Nt,{onValueChange:f.onChange,defaultValue:f.value,children:[s.jsx(ke,{children:s.jsx(bt,{children:s.jsx(Pt,{placeholder:"Select redirect method"})})}),s.jsx(wt,{children:Object.entries(Jse).map(([h,p])=>s.jsx(X,{value:h,children:p},h))})]}),s.jsx(it,{children:"Choose how visitors will be redirected to target URLs"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:c.control,name:"customPath",render:({field:f})=>s.jsxs(Te,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Pe,{children:"Custom Path"}),s.jsx(Jb,{children:s.jsxs(ew,{children:[s.jsx(tw,{asChild:!0,children:s.jsx(vb,{className:"h-4 w-4 text-gray-400"})}),s.jsx(Rg,{children:s.jsx("p",{className:"w-[220px] text-xs",children:'Create a custom keyword path for your campaign URLs. Example: "summer-promo" would create a URL like: mydomain.com/views/summer-promo'})})]})})]}),s.jsx(ke,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("div",{className:"bg-gray-100 px-3 py-2 text-gray-500 border border-r-0 rounded-l-md text-sm",children:[window.location.origin,"/views/"]}),s.jsx(ye,{placeholder:"custom-path",...f,className:"rounded-l-none"})]})}),s.jsx(it,{children:"Optional. Use lowercase letters, numbers, and hyphens only."}),s.jsx(De,{})]})}),s.jsx(Ee,{control:c.control,name:"multiplier",render:({field:f})=>s.jsxs(Te,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Pe,{children:"Click Multiplier"}),s.jsx(Jb,{children:s.jsxs(ew,{children:[s.jsx(tw,{asChild:!0,children:s.jsx(vb,{className:"h-4 w-4 text-gray-400"})}),s.jsx(Rg,{children:s.jsx("p",{className:"w-[220px] text-xs",children:"Automatically multiply click limits for all URLs in this campaign. For example, if set to 2 and a URL has a limit of 10, the effective limit will be 20."})})]})})]}),s.jsx(ke,{children:s.jsx(ye,{type:"number",min:"0.01",step:"0.01",...f,onChange:h=>{const p=h.target.value===""?"":h.target.value,g=parseFloat(p);isNaN(g)?f.onChange(p):f.onChange(g)},value:f.value})}),s.jsx(it,{children:"Multiply all URL click limits in this campaign by this value."}),s.jsx(De,{})]})}),s.jsx(Ee,{control:c.control,name:"pricePerThousand",render:({field:f})=>s.jsxs(Te,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Pe,{children:"Price Per 1000 Clicks"}),s.jsx(Jb,{children:s.jsxs(ew,{children:[s.jsx(tw,{asChild:!0,children:s.jsx(vb,{className:"h-4 w-4 text-gray-400"})}),s.jsx(Rg,{children:s.jsx("p",{className:"w-[220px] text-xs",children:"Set the price per 1000 clicks for this campaign. This will be used to calculate the total price based on required clicks."})})]})})]}),s.jsx(ke,{children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"bg-gray-100 px-3 py-2 text-gray-500 border border-r-0 rounded-l-md text-sm",children:"$"}),s.jsx(ye,{type:"number",min:"0",max:"10000",step:"0.0001",...f,className:"rounded-l-none",onChange:h=>{const p=h.target.value===""?"0":h.target.value,g=parseFloat(p);isNaN(g)?(console.log("Setting price to 0"),f.onChange(0)):(console.log("Setting price to number:",g),f.onChange(g))},value:f.value})]})}),s.jsx(it,{children:"Price per 1000 clicks (e.g., $5.50 = $5.50 per 1000 clicks, or $0.0055 per click)"}),s.jsx(De,{})]})}),s.jsxs("div",{className:"border-t pt-4 mt-6",children:[s.jsx("h3",{className:"text-md font-medium mb-4",children:"TrafficStar Integration"}),s.jsx(Ee,{control:c.control,name:"trafficstarCampaignId",render:({field:f})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"TrafficStar Campaign"}),s.jsxs(Nt,{onValueChange:f.onChange,value:f.value||"",children:[s.jsx(ke,{children:s.jsx(bt,{children:s.jsx(Pt,{placeholder:"Select TrafficStar campaign",children:l&&s.jsxs("div",{className:"flex items-center",children:[s.jsx(We,{className:"h-4 w-4 mr-2 animate-spin"}),s.jsx("span",{children:"Loading campaigns..."})]})})})}),s.jsxs(wt,{children:[s.jsx(X,{value:"none",children:"None (No TrafficStar integration)"}),o.map(h=>s.jsx(X,{value:h.trafficstarId||`campaign-${h.id}`,children:h.name},h.trafficstarId))]})]}),s.jsx(it,{children:"Link this campaign to a TrafficStar campaign for spent value tracking"}),s.jsx(De,{})]})}),s.jsx("div",{className:"rounded-lg border p-3 mt-4",children:s.jsxs("div",{className:"space-y-0.5",children:[s.jsx("h4",{className:"font-medium",children:"TrafficStar Spent Tracking"}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Spent value tracking is automatically enabled when a TrafficStar campaign is selected.",s.jsx("br",{}),"• Updates daily spent value every 2 minutes",s.jsx("br",{}),"• Sets daily budget to $10.15 when UTC date changes"]})]})})]}),s.jsxs($a,{children:[s.jsx(Y,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:i,children:"Cancel"}),s.jsx(Y,{type:"submit",disabled:i,children:i?"Creating...":"Create Campaign"})]})]})})]})})}const VE=e=>{if(!e.pricePerThousand||!e.urls||e.urls.length===0)return"0.0000";const t=e.urls.filter(a=>a.isActive),n=Number(e.pricePerThousand),r=t.reduce((a,o)=>a+o.clickLimit,0);return(n*r/1e3).toFixed(4)},zE=e=>{if(!e.pricePerThousand||!e.urls||e.urls.length===0)return"0.0000";const t=e.urls.filter(a=>a.isActive),n=Number(e.pricePerThousand),r=t.reduce((a,o)=>a+(o.clickLimit-o.clicks),0);return(n*r/1e3).toFixed(4)};function toe(){const{toast:e}=xn(),t=ki(),[,n]=Ir(),[r,i]=x.useState(""),[a,o]=x.useState(!1),[l,c]=x.useState(!1),[u,d]=x.useState(null),f=jc(),{data:h=[],isLoading:p}=Tt({queryKey:["/api/campaigns"]}),g=h.filter(C=>C.name.toLowerCase().includes(r.toLowerCase())),m=yt({mutationFn:async C=>Qe("DELETE",`/api/campaigns/${C}`),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/campaigns"]}),e({title:"Campaign Deleted",description:"The campaign has been deleted successfully"}),c(!1),d(null)},onError:C=>{e({title:"Delete Failed",description:"Failed to delete campaign. Please try again.",variant:"destructive"}),console.error("Campaign deletion failed:",C)}}),v=C=>{d(C),c(!0)},b=()=>{u&&m.mutate(u)},y=C=>{const j=`${window.location.origin}/c/${C}`;navigator.clipboard.writeText(j).then(()=>{e({title:"URL Copied",description:"Campaign rotation URL has been copied to clipboard",variant:"success"})}).catch(()=>{e({title:"Copy Failed",description:"Failed to copy URL to clipboard",variant:"destructive"})})},w=C=>{n(`/campaigns/${C}`)};return s.jsxs("div",{className:"min-h-screen",children:[s.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50",style:{paddingBottom:"5rem"},children:s.jsxs("div",{className:"p-4 md:p-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-800",children:"Campaigns"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Manage your redirect campaigns"})]}),s.jsx("div",{className:"mt-4 md:mt-0 flex space-x-2",children:s.jsxs(Y,{onClick:()=>o(!0),children:[s.jsx(FY,{className:"h-4 w-4 mr-2"}),"New Campaign"]})})]}),s.jsx("div",{className:"mb-6",children:s.jsx(ye,{placeholder:"Search campaigns...",value:r,onChange:C=>i(C.target.value),className:"max-w-md"})}),f?s.jsx("div",{className:"space-y-4",children:p?s.jsx("div",{className:"flex justify-center py-12",children:s.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-t-primary border-gray-200"})}):g.length===0?s.jsx(qe,{className:"bg-white",children:s.jsxs(Ke,{className:"pt-6 pb-6 text-center",children:[s.jsx("p",{className:"text-gray-500",children:"No campaigns found"}),s.jsx(Y,{variant:"outline",onClick:()=>o(!0),className:"mt-4",children:"Create your first campaign"})]})}):g.map(C=>s.jsxs(qe,{className:"bg-white",children:[s.jsx(Xe,{className:"pb-2",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx(Ze,{className:"text-lg",children:C.name}),s.jsxs(ft,{children:["ID: ",C.id]})]}),s.jsx(Ft,{variant:"outline",children:C.redirectMethod})]})}),s.jsx(Ke,{className:"pb-3",children:s.jsxs("div",{className:"mt-1 space-y-2",children:[C.customPath&&s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-gray-500",children:"Custom Path: "}),s.jsx("span",{className:"font-medium",children:C.customPath})]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-gray-500",children:"Created: "}),s.jsx("span",{children:Ph(C.createdAt)})]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-gray-500",children:"URLs: "}),s.jsx("span",{className:"font-medium",children:C.urls.length}),s.jsx("span",{className:"text-gray-500 ml-2",children:"Active: "}),s.jsx("span",{className:"font-medium",children:C.urls.filter(j=>j.isActive).length})]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-gray-500",children:"Multiplier: "}),s.jsxs("span",{className:"font-medium",children:[C.multiplier,"x"]})]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-gray-500",children:"Price per 1000: "}),s.jsxs("span",{className:"font-medium",children:["$",typeof C.pricePerThousand=="string"?parseFloat(C.pricePerThousand).toFixed(4):Number(C.pricePerThousand||0).toFixed(4)]})]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-gray-500",children:"Campaign Price: "}),s.jsxs("span",{className:"font-medium",children:["$",zE(C),"/$",VE(C)]})]})]})}),s.jsxs(Ke,{className:"pt-0 pb-4 border-t flex justify-between",children:[s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(Y,{variant:"ghost",size:"sm",onClick:()=>y(C.id),children:s.jsx($k,{className:"h-4 w-4"})}),s.jsx(Y,{variant:"ghost",size:"sm",onClick:()=>window.open(`/c/${C.id}`,"_blank"),children:s.jsx(Ds,{className:"h-4 w-4"})})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(Y,{variant:"outline",size:"sm",onClick:()=>w(C.id),children:[s.jsx(Bu,{className:"h-4 w-4 mr-1"}),"Edit"]}),s.jsxs(Y,{variant:"outline",size:"sm",className:"text-red-600 border-red-100",onClick:()=>v(C.id),children:[s.jsx(Sn,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]})]},C.id))}):s.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:s.jsxs(ma,{children:[s.jsx(ga,{children:s.jsxs(Rt,{children:[s.jsx(Ce,{children:"ID"}),s.jsx(Ce,{children:"Name"}),s.jsx(Ce,{children:"Custom Path"}),s.jsx(Ce,{children:"Redirect Method"}),s.jsx(Ce,{children:"URLs (Active/Total)"}),s.jsx(Ce,{children:"Multiplier"}),s.jsx(Ce,{children:"Price per 1000"}),s.jsx(Ce,{children:"Campaign Price"}),s.jsx(Ce,{children:"Created"}),s.jsx(Ce,{className:"text-right",children:"Actions"})]})}),s.jsx(va,{children:p?s.jsx(Rt,{children:s.jsx(ge,{colSpan:9,className:"text-center h-24",children:s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-b-2 border-primary"})})})}):g.length===0?s.jsx(Rt,{children:s.jsx(ge,{colSpan:9,className:"text-center h-24",children:s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("p",{className:"text-gray-500 mb-4",children:"No campaigns found"}),s.jsx(Y,{onClick:()=>o(!0),children:"Create your first campaign"})]})})}):g.map(C=>s.jsxs(Rt,{children:[s.jsx(ge,{className:"font-mono text-xs",children:C.id}),s.jsx(ge,{className:"font-medium",children:C.name}),s.jsx(ge,{children:C.customPath?s.jsx(Ft,{variant:"outline",children:C.customPath}):s.jsx("span",{className:"text-gray-400",children:"-"})}),s.jsx(ge,{children:s.jsx(Ft,{children:C.redirectMethod})}),s.jsxs(ge,{children:[C.urls.filter(j=>j.isActive).length," / ",C.urls.length]}),s.jsxs(ge,{children:[C.multiplier,"x"]}),s.jsxs(ge,{children:["$",typeof C.pricePerThousand=="string"?parseFloat(C.pricePerThousand).toFixed(4):Number(C.pricePerThousand||0).toFixed(4)]}),s.jsxs(ge,{children:["$",zE(C),"/$",VE(C)]}),s.jsx(ge,{className:"text-gray-500 text-sm",children:Ph(C.createdAt)}),s.jsx(ge,{children:s.jsx("div",{className:"flex justify-end",children:s.jsxs(EN,{children:[s.jsx(ON,{asChild:!0,children:s.jsxs(Y,{variant:"ghost",className:"h-8 w-8 p-0",children:[s.jsx("span",{className:"sr-only",children:"Open menu"}),s.jsx(fx,{className:"h-4 w-4"})]})}),s.jsxs(Bx,{align:"end",children:[s.jsx(Sz,{children:"Actions"}),s.jsxs(Xn,{onClick:()=>y(C.id),children:[s.jsx($k,{className:"h-4 w-4 mr-2"}),"Copy URL"]}),s.jsxs(Xn,{onClick:()=>window.open(`/c/${C.id}`,"_blank"),children:[s.jsx(Ds,{className:"h-4 w-4 mr-2"}),"Open Redirect"]}),s.jsx(Gh,{}),s.jsxs(Xn,{onClick:()=>w(C.id),children:[s.jsx(Bu,{className:"h-4 w-4 mr-2"}),"Edit Campaign"]}),s.jsx(Gh,{}),s.jsxs(Xn,{className:"text-red-600 focus:text-red-600",onClick:()=>v(C.id),children:[s.jsx(Sn,{className:"h-4 w-4 mr-2"}),"Delete Campaign"]})]})]})})})]},C.id))})]})})]})}),s.jsx(eoe,{open:a,onOpenChange:o,onSuccess:C=>{o(!1),e({title:"Campaign Created",description:"Your new campaign has been created successfully"}),t.invalidateQueries({queryKey:["/api/campaigns"]})}}),s.jsx(Us,{open:l,onOpenChange:c,children:s.jsxs(Ka,{children:[s.jsxs(Ga,{children:[s.jsx(Qa,{children:"Delete Campaign"}),s.jsx(Xa,{children:"Are you sure you want to delete this campaign? This will also mark all associated URLs as deleted. This action cannot be undone."})]}),s.jsxs(Ya,{children:[s.jsx(Ja,{onClick:()=>d(null),children:"Cancel"}),s.jsx(Za,{onClick:b,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})}function noe({currentPage:e,totalPages:t,onPageChange:n}){const r=Array.from({length:t},(i,a)=>a+1);return s.jsxs("div",{className:"flex items-center justify-center mt-4 gap-1",children:[s.jsx(Y,{variant:"outline",size:"sm",onClick:()=>n(e-1),disabled:e===1,children:"Previous"}),r.map(i=>s.jsx(Y,{variant:i===e?"default":"outline",size:"sm",onClick:()=>n(i),className:"w-9 p-0",children:i},i)),s.jsx(Y,{variant:"outline",size:"sm",onClick:()=>n(e+1),disabled:e===t,children:"Next"})]})}function roe(){const{toast:e}=xn(),t=ki();jc();const[n,r]=x.useState(""),[i,a]=x.useState(""),[o,l]=x.useState("all"),[c,u]=x.useState(1),[d,f]=x.useState(10),[h,p]=x.useState([]),[g,m]=x.useState(!1),[v,b]=x.useState(!1),[y,w]=x.useState(null),C=x.useCallback(L=>{r(L.target.value);const ne=setTimeout(()=>{a(L.target.value),u(1)},300);return()=>clearTimeout(ne)},[]),{data:j,isLoading:S,isError:_}=Tt({queryKey:["urls",c,d,i,o],queryFn:async()=>{const L=new URLSearchParams;L.append("page",c.toString()),L.append("limit",d.toString()),i&&L.append("search",i),o!=="all"&&L.append("status",o);const ne=await fetch(`/api/urls?${L.toString()}`);if(!ne.ok)throw new Error("Failed to fetch URLs");return ne.json()}}),N=(j==null?void 0:j.urls)||[],P=j!=null&&j.total?Math.ceil(j.total/d):1,O=({status:L})=>{let ne="outline",re=L.charAt(0).toUpperCase()+L.slice(1);switch(L){case"active":ne="default";break;case"paused":ne="secondary";break;case"completed":ne="outline";break;case"deleted":ne="destructive";break}return s.jsx(Ft,{variant:ne,children:re})},T=()=>{h.length===N.length?p([]):p(N.map(L=>L.id))},E=L=>{h.includes(L)?p(h.filter(ne=>ne!==L)):p([...h,L])},k=yt({mutationFn:async({urlIds:L,action:ne})=>Qe("POST","/api/urls/bulk",{urlIds:L,action:ne}),onSuccess:()=>{t.invalidateQueries({queryKey:["urls"]}),t.invalidateQueries({queryKey:["/api/campaigns"]}),p([]),e({title:"Success",description:"Bulk action completed successfully"})},onError:L=>{e({title:"Error",description:"Failed to perform bulk action",variant:"destructive"}),console.error("Bulk action failed:",L)}}),D=()=>{k.mutate({urlIds:h,action:"activate"})},A=()=>{k.mutate({urlIds:h,action:"pause"})},B=()=>{k.mutate({urlIds:h,action:"delete"}),m(!1)},F=()=>{k.mutate({urlIds:h,action:"permanent_delete"}),b(!1)},R=L=>{const ne=`${window.location.origin}/r/${L.campaignId}/${L.id}`;navigator.clipboard.writeText(ne).then(()=>{e({title:"URL Copied",description:"URL has been copied to clipboard"})}).catch(()=>{e({title:"Copy Failed",description:"Failed to copy URL to clipboard",variant:"destructive"})})},U=yt({mutationFn:async({id:L,action:ne,data:re})=>{if(ne==="update")return Qe("PUT",`/api/urls/${L}`,re);if(ne==="delete")return Qe("DELETE",`/api/urls/${L}`);if(ne==="permanent_delete")return Qe("DELETE",`/api/urls/${L}/permanent`)},onSuccess:()=>{t.invalidateQueries({queryKey:["urls"]}),t.invalidateQueries({queryKey:["/api/campaigns"]}),e({title:"Success",description:"URL updated successfully"})},onError:L=>{e({title:"Error",description:"Failed to update URL",variant:"destructive"}),console.error("URL action failed:",L)}}),G=L=>{const ne=N.find(re=>re.id===L);ne&&U.mutate({id:L,action:"update",data:{name:ne.name,targetUrl:ne.targetUrl,clickLimit:ne.clickLimit,status:"active"}})},$=L=>{const ne=N.find(re=>re.id===L);ne&&U.mutate({id:L,action:"update",data:{name:ne.name,targetUrl:ne.targetUrl,clickLimit:ne.clickLimit,status:"paused"}})},Q=L=>{U.mutate({id:L,action:"delete"})},ae=L=>{U.mutate({id:L,action:"permanent_delete"})},q=L=>{window.open(L.targetUrl,"_blank")},pe=L=>{w(L)},Se=({url:L})=>{const ne=Math.min(100,L.clicks/L.clickLimit*100);return s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:s.jsx("div",{className:`h-2.5 rounded-full ${ne===100?"bg-gray-500":"bg-primary"}`,style:{width:`${ne}%`}})})};return s.jsxs("div",{className:"min-h-screen",children:[s.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"URL Management"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Manage and track all your redirect URLs"})]}),s.jsx("div",{className:"flex space-x-2 mt-4 md:mt-0",children:s.jsx(Pn,{href:"/",children:s.jsx(Y,{variant:"outline",children:"Back to Campaigns"})})})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(Jl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),s.jsx(ye,{placeholder:"Search URLs...",value:n,onChange:C,className:"pl-10"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(Nt,{value:o,onValueChange:l,children:[s.jsx(bt,{className:"w-[150px]",children:s.jsx(Pt,{placeholder:"Status"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"all",children:"All Status"}),s.jsx(X,{value:"active",children:"Active"}),s.jsx(X,{value:"paused",children:"Paused"}),s.jsx(X,{value:"completed",children:"Completed"}),s.jsx(X,{value:"deleted",children:"Deleted"})]})]}),s.jsxs(Nt,{value:d.toString(),onValueChange:L=>f(parseInt(L)),children:[s.jsx(bt,{className:"w-[100px]",children:s.jsx(Pt,{placeholder:"Limit"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"5",children:"5"}),s.jsx(X,{value:"10",children:"10"}),s.jsx(X,{value:"50",children:"50"}),s.jsx(X,{value:"100",children:"100"}),s.jsx(X,{value:"500",children:"500"}),s.jsx(X,{value:"1000",children:"1000"}),s.jsx(X,{value:"2000",children:"2000"}),s.jsx(X,{value:"5000",children:"5000"}),s.jsx(X,{value:"9999",children:"All URLs"})]})]})]})]}),h.length>0&&s.jsxs("div",{className:"mt-4 p-2 bg-gray-50 rounded border flex items-center gap-2",children:[s.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[h.length," selected"]}),s.jsxs("div",{className:"ml-auto flex gap-2",children:[s.jsxs(Y,{size:"sm",variant:"outline",onClick:D,className:"gap-1",children:[s.jsx(Va,{className:"h-3 w-3"}),"Activate"]}),s.jsxs(Y,{size:"sm",variant:"outline",onClick:A,className:"gap-1",children:[s.jsx($s,{className:"h-3 w-3"}),"Pause"]}),s.jsxs(Us,{open:g,onOpenChange:m,children:[s.jsx(Qu,{asChild:!0,children:s.jsxs(Y,{size:"sm",variant:"outline",className:"gap-1 text-red-500 border-red-200 hover:bg-red-50",children:[s.jsx(Sn,{className:"h-3 w-3"}),"Delete"]})}),s.jsxs(Ka,{children:[s.jsxs(Ga,{children:[s.jsx(Qa,{children:"Delete URLs"}),s.jsxs(Xa,{children:["Are you sure you want to delete ",h.length," URLs? This action will mark them as deleted, but they can be restored later."]})]}),s.jsxs(Ya,{children:[s.jsx(Ja,{children:"Cancel"}),s.jsx(Za,{onClick:B,className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]}),s.jsxs(Us,{open:v,onOpenChange:b,children:[s.jsx(Qu,{asChild:!0,children:s.jsxs(Y,{size:"sm",variant:"outline",className:"gap-1 text-red-600 border-red-300 hover:bg-red-50",children:[s.jsx(Sn,{className:"h-3 w-3"}),"Permanent Delete"]})}),s.jsxs(Ka,{children:[s.jsxs(Ga,{children:[s.jsx(Qa,{children:"Permanently Delete URLs"}),s.jsxs(Xa,{children:["Are you sure you want to permanently delete ",h.length," URLs? This action cannot be undone."]})]}),s.jsxs(Ya,{children:[s.jsx(Ja,{children:"Cancel"}),s.jsx(Za,{onClick:F,className:"bg-red-600 hover:bg-red-700",children:"Permanently Delete"})]})]})]})]})]})]}),N.length>0&&h.length===0&&s.jsx("div",{className:"mb-4 p-2 bg-blue-50 rounded-lg border border-blue-200",children:s.jsxs(Y,{size:"sm",variant:"outline",onClick:T,className:"w-full gap-1 border-blue-300 text-blue-700",children:[s.jsx(Uo,{className:"h-3 w-3"}),"Select All URLs on This Page (",N.length,")"]})}),s.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(ma,{children:[s.jsx(ga,{children:s.jsxs(Rt,{children:[s.jsx(Ce,{className:"w-[40px]",children:s.jsx(Un,{checked:N.length>0&&h.length===N.length,onCheckedChange:T,"aria-label":"Select all URLs"})}),s.jsx(Ce,{className:"w-[60px]",children:"ID"}),s.jsx(Ce,{children:"Name"}),s.jsx(Ce,{children:"Target URL"}),s.jsx(Ce,{children:"Campaign"}),s.jsx(Ce,{children:"Status"}),s.jsx(Ce,{children:"Clicks / Limit"}),s.jsx(Ce,{children:"Created"}),s.jsx(Ce,{className:"text-right",children:"Actions"})]})}),s.jsx(va,{children:S?s.jsx(Rt,{children:s.jsx(ge,{colSpan:8,className:"text-center py-8",children:s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"h-10 w-10 rounded-full border-4 border-t-primary border-gray-200 animate-spin mb-2"}),s.jsx("p",{className:"text-gray-500",children:"Loading URLs..."})]})})}):_?s.jsx(Rt,{children:s.jsx(ge,{colSpan:8,className:"text-center py-8 text-red-500",children:"Error loading URLs. Please try again."})}):N.length===0?s.jsx(Rt,{children:s.jsx(ge,{colSpan:8,className:"text-center py-8 text-gray-500",children:"No URLs found. Try adjusting your filters or search."})}):N.map(L=>s.jsxs(Rt,{className:L.status==="deleted"?"opacity-60":"",children:[s.jsx(ge,{children:s.jsx(Un,{checked:h.includes(L.id),onCheckedChange:()=>E(L.id),"aria-label":`Select URL ${L.name}`})}),s.jsx(ge,{className:"font-mono text-xs",children:L.id}),s.jsx(ge,{className:"font-medium",children:L.name}),s.jsx(ge,{className:"max-w-[200px] truncate",children:s.jsxs("a",{href:L.targetUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center gap-1",children:[L.targetUrl,s.jsx(Ds,{className:"h-3 w-3"})]})}),s.jsx(ge,{children:L.campaignId?s.jsx(Pn,{href:`/campaigns/${L.campaignId}`,children:s.jsxs(Ft,{variant:"outline",className:"cursor-pointer hover:bg-gray-100",children:["Campaign #",L.campaignId]})}):s.jsx("span",{className:"text-gray-400 text-sm",children:"No campaign"})}),s.jsx(ge,{children:s.jsx(O,{status:L.status})}),s.jsx(ge,{children:s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("span",{className:"text-sm font-medium",children:[L.clicks," / ",L.clickLimit," / ",L.originalClickLimit]}),L.clicks>=L.clickLimit&&s.jsx(Uo,{className:"h-4 w-4 text-gray-500 ml-1"})]}),s.jsx("span",{className:"text-xs text-gray-500 mb-1",children:"received / required / original"}),s.jsx(Se,{url:L})]})}),s.jsx(ge,{className:"text-gray-500 text-sm",children:Ph(L.createdAt)}),s.jsx(ge,{children:s.jsx("div",{className:"flex justify-end",children:s.jsxs(EN,{children:[s.jsx(ON,{asChild:!0,children:s.jsx(Y,{variant:"ghost",size:"icon",children:s.jsx(fx,{className:"h-4 w-4"})})}),s.jsxs(Bx,{align:"end",children:[s.jsxs(Xn,{onClick:()=>R(L),children:[s.jsx(Uu,{className:"h-4 w-4 mr-2"}),"Copy URL"]}),s.jsxs(Xn,{onClick:()=>q(L),children:[s.jsx(h3,{className:"h-4 w-4 mr-2"}),"Visit Target"]}),s.jsxs(Xn,{onClick:()=>pe(L),children:[s.jsx(Bu,{className:"h-4 w-4 mr-2"}),"Edit URL"]}),s.jsx(Gh,{}),(L.status==="paused"||L.status==="completed")&&s.jsxs(Xn,{onClick:()=>G(L.id),children:[s.jsx(Va,{className:"h-4 w-4 mr-2"}),"Activate"]}),L.status==="active"&&s.jsxs(Xn,{onClick:()=>$(L.id),children:[s.jsx($s,{className:"h-4 w-4 mr-2"}),"Pause"]}),s.jsx(Gh,{}),L.status!=="deleted"&&s.jsxs(Xn,{className:"text-red-500 focus:text-red-500",onClick:()=>Q(L.id),children:[s.jsx(Sn,{className:"h-4 w-4 mr-2"}),"Delete"]}),s.jsxs(Xn,{className:"text-red-600 focus:text-red-600",onClick:()=>ae(L.id),children:[s.jsx(Sn,{className:"h-4 w-4 mr-2"}),"Permanent Delete"]})]})]})})})]},L.id))})]})}),!S&&!_&&N.length>0&&s.jsx("div",{className:"p-4 border-t",children:s.jsx(noe,{currentPage:c,totalPages:P,onPageChange:u})})]})]})}),s.jsx(ti,{open:y!==null,onOpenChange:L=>{L||w(null)},children:s.jsx(Dr,{className:"sm:max-w-[500px]",children:y&&s.jsx(wN,{url:y,onSuccess:()=>{w(null),t.invalidateQueries({queryKey:["urls"]})}})})})]})}function ioe({currentPage:e,totalPages:t,onPageChange:n}){const r=Array.from({length:t},(a,o)=>o+1),i=jc();return s.jsxs("div",{className:"flex items-center justify-center mt-4 gap-1 flex-wrap",children:[s.jsx(Y,{variant:"outline",size:"sm",onClick:()=>n(e-1),disabled:e===1,children:"Previous"}),!i&&r.map(a=>s.jsx(Y,{variant:a===e?"default":"outline",size:"sm",onClick:()=>n(a),className:"w-9 p-0",children:a},a)),i&&s.jsxs("span",{className:"px-2 text-sm",children:["Page ",e," of ",t]}),s.jsx(Y,{variant:"outline",size:"sm",onClick:()=>n(e+1),disabled:e===t,children:"Next"})]})}function aoe(){const{toast:e}=xn(),t=ki();jc();const[n,r]=x.useState(""),[i,a]=x.useState(""),[o,l]=x.useState("all"),[c,u]=x.useState(1),[d,f]=x.useState(10),[h,p]=x.useState([]),[g,m]=x.useState(!1),[v,b]=x.useState(!1),[y,w]=x.useState(null),C=x.useCallback(L=>{r(L.target.value);const ne=setTimeout(()=>{a(L.target.value),u(1)},300);return()=>clearTimeout(ne)},[]),{data:j,isLoading:S,isError:_}=Tt({queryKey:["urls",c,d,i,o],queryFn:async()=>{const L=new URLSearchParams;L.append("page",c.toString()),L.append("limit",d.toString()),i&&L.append("search",i),o!=="all"&&L.append("status",o);const ne=await fetch(`/api/urls?${L.toString()}`);if(!ne.ok)throw new Error("Failed to fetch URLs");return ne.json()}}),N=(j==null?void 0:j.urls)||[],P=j!=null&&j.total?Math.ceil(j.total/d):1,O=({status:L})=>{let ne="outline",re=L.charAt(0).toUpperCase()+L.slice(1);switch(L){case"active":ne="default";break;case"paused":ne="secondary";break;case"completed":ne="outline";break;case"rejected":ne="destructive";break;case"deleted":ne="destructive";break}return s.jsx(Ft,{variant:ne,children:re})},T=()=>{h.length===N.length?p([]):p(N.map(L=>L.id))},E=L=>{h.includes(L)?p(h.filter(ne=>ne!==L)):p([...h,L])},k=yt({mutationFn:async({urlIds:L,action:ne})=>Qe("POST","/api/urls/bulk",{urlIds:L,action:ne}),onSuccess:()=>{t.invalidateQueries({queryKey:["urls"]}),t.invalidateQueries({queryKey:["/api/campaigns"]}),p([]),e({title:"Success",description:"Bulk action completed successfully"})},onError:L=>{e({title:"Error",description:"Failed to perform bulk action",variant:"destructive"}),console.error("Bulk action failed:",L)}}),D=()=>{k.mutate({urlIds:h,action:"activate"})},A=()=>{k.mutate({urlIds:h,action:"pause"})},B=()=>{k.mutate({urlIds:h,action:"delete"}),m(!1)},F=()=>{k.mutate({urlIds:h,action:"permanent_delete"}),b(!1)},R=L=>{const ne=`${window.location.origin}/r/${L.campaignId}/${L.id}`;navigator.clipboard.writeText(ne).then(()=>{e({title:"URL Copied",description:"URL has been copied to clipboard",variant:"success"})}).catch(()=>{e({title:"Copy Failed",description:"Failed to copy URL to clipboard",variant:"destructive"})})},U=yt({mutationFn:async({id:L,action:ne,data:re})=>{if(ne==="update")return Qe("PUT",`/api/urls/${L}`,re);if(ne==="delete")return Qe("DELETE",`/api/urls/${L}`);if(ne==="permanent_delete")return Qe("DELETE",`/api/urls/${L}/permanent`)},onSuccess:()=>{t.invalidateQueries({queryKey:["urls"]}),t.invalidateQueries({queryKey:["/api/campaigns"]}),e({title:"Success",description:"URL updated successfully"})},onError:L=>{e({title:"Error",description:"Failed to update URL",variant:"destructive"}),console.error("URL action failed:",L)}}),G=L=>{const ne=N.find(re=>re.id===L);ne&&U.mutate({id:L,action:"update",data:{name:ne.name,targetUrl:ne.targetUrl,clickLimit:ne.clickLimit,status:"active"}})},$=L=>{const ne=N.find(re=>re.id===L);ne&&U.mutate({id:L,action:"update",data:{name:ne.name,targetUrl:ne.targetUrl,clickLimit:ne.clickLimit,status:"paused"}})},Q=L=>{U.mutate({id:L,action:"delete"})},ae=L=>{U.mutate({id:L,action:"permanent_delete"})},q=L=>{window.open(L.targetUrl,"_blank")},pe=L=>{w(L)},Se=({url:L})=>{const ne=Math.min(100,L.clicks/L.clickLimit*100);return s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2",children:s.jsx("div",{className:`h-2.5 rounded-full ${ne===100?"bg-gray-500":"bg-primary"}`,style:{width:`${ne}%`}})})};return s.jsxs("div",{className:"min-h-screen",children:[s.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50",children:s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-800",children:"URL History"}),s.jsx("p",{className:"text-xs md:text-sm text-gray-500",children:"Manage and track all your redirect URLs"})]}),s.jsx("div",{className:"flex space-x-2 mt-3 md:mt-0 w-full md:w-auto",children:s.jsx(Pn,{href:"/campaigns",className:"w-full md:w-auto",children:s.jsx(Y,{variant:"outline",size:"sm",className:"w-full md:w-auto",children:"Back to Campaigns"})})})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow p-3 mb-4",children:[s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx(Jl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),s.jsx(ye,{placeholder:"Search URLs...",value:n,onChange:C,className:"pl-10"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(Nt,{value:o,onValueChange:l,children:[s.jsx(bt,{className:"flex-1",children:s.jsx(Pt,{placeholder:"Status"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"all",children:"All Status"}),s.jsx(X,{value:"active",children:"Active"}),s.jsx(X,{value:"paused",children:"Paused"}),s.jsx(X,{value:"completed",children:"Completed"}),s.jsx(X,{value:"rejected",children:"Rejected"}),s.jsx(X,{value:"deleted",children:"Deleted"})]})]}),s.jsxs(Nt,{value:d.toString(),onValueChange:L=>f(parseInt(L)),children:[s.jsx(bt,{className:"w-24",children:s.jsx(Pt,{placeholder:"Limit"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"5",children:"5"}),s.jsx(X,{value:"10",children:"10"}),s.jsx(X,{value:"50",children:"50"}),s.jsx(X,{value:"100",children:"100"}),s.jsx(X,{value:"500",children:"500"}),s.jsx(X,{value:"1000",children:"1000"}),s.jsx(X,{value:"2000",children:"2000"}),s.jsx(X,{value:"5000",children:"5000"}),s.jsx(X,{value:"9999",children:"All URLs"})]})]})]})]}),h.length>0&&s.jsxs("div",{className:"mt-3 p-2 bg-gray-50 rounded border flex flex-wrap items-center gap-2",children:[s.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[h.length," selected"]}),s.jsxs("div",{className:"ml-auto flex flex-wrap gap-2",children:[s.jsxs(Y,{size:"sm",variant:"outline",onClick:D,className:"gap-1",children:[s.jsx(Va,{className:"h-3 w-3"}),"Activate"]}),s.jsxs(Y,{size:"sm",variant:"outline",onClick:A,className:"gap-1",children:[s.jsx($s,{className:"h-3 w-3"}),"Pause"]}),s.jsxs(Us,{open:g,onOpenChange:m,children:[s.jsx(Qu,{asChild:!0,children:s.jsxs(Y,{size:"sm",variant:"outline",className:"gap-1 text-red-500 border-red-200 hover:bg-red-50",children:[s.jsx(Sn,{className:"h-3 w-3"}),"Delete"]})}),s.jsxs(Ka,{children:[s.jsxs(Ga,{children:[s.jsx(Qa,{children:"Delete URLs"}),s.jsxs(Xa,{children:["Are you sure you want to delete ",h.length," URLs? This action will mark them as deleted, but they can be restored later."]})]}),s.jsxs(Ya,{children:[s.jsx(Ja,{children:"Cancel"}),s.jsx(Za,{onClick:B,className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]}),s.jsxs(Us,{open:v,onOpenChange:b,children:[s.jsx(Qu,{asChild:!0,children:s.jsxs(Y,{size:"sm",variant:"outline",className:"gap-1 text-red-600 border-red-300 hover:bg-red-50",children:[s.jsx(Sn,{className:"h-3 w-3"}),"Permanent Delete"]})}),s.jsxs(Ka,{children:[s.jsxs(Ga,{children:[s.jsx(Qa,{children:"Permanently Delete URLs"}),s.jsxs(Xa,{children:["Are you sure you want to permanently delete ",h.length," URLs? This action cannot be undone."]})]}),s.jsxs(Ya,{children:[s.jsx(Ja,{children:"Cancel"}),s.jsx(Za,{onClick:F,className:"bg-red-600 hover:bg-red-700",children:"Permanently Delete"})]})]})]})]})]})]}),N.length>0&&s.jsx("div",{className:"mb-3 p-2 bg-blue-50 rounded-lg border border-blue-200",children:s.jsx(Y,{size:"sm",variant:"outline",onClick:T,className:"w-full gap-1 border-blue-300 text-blue-700",children:h.length===N.length?s.jsxs(s.Fragment,{children:[s.jsx(zp,{className:"h-3 w-3"}),"Deselect All URLs"]}):s.jsxs(s.Fragment,{children:[s.jsx(Uo,{className:"h-3 w-3"}),"Select All URLs on This Page (",N.length,")"]})})}),s.jsx("div",{className:"space-y-3",children:S?s.jsx("div",{className:"flex justify-center py-12",children:s.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-t-primary border-gray-200"})}):_?s.jsx("div",{className:"bg-white rounded-lg shadow p-6 text-center text-red-500",children:"Error loading URLs. Please try again."}):N.length===0?s.jsx("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:s.jsxs("div",{className:"flex flex-col items-center text-gray-500",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),s.jsx("p",{children:"No URLs found"})]})}):N.map(L=>s.jsxs(qe,{className:L.status==="deleted"?"opacity-60":"",children:[s.jsx(Xe,{className:"pb-2 pt-3 px-4",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(Un,{checked:h.includes(L.id),onCheckedChange:()=>E(L.id),"aria-label":`Select URL ${L.id}`,className:"mt-1"}),s.jsxs("div",{children:[s.jsx(Ze,{className:"text-base",children:L.name}),s.jsxs(ft,{className:"mt-1 text-xs",children:["ID: ",L.id]})]})]}),s.jsx(O,{status:L.status})]})}),s.jsxs(Ke,{className:"pb-2 pt-0 px-4",children:[s.jsx("div",{className:"text-sm mb-2 truncate",children:s.jsxs("a",{href:L.targetUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center",children:[L.targetUrl,s.jsx(Ds,{className:"h-3 w-3 ml-1 flex-shrink-0"})]})}),L.campaignId&&s.jsx("div",{className:"mb-2",children:s.jsx(Pn,{href:`/campaigns/${L.campaignId}`,children:s.jsxs("span",{className:"text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded-full",children:["Campaign #",L.campaignId]})})}),s.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[s.jsx("span",{className:"text-gray-500 text-xs",children:Ph(L.createdAt)}),s.jsxs("span",{className:"whitespace-nowrap font-medium text-xs",children:[L.clicks," / ",L.clickLimit," / ",L.originalClickLimit]})]}),s.jsx(Se,{url:L})]}),s.jsxs(el,{className:"pt-2 px-4 pb-3 flex justify-between gap-2 border-t flex-wrap",children:[s.jsxs("div",{className:"flex gap-1",children:[s.jsx(Y,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:()=>R(L),children:s.jsx(Uu,{className:"h-4 w-4"})}),s.jsx(Y,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:()=>q(L),children:s.jsx(h3,{className:"h-4 w-4"})}),s.jsx(Y,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0",onClick:()=>pe(L),children:s.jsx(Bu,{className:"h-4 w-4"})})]}),s.jsxs("div",{className:"flex gap-1",children:[L.status==="active"?s.jsxs(Y,{size:"sm",variant:"outline",className:"h-8",onClick:()=>$(L.id),children:[s.jsx($s,{className:"h-3 w-3 mr-1"}),"Pause"]}):L.status==="paused"||L.status==="completed"?s.jsxs(Y,{size:"sm",variant:"outline",className:"h-8",onClick:()=>G(L.id),children:[s.jsx(Va,{className:"h-3 w-3 mr-1"}),"Activate"]}):null,s.jsxs(Y,{size:"sm",variant:"outline",className:"h-8 text-red-600 border-red-200",onClick:L.status!=="deleted"?()=>Q(L.id):()=>ae(L.id),children:[s.jsx(Sn,{className:"h-3 w-3 mr-1"}),L.status!=="deleted"?"Delete":"Permanent"]})]})]})]},L.id))}),N.length>0&&s.jsx(ioe,{currentPage:c,totalPages:P,onPageChange:u})]})}),y&&s.jsx(ti,{open:!!y,onOpenChange:L=>!L&&w(null),children:s.jsx(Dr,{className:"sm:max-w-[500px]",children:s.jsx(wN,{url:y,onSuccess:()=>{t.invalidateQueries({queryKey:["urls"]}),w(null)}})})})]})}function Hm(){const[,e]=Ir(),[t,n]=x.useState(null),[r,i]=If("/r/:campaignId/:urlId"),[a,o]=If("/r/bridge/:campaignId/:urlId"),[l,c]=If("/views/:customPath"),[u,d]=If("/c/:campaignId");let f="";r&&i?f=`/api/urls/${i.urlId}?campaignId=${i.campaignId}`:a&&o?f=`/api/urls/${o.urlId}?campaignId=${o.campaignId}`:l&&c?f=`/api/campaigns/path/${c.customPath}`:u&&d&&(f=`/api/campaigns/${d.campaignId}`);const{data:h,error:p}=Tt({queryKey:[f],enabled:!!f,retry:!1,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,gcTime:0,staleTime:0});return x.useEffect(()=>{if(!h)return;const g=typeof h=="object"&&h!==null&&"targetUrl"in h?h.targetUrl:null;if(!g&&typeof h=="object"&&h!==null&&"id"in h){e(`/campaigns/${h.id}`);return}if(!g){n("Invalid URL or campaign");return}window.location.replace(g)},[h,e]),x.useEffect(()=>{p&&n("This link appears to be invalid or has expired.")},[p]),t?s.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 p-4",children:s.jsxs("div",{className:"w-full max-w-md bg-white rounded-lg shadow p-6 text-center",children:[s.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-red-100 mx-auto mb-4",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("h1",{className:"text-xl font-bold mb-2",children:"Redirection Error"}),s.jsx("p",{className:"text-gray-500 mb-4",children:t}),s.jsx("button",{onClick:()=>e("/"),className:"text-primary hover:underline",children:"Return to homepage"})]})}):null}function soe(){const[e,t]=x.useState(""),[n,r]=x.useState("http2_forced_307"),i=async()=>{if(e)try{const a=await fetch(`/api/campaigns/${e}`);if(!a.ok){alert(`Campaign ${e} not found. Please create it first.`);return}const o=await a.json();await fetch(`/api/campaigns/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...o,redirectMethod:n})});const l=await fetch(`/api/campaigns/${e}/urls`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:`Test URL ${Date.now()}`,targetUrl:"https://www.google.com",clickLimit:1e3,status:"active"})});if(l.ok){const c=await l.json();window.open(`/r/${e}/${c.id}`,"_blank")}}catch(a){console.error("Error creating test URL",a),alert("Failed to create test URL. See console for details.")}};return s.jsxs("div",{className:"container mx-auto py-10",children:[s.jsx("h1",{className:"text-2xl font-bold mb-6",children:"HTTP/2.0 Redirect Performance Tester"}),s.jsxs(qe,{className:"mb-6",children:[s.jsx(Xe,{children:s.jsx(Ze,{children:"Test HTTP/2.0 Redirect Performance"})}),s.jsx(Ke,{children:s.jsxs("div",{className:"grid gap-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(un,{htmlFor:"campaignId",children:"Campaign ID"}),s.jsx(ye,{id:"campaignId",value:e,onChange:a=>t(a.target.value),placeholder:"Enter campaign ID"})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(un,{htmlFor:"redirectMethod",children:"Redirect Method"}),s.jsxs(Nt,{value:n,onValueChange:r,children:[s.jsx(bt,{id:"redirectMethod",children:s.jsx(Pt,{placeholder:"Select redirect method"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"http2_forced_307",children:"HTTP/2.0 Forced 307 (Cloudflare Format)"}),s.jsx(X,{value:"http2_307_temporary",children:"HTTP/2.0 307 Temporary"}),s.jsx(X,{value:"http_307",children:"HTTP 307 Temporary"}),s.jsx(X,{value:"meta_refresh",children:"Meta Refresh"}),s.jsx(X,{value:"double_meta_refresh",children:"Double Meta Refresh"}),s.jsx(X,{value:"direct",children:"Standard 302 Redirect"})]})]})]}),s.jsx(Y,{onClick:i,children:"Create Test URL & Open Redirect"})]})})]}),s.jsxs(qe,{children:[s.jsx(Xe,{children:s.jsx(Ze,{children:"Performance Notes"})}),s.jsx(Ke,{children:s.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"HTTP/2.0 Forced 307"}),": Optimized for zero-delay redirects using Cloudflare-style headers."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"HTTP/2.0 307 Temporary"}),": Minimalist implementation with zero processing overhead."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"HTTP 307 Temporary"}),": Standard HTTP 307 redirect."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Meta Refresh"}),": HTML-based instant redirect using meta tags."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Double Meta Refresh"}),": Two-step meta redirect for compatibility."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Standard 302"}),": Traditional 302 Found redirect."]})]})})]})]})}const ooe=H.object({campaignId:H.number().int().positive("Please select a campaign"),minClickLimit:H.number().int().optional(),maxClickLimit:H.number().int().optional(),active:H.boolean().default(!0)}),loe=H.object({user:H.string().email("Please enter a valid email address"),password:H.string().min(1,"Password is required"),host:H.string().default("imap.gmail.com"),port:H.number().int().positive().default(993),tls:H.boolean().default(!0),whitelistSenders:H.string().optional(),subjectPattern:H.string().min(1,"Subject pattern is required"),orderIdRegex:H.string().min(1,"Order ID regex is required"),urlRegex:H.string().min(1,"URL regex is required"),quantityRegex:H.string().min(1,"Quantity regex is required"),defaultCampaignId:H.number().int().positive("Please select a default campaign"),campaignAssignments:H.array(ooe).default([]),checkInterval:H.number().int().positive().default(6e4),autoDeleteMinutes:H.number().int().min(0).default(0)});function coe(){var G;const{toast:e}=xn(),[t,n]=x.useState(null),[r,i]=x.useState(!1),[a,o]=x.useState(!1),[l,c]=x.useState("30"),[u,d]=x.useState(!1),[f,h]=x.useState(""),[p,g]=x.useState(""),{data:m=[]}=Tt({queryKey:["/api/campaigns"]}),{data:v,isLoading:b,refetch:y}=Tt({queryKey:["/api/gmail-reader/status"],refetchOnWindowFocus:!1,retry:1,staleTime:5e3}),w=Ki({resolver:Gi(loe),defaultValues:{user:"",password:"",host:"imap.gmail.com",port:993,tls:!0,whitelistSenders:"",subjectPattern:"New Order Received (\\d+)",orderIdRegex:"Order Id\\s*:\\s*(\\d+)",urlRegex:"Url\\s*:\\s*(https?:\\/\\/[^\\s]+)",quantityRegex:"Quantity\\s*:\\s*(\\d+)",defaultCampaignId:0,campaignAssignments:[],checkInterval:6e4,autoDeleteMinutes:0}}),{fields:C,append:j,remove:S}=tee({control:w.control,name:"campaignAssignments"});x.useEffect(()=>{if(v&&(n(v),v.config)){const $=v.config,Q=$.whitelistSenders&&$.whitelistSenders.length>0?$.whitelistSenders.join(","):"",ae=$.subjectPattern instanceof RegExp?$.subjectPattern.toString().slice(1,-1):typeof $.subjectPattern=="string"?$.subjectPattern:"",q=$.messagePattern||{},pe=Array.isArray($.campaignAssignments)?$.campaignAssignments.map(Se=>({campaignId:Se.campaignId,minClickLimit:Se.minClickLimit||void 0,maxClickLimit:Se.maxClickLimit||void 0,active:Se.active!==void 0?Se.active:!0})):[];w.reset({user:$.user||"",password:"",host:$.host||"imap.gmail.com",port:$.port||993,tls:$.tls!==void 0?$.tls:!0,whitelistSenders:Q,subjectPattern:ae,orderIdRegex:q.orderIdRegex?q.orderIdRegex.toString().slice(1,-1):"Order Id\\s*:\\s*(\\d+)",urlRegex:q.urlRegex?q.urlRegex.toString().slice(1,-1):"Url\\s*:\\s*(https?:\\/\\/[^\\s]+)",quantityRegex:q.quantityRegex?q.quantityRegex.toString().slice(1,-1):"Quantity\\s*:\\s*(\\d+)",defaultCampaignId:$.defaultCampaignId!==void 0&&$.defaultCampaignId!==null?$.defaultCampaignId:m.length>0?m[0].id:0,campaignAssignments:pe,checkInterval:$.checkInterval||6e4,autoDeleteMinutes:$.autoDeleteMinutes||0})}},[v,m.length]);const _=yt({mutationFn:$=>{const Q=$.whitelistSenders?$.whitelistSenders.split(",").map(pe=>pe.trim()):[],ae=$.campaignAssignments.map(pe=>({...pe,minClickLimit:pe.minClickLimit||void 0,maxClickLimit:pe.maxClickLimit||void 0,active:pe.active!==void 0?pe.active:!0})),q={user:$.user,password:$.password,host:$.host,port:$.port,tls:$.tls,whitelistSenders:Q,subjectPattern:$.subjectPattern,messagePattern:{orderIdRegex:$.orderIdRegex,urlRegex:$.urlRegex,quantityRegex:$.quantityRegex},defaultCampaignId:$.defaultCampaignId,campaignAssignments:ae,checkInterval:$.checkInterval,autoDeleteMinutes:$.autoDeleteMinutes};return Qe("POST","/api/gmail-reader/config",q)},onSuccess:()=>{e({title:"Configuration Updated",description:"Gmail reader configuration has been updated successfully"}),y()},onError:$=>{e({title:"Configuration Failed",description:"Failed to update Gmail reader configuration",variant:"destructive"}),console.error("Gmail reader config update failed:",$)}}),N=yt({mutationFn:$=>Qe("POST","/api/gmail-reader/test-connection",$),onSuccess:$=>{$.success?e({title:"Connection Successful",description:$.message,variant:"success"}):e({title:"Connection Failed",description:$.message,variant:"destructive"})},onError:$=>{e({title:"Connection Test Failed",description:"Failed to test Gmail connection",variant:"destructive"}),console.error("Gmail connection test failed:",$)}}),P=()=>{const $=w.getValues();if(!$.user||!$.password){e({title:"Missing Credentials",description:"Please provide both email and password to test the connection",variant:"destructive"});return}N.mutate({user:$.user,password:$.password,host:$.host,port:$.port,tls:$.tls})},O=yt({mutationFn:()=>Qe("POST","/api/gmail-reader/start"),onSuccess:()=>{e({title:"Gmail Reader Started",description:"Gmail reader has been started successfully"}),y()},onError:$=>{e({title:"Start Failed",description:"Failed to start Gmail reader",variant:"destructive"}),console.error("Gmail reader start failed:",$)}}),T=yt({mutationFn:()=>Qe("POST","/api/gmail-reader/stop"),onSuccess:()=>{e({title:"Gmail Reader Stopped",description:"Gmail reader has been stopped successfully"}),y()},onError:$=>{e({title:"Stop Failed",description:"Failed to stop Gmail reader",variant:"destructive"}),console.error("Gmail reader stop failed:",$)}}),E=yt({mutationFn:()=>Qe("POST","/api/gmail-reader/reset-tracking"),onSuccess:$=>{e({title:"Tracking Reset Complete",description:$.message,variant:"success"}),y()},onError:$=>{e({title:"Reset Failed",description:"Failed to reset email tracking system",variant:"destructive"}),console.error("Gmail tracking reset failed:",$)}}),k=yt({mutationFn:$=>Qe("POST","/api/gmail-reader/cleanup-logs",$),onSuccess:$=>{e({title:"Logs Cleaned Up",description:`Successfully cleaned up email logs: removed ${$.entriesRemoved}, kept ${$.entriesKept}`}),i(!1)},onError:$=>{e({title:"Cleanup Failed",description:"Failed to clean up email logs",variant:"destructive"}),console.error("Gmail logs cleanup failed:",$)}}),D=yt({mutationFn:$=>Qe("POST","/api/system/full-cleanup",$),onSuccess:$=>{const Q=$.result,ae=[`${Q.campaignsDeleted} campaigns`,`${Q.urlsDeleted} URLs`,`${Q.originalUrlRecordsDeleted} original URL records`,`${Q.youtubeUrlRecordsDeleted} YouTube URL records`,`${Q.trafficstarCampaignsDeleted} TrafficStar campaigns`,`${Q.urlBudgetLogsDeleted} URL budget logs`,`${Q.urlClickRecordsDeleted} URL click records`,`${Q.urlClickLogsDeleted||0} URL click logs`,`${Q.campaignClickRecordsDeleted} campaign click records`,`${Q.emailLogsRemoved} email logs`].join(", ");e({title:"System Cleanup Complete",description:`Successfully deleted: ${ae}`}),o(!1),Cs.invalidateQueries({queryKey:["/api/campaigns"]})},onError:$=>{e({title:"System Cleanup Failed",description:"Failed to perform system cleanup. Please try again.",variant:"destructive"}),console.error("System cleanup failed:",$)}}),A=()=>{const $={};u?(f&&($.beforeDate=f),p&&($.afterDate=p)):l&&($.daysToKeep=l),k.mutate($)},[B,F]=x.useState(""),R=()=>{if(B!=="DELETE ALL DATA"){e({title:"Confirmation Failed",description:"Please type 'DELETE ALL DATA' to confirm this destructive action.",variant:"destructive"});return}D.mutate({confirmText:B})},U=$=>{_.mutate($)};return s.jsx("div",{className:"min-h-screen",children:s.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50",style:{paddingBottom:"5rem"},children:s.jsxs("div",{className:"p-4 md:p-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl md:text-2xl font-bold text-gray-800",children:"Gmail Reader Settings"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Configure automatic URL import from Gmail"})]}),s.jsxs("div",{className:"mt-4 md:mt-0 flex space-x-2",children:[s.jsxs(Y,{variant:"outline",size:"sm",className:"bg-gray-50 text-gray-700 border-gray-200 mr-2",onClick:()=>i(!0),children:[s.jsx(g3,{className:"h-4 w-4 mr-2"}),"Cleanup Logs"]}),s.jsxs(Y,{variant:"outline",size:"sm",className:"bg-amber-50 text-amber-700 border-amber-200 mr-2",onClick:()=>E.mutate(),disabled:E.isPending,children:[s.jsx(Zj,{className:"h-4 w-4 mr-2"}),"Reset Tracking"]}),s.jsxs(Y,{variant:"outline",size:"sm",className:"bg-amber-50 text-amber-700 border-amber-200 mr-2",onClick:()=>o(!0),children:[s.jsx(Ul,{className:"h-4 w-4 mr-2"}),"Full System Cleanup"]}),t!=null&&t.isRunning?s.jsxs(Y,{variant:"outline",size:"sm",className:"bg-red-50 text-red-700 border-red-200",onClick:()=>T.mutate(),disabled:T.isPending,children:[T.isPending?s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}):s.jsx(nQ,{className:"mr-2 h-4 w-4"}),"Stop Gmail Reader"]}):s.jsxs(Y,{variant:"outline",size:"sm",className:"bg-green-50 text-green-700 border-green-200",onClick:()=>O.mutate(),disabled:O.isPending,children:[O.isPending?s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}):s.jsx(Va,{className:"mr-2 h-4 w-4"}),"Start Gmail Reader"]}),s.jsxs(Y,{variant:"outline",size:"sm",className:"bg-blue-50 text-blue-700 border-blue-200",onClick:()=>y(),disabled:b,children:[s.jsx(Zl,{className:`mr-2 h-4 w-4 ${b?"animate-spin":""}`}),"Refresh Status"]})]})]}),s.jsxs(qe,{className:"mb-6",children:[s.jsxs(Xe,{className:"pb-2",children:[s.jsx(Ze,{children:"Gmail Reader Status"}),s.jsx(ft,{children:"Current status of the Gmail integration"})]}),s.jsx(Ke,{children:b?s.jsx("div",{className:"flex items-center justify-center py-4",children:s.jsx(We,{className:"h-8 w-8 animate-spin text-gray-400"})}):t?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ft,{variant:t.isRunning?"success":"destructive",className:"text-xs px-2 py-1",children:t.isRunning?"RUNNING":"STOPPED"}),t.config&&s.jsxs("span",{className:"text-sm text-gray-500",children:["Checking every ",Math.round(t.config.checkInterval/1e3)," seconds"]}),t.config&&t.config.autoDeleteMinutes>0&&s.jsxs("span",{className:"text-sm text-gray-500",children:["| Auto-delete after ",t.config.autoDeleteMinutes," minutes"]})]}),t.config&&s.jsxs("div",{className:"text-sm mt-2",children:[s.jsxs("div",{className:"mb-1",children:[s.jsx("span",{className:"font-semibold text-gray-700",children:"Email Account:"})," ",s.jsx("span",{className:"text-gray-600",children:t.config.user||"Not configured"})]}),s.jsxs("div",{className:"mb-1",children:[s.jsx("span",{className:"font-semibold text-gray-700",children:"Target Campaign:"})," ",s.jsx("span",{className:"text-gray-600",children:((G=m.find($=>$.id===t.config.defaultCampaignId))==null?void 0:G.name)||t.config.defaultCampaignId})]})]})]}):s.jsx("div",{className:"text-center py-4 text-gray-500",children:"Unable to retrieve status information"})})]}),s.jsxs(qe,{children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"Gmail Configuration"}),s.jsx(ft,{children:"Configure your Gmail account to automatically add URLs from emails"})]}),s.jsx(Ke,{children:s.jsx(Da,{...w,children:s.jsxs("form",{onSubmit:w.handleSubmit(U),className:"space-y-8",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(Ee,{control:w.control,name:"user",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Gmail Email"}),s.jsx(ke,{children:s.jsx(ye,{placeholder:"example@gmail.com",...$})}),s.jsx(it,{children:"Your Gmail email address"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:w.control,name:"password",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Password"}),s.jsx(ke,{children:s.jsx(ye,{type:"password",placeholder:"App password",...$})}),s.jsx(it,{children:"Use an app-specific password (not your main Gmail password)"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:w.control,name:"host",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"IMAP Host"}),s.jsx(ke,{children:s.jsx(ye,{...$})}),s.jsx(it,{children:"Gmail's IMAP server address"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:w.control,name:"port",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"IMAP Port"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",...$,onChange:Q=>$.onChange(Number(Q.target.value))})}),s.jsx(it,{children:"Gmail's IMAP port (993 for SSL/TLS)"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:w.control,name:"tls",render:({field:$})=>s.jsxs(Te,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[s.jsx(ke,{children:s.jsx(uu,{checked:$.value,onCheckedChange:$.onChange})}),s.jsxs("div",{className:"space-y-1 leading-none",children:[s.jsx(Pe,{children:"Use SSL/TLS"}),s.jsx(it,{children:"Enable secure connection (recommended)"})]})]})}),s.jsx(Ee,{control:w.control,name:"defaultCampaignId",render:({field:$})=>{var Q,ae;return s.jsxs(Te,{children:[s.jsx(Pe,{children:"Default Campaign"}),s.jsxs(Nt,{onValueChange:q=>$.onChange(Number(q)),defaultValue:(Q=$.value)==null?void 0:Q.toString(),value:(ae=$.value)==null?void 0:ae.toString(),children:[s.jsx(ke,{children:s.jsx(bt,{children:s.jsx(Pt,{placeholder:"Select a campaign"})})}),s.jsx(wt,{children:m.map(q=>s.jsxs(X,{value:q.id.toString(),children:[q.name," (ID: ",q.id,")"]},q.id))})]}),s.jsx(it,{children:"Default campaign where new URLs will be added if no campaign assignments match"}),s.jsx(De,{})]})}}),s.jsxs("div",{className:"col-span-2 mb-4 mt-8",children:[s.jsx("h3",{className:"text-lg font-medium mb-2",children:"Campaign Assignments"}),s.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Assign URLs to specific campaigns based on click quantity limits"}),s.jsxs("div",{className:"border rounded-md p-4 mb-4 bg-gray-50",children:[C.length===0?s.jsx("div",{className:"text-center py-4 text-gray-500",children:"No campaign assignments. Add one below."}):s.jsx("div",{className:"space-y-4",children:C.map(($,Q)=>s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-10 gap-4 p-4 border rounded-md bg-white relative",children:[s.jsx(Y,{type:"button",variant:"ghost",size:"icon",className:"absolute right-2 top-2",onClick:()=>S(Q),children:s.jsx(JY,{className:"h-4 w-4"})}),s.jsx("div",{className:"md:col-span-4",children:s.jsx(Ee,{control:w.control,name:`campaignAssignments.${Q}.campaignId`,render:({field:ae})=>{var q,pe;return s.jsxs(Te,{children:[s.jsx(Pe,{children:"Campaign"}),s.jsxs(Nt,{onValueChange:Se=>ae.onChange(Number(Se)),defaultValue:(q=ae.value)==null?void 0:q.toString(),value:(pe=ae.value)==null?void 0:pe.toString(),children:[s.jsx(ke,{children:s.jsx(bt,{children:s.jsx(Pt,{placeholder:"Select a campaign"})})}),s.jsx(wt,{children:m.map(Se=>s.jsxs(X,{value:Se.id.toString(),children:[Se.name," (ID: ",Se.id,")"]},Se.id))})]}),s.jsx(De,{})]})}})}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(Ee,{control:w.control,name:`campaignAssignments.${Q}.minClickLimit`,render:({field:ae})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Min Clicks"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",placeholder:"Min clicks",...ae,onChange:q=>ae.onChange(q.target.value===""?void 0:Number(q.target.value))})}),s.jsx(De,{})]})})}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(Ee,{control:w.control,name:`campaignAssignments.${Q}.maxClickLimit`,render:({field:ae})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Max Clicks"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",placeholder:"Max clicks",...ae,onChange:q=>ae.onChange(q.target.value===""?void 0:Number(q.target.value))})}),s.jsx(De,{})]})})}),s.jsx("div",{className:"md:col-span-2 flex items-end mb-1",children:s.jsx(Ee,{control:w.control,name:`campaignAssignments.${Q}.active`,render:({field:ae})=>s.jsxs(Te,{className:"flex flex-row items-center justify-start space-x-3 space-y-0",children:[s.jsx(ke,{children:s.jsx(uu,{checked:ae.value,onCheckedChange:ae.onChange})}),s.jsx("div",{className:"space-y-1 leading-none",children:s.jsx(Pe,{children:"Active"})})]})})})]},$.id))}),s.jsxs(Y,{type:"button",variant:"outline",className:"mt-4",onClick:()=>j({campaignId:m.length>0?m[0].id:0,minClickLimit:void 0,maxClickLimit:void 0,active:!0}),children:[s.jsx(m3,{className:"h-4 w-4 mr-2"}),"Add Campaign Assignment"]})]})]}),s.jsx(Ee,{control:w.control,name:"whitelistSenders",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Whitelist Senders"}),s.jsx(ke,{children:s.jsx(ye,{placeholder:"sender@example.com,support@domain.com",...$})}),s.jsx(it,{children:"Comma-separated list of allowed email senders"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:w.control,name:"subjectPattern",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Subject Pattern"}),s.jsx(ke,{children:s.jsx(ye,{placeholder:"New Order Received (\\d+)",...$})}),s.jsx(it,{children:"Regular expression to match email subject"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:w.control,name:"orderIdRegex",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Order ID Pattern"}),s.jsx(ke,{children:s.jsx(ye,{...$})}),s.jsx(it,{children:"Regex to extract order ID from email body"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:w.control,name:"urlRegex",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"URL Pattern"}),s.jsx(ke,{children:s.jsx(ye,{...$})}),s.jsx(it,{children:"Regex to extract URL from email body"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:w.control,name:"quantityRegex",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Quantity Pattern"}),s.jsx(ke,{children:s.jsx(ye,{...$})}),s.jsx(it,{children:"Regex to extract click limit from email body"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:w.control,name:"checkInterval",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Check Interval (ms)"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",...$,onChange:Q=>$.onChange(Number(Q.target.value))})}),s.jsx(it,{children:"How often to check emails (default: 60000 ms = 1 minute)"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:w.control,name:"autoDeleteMinutes",render:({field:$})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Auto-Delete Processed Emails (minutes)"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",...$,onChange:Q=>$.onChange(Number(Q.target.value)),min:"0",max:"10080"})}),s.jsx(it,{children:"Minutes after processing when emails will be automatically deleted. Recommended values: 60 (1 hour), 1440 (1 day), 10080 (1 week). Set to 0 to disable auto-deletion."}),s.jsx(De,{})]})})]}),s.jsxs(el,{className:"px-0 flex justify-between",children:[s.jsxs(Y,{type:"button",variant:"outline",className:"mr-2",onClick:P,disabled:N.isPending,children:[N.isPending?s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}):s.jsx(XY,{className:"mr-2 h-4 w-4"}),"Check Configuration"]}),s.jsxs(Y,{type:"submit",className:"w-full md:w-auto",disabled:_.isPending,children:[_.isPending&&s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),s.jsx(rQ,{className:"mr-2 h-4 w-4"}),"Save Configuration"]})]})]})})})]}),s.jsx(ti,{open:r,onOpenChange:i,children:s.jsxs(Dr,{className:"sm:max-w-[500px]",children:[s.jsxs(Ji,{children:[s.jsx(ea,{children:"Clean Up Email Logs"}),s.jsx(Do,{children:"Remove records of processed emails to free up space"})]}),s.jsx("div",{className:"py-4",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(uu,{id:"custom-date-range",checked:u,onCheckedChange:d,className:"mr-2"}),s.jsx("label",{htmlFor:"custom-date-range",className:"cursor-pointer",children:"Use custom date range"})]}),u?s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-1 block",children:"After Date (Optional)"}),s.jsx(ye,{type:"date",className:"col-span-3",value:p,onChange:$=>g($.target.value)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Before Date (Optional)"}),s.jsx(ye,{type:"date",className:"col-span-3",value:f,onChange:$=>h($.target.value)})]})]}):s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Keep Logs For Last N Days"}),s.jsx(ye,{type:"number",min:"0",placeholder:"30",value:l,onChange:$=>c($.target.value)}),s.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Logs older than this many days will be removed. Set to 0 to remove all logs."})]})]})}),s.jsxs($a,{children:[s.jsx(Y,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),s.jsxs(Y,{onClick:A,disabled:k.isPending,children:[k.isPending&&s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Clean Up Logs"]})]})]})}),s.jsx(ti,{open:a,onOpenChange:o,children:s.jsxs(Dr,{className:"sm:max-w-[500px]",children:[s.jsxs(Ji,{children:[s.jsx(ea,{className:"text-red-600",children:"Full System Cleanup"}),s.jsx(Do,{children:"This will delete ALL campaigns, URLs, and associated data! This action cannot be undone."})]}),s.jsx("div",{className:"py-4",children:s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium mb-2 block text-red-500",children:"Type DELETE ALL DATA to confirm"}),s.jsx(ye,{type:"text",placeholder:"DELETE ALL DATA",className:"border-red-300",value:B,onChange:$=>F($.target.value)})]})})}),s.jsxs($a,{children:[s.jsx(Y,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),s.jsxs(Y,{variant:"destructive",onClick:R,disabled:D.isPending,children:[D.isPending?s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}):s.jsx(Ul,{className:"mr-2 h-4 w-4"}),"Delete All Data"]})]})]})})]})})})}function uoe(){const[e,t]=x.useState(!1),[n,r]=x.useState(null),i=async()=>{try{t(!0),r(null);const a=await fetch("/api/system/migrate-decimal-multiplier",{method:"POST",headers:{"Content-Type":"application/json"}}),o=await a.json();a.ok?(r({success:!0,message:o.message||o.details||"Migration completed successfully"}),nn({title:"Migration Successful",description:o.message||"Decimal multiplier migration completed successfully"})):(r({success:!1,message:o.message||"Migration failed"}),nn({title:"Migration Failed",description:o.message||"Failed to run the decimal multiplier migration",variant:"destructive"}))}catch(a){r({success:!1,message:a instanceof Error?a.message:"Migration failed with an unknown error"}),nn({title:"Migration Error",description:a instanceof Error?a.message:"An unexpected error occurred",variant:"destructive"})}finally{t(!1)}};return s.jsxs(qe,{className:"mt-8",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"Database Migration: Decimal Multiplier Support"}),s.jsx(ft,{children:"Update the database schema to support decimal multipliers (like 1.5, 2.33). This is a one-time migration."})]}),s.jsx(Ke,{children:n&&s.jsxs(yc,{className:n.success?"bg-green-50":"bg-red-50",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[n.success?s.jsx(d3,{className:"h-4 w-4 text-green-600"}):s.jsx("div",{className:"h-4 w-4 text-red-600",children:"!"}),s.jsx(zd,{children:n.success?"Success":"Error"})]}),s.jsx(xc,{children:n.message})]})}),s.jsx(el,{children:s.jsx(Y,{onClick:i,disabled:e,variant:"outline",children:e?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Running Migration..."]}):"Run Decimal Multiplier Migration"})})]})}function doe(){const[e,t]=x.useState(!1),[n,r]=x.useState(null),i=async()=>{try{t(!0),r(null);const a=await fetch("/api/system/migrate-traffic-sender",{method:"POST",headers:{"Content-Type":"application/json"}}),o=await a.json();a.ok&&o.success?(r({success:!0,message:o.message||"Traffic Sender fields migration completed successfully"}),nn({title:"Migration Successful",description:o.message||"Traffic Sender fields migration completed successfully"})):(r({success:!1,message:o.error||o.message||"Migration failed"}),nn({title:"Migration Failed",description:o.error||o.message||"Failed to run the Traffic Sender fields migration",variant:"destructive"}))}catch(a){r({success:!1,message:a instanceof Error?a.message:"Migration failed with an unknown error"}),nn({title:"Migration Error",description:a instanceof Error?a.message:"An unexpected error occurred",variant:"destructive"})}finally{t(!1)}};return s.jsxs(qe,{className:"mt-4",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"Database Migration: Traffic Sender Fields"}),s.jsx(ft,{children:"Update the database schema to support the Traffic Sender feature. This migration adds the necessary fields to enable the Traffic Sender functionality."})]}),s.jsx(Ke,{children:n&&s.jsxs(yc,{className:n.success?"bg-green-50":"bg-red-50",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[n.success?s.jsx(d3,{className:"h-4 w-4 text-green-600"}):s.jsx("div",{className:"h-4 w-4 text-red-600",children:"!"}),s.jsx(zd,{children:n.success?"Success":"Error"})]}),s.jsx(xc,{children:n.message})]})}),s.jsx(el,{children:s.jsx(Y,{onClick:i,disabled:e,variant:"outline",children:e?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Running Migration..."]}):"Run Traffic Sender Fields Migration"})})]})}const L1=!1,foe={isAuthenticated:L1,isLoading:!1,verifyApiKey:async()=>{},logout:async()=>{}},Az=x.createContext(foe);function qx(){return x.useContext(Az)}function hoe({children:e}){const[t,n]=x.useState(L1),[r,i]=x.useState(!L1);x.useEffect(()=>{(async()=>{try{const u=await Ut.get("/api/auth/status");n(u.data.authenticated)}catch(u){console.error("Error checking authentication status:",u),n(!1)}finally{i(!1)}})()},[]);const l={isAuthenticated:t,isLoading:r,verifyApiKey:async c=>{i(!0);try{const u=await Ut.post("/api/auth/verify-key",{apiKey:c});n(u.data.authenticated)}catch(u){throw console.error("API key verification error:",u),n(!1),u}finally{i(!1)}},logout:async()=>{i(!0);try{await Ut.post("/api/auth/logout"),n(!1),typeof window<"u"&&(window.location.href="/login")}catch(c){console.error("Logout error:",c)}finally{i(!1)}}};return s.jsx(Az.Provider,{value:l,children:e})}function poe(){const[e,t]=x.useState(""),[n,r]=x.useState(""),[i,a]=x.useState(""),[o,l]=x.useState(!1),{logout:c}=qx(),u=async()=>{if(!e||!n||!i){nn({title:"All fields are required",description:"Please fill in all fields.",variant:"destructive"});return}if(n!==i){nn({title:"Keys do not match",description:"The new key and confirmation key must match.",variant:"destructive"});return}try{l(!0);const d=await Qe("POST","/api/auth/change-key",{currentKey:e,newKey:n,confirmNewKey:i});if(d.ok)nn({title:"API Key Changed",description:"Your API key was successfully updated. You will need to log in again with the new key."}),t(""),r(""),a(""),setTimeout(()=>{c().then(()=>{window.location.href="/login"})},3e3);else{const f=await d.json();nn({title:"Change Failed",description:f.message||"Failed to change the API key. Please check your current key.",variant:"destructive"})}}catch(d){nn({title:"Error",description:d instanceof Error?d.message:"An unexpected error occurred",variant:"destructive"})}finally{l(!1)}};return s.jsxs(qe,{className:"mb-6",children:[s.jsxs(Xe,{children:[s.jsxs(Ze,{className:"flex items-center",children:[s.jsx(qY,{className:"mr-2 h-5 w-5"}),"API Key Management"]}),s.jsx(ft,{children:"Change your application's API security key. You will need to log in with the new key after changing."})]}),s.jsx(Ke,{children:s.jsxs("div",{className:"grid gap-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(un,{htmlFor:"current-key",children:"Current API Key"}),s.jsx(ye,{id:"current-key",type:"password",value:e,onChange:d=>t(d.target.value),placeholder:"Enter your current API key"})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(un,{htmlFor:"new-key",children:"New API Key"}),s.jsx(ye,{id:"new-key",type:"password",value:n,onChange:d=>r(d.target.value),placeholder:"Enter a new API key"})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(un,{htmlFor:"confirm-new-key",children:"Confirm New API Key"}),s.jsx(ye,{id:"confirm-new-key",type:"password",value:i,onChange:d=>a(d.target.value),placeholder:"Confirm your new API key"})]}),s.jsx(Y,{onClick:u,disabled:o||!e||!n||!i,children:o?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Changing API Key..."]}):"Change API Key"})]})})]})}function moe(e,t=[]){let n=[];function r(a,o){const l=x.createContext(o),c=n.length;n=[...n,o];function u(f){const{scope:h,children:p,...g}=f,m=(h==null?void 0:h[e][c])||l,v=x.useMemo(()=>g,Object.values(g));return s.jsx(m.Provider,{value:v,children:p})}function d(f,h){const p=(h==null?void 0:h[e][c])||l,g=x.useContext(p);if(g)return g;if(o!==void 0)return o;throw new Error(`\`${f}\` must be used within \`${a}\``)}return u.displayName=a+"Provider",[u,d]}const i=()=>{const a=n.map(o=>x.createContext(o));return function(l){const c=(l==null?void 0:l[e])||a;return x.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return i.scopeName=e,[r,goe(i,...t)]}function goe(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(a){const o=r.reduce((l,{useScope:c,scopeName:u})=>{const f=c(a)[`__scope${u}`];return{...l,...f}},{});return x.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return n.scopeName=t.scopeName,n}var RN="Progress",MN=100,[voe,l$e]=moe(RN),[yoe,xoe]=voe(RN),Rz=x.forwardRef((e,t)=>{const{__scopeProgress:n,value:r=null,max:i,getValueLabel:a=boe,...o}=e;(i||i===0)&&!WE(i)&&console.error(woe(`${i}`,"Progress"));const l=WE(i)?i:MN;r!==null&&!HE(r,l)&&console.error(joe(`${r}`,"Progress"));const c=HE(r,l)?r:null,u=$v(c)?a(c,l):void 0;return s.jsx(yoe,{scope:n,value:c,max:l,children:s.jsx(Me.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":$v(c)?c:void 0,"aria-valuetext":u,role:"progressbar","data-state":$z(c,l),"data-value":c??void 0,"data-max":l,...o,ref:t})})});Rz.displayName=RN;var Mz="ProgressIndicator",Dz=x.forwardRef((e,t)=>{const{__scopeProgress:n,...r}=e,i=xoe(Mz,n);return s.jsx(Me.div,{"data-state":$z(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...r,ref:t})});Dz.displayName=Mz;function boe(e,t){return`${Math.round(e/t*100)}%`}function $z(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}function $v(e){return typeof e=="number"}function WE(e){return $v(e)&&!isNaN(e)&&e>0}function HE(e,t){return $v(e)&&!isNaN(e)&&e<=t&&e>=0}function woe(e,t){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${MN}\`.`}function joe(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:
/var/www/UrlCampaignTracker/dist/public/assets/index-B823haLt.js:In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function C9(e,t){if(e){if(typeof e=="string")return lC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lC(e,t)}}function oRe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function lRe(e){if(Array.isArray(e))return lC(e)}function lC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function MM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MM(Object(n),!0).forEach(function(r){Le(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Le(e,t,n){return t=_9(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _9(e){var t=cRe(e,"string");return wd(t)=="symbol"?t:t+""}function cRe(e,t){if(wd(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(wd(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var uRe={xAxis:["bottom","top"],yAxis:["left","right"]},dRe={width:"100%",height:"100%"},N9={x:0,y:0};function ag(e){return e}var fRe=function(t,n){return n==="horizontal"?t.x:n==="vertical"?t.y:n==="centric"?t.angle:t.radius},hRe=function(t,n,r,i){var a=n.find(function(d){return d&&d.index===r});if(a){if(t==="horizontal")return{x:a.coordinate,y:i.y};if(t==="vertical")return{x:i.x,y:a.coordinate};if(t==="centric"){var o=a.coordinate,l=i.radius;return te(te(te({},i),Vn(i.cx,i.cy,l,o)),{},{angle:o,radius:l})}var c=a.coordinate,u=i.angle;return te(te(te({},i),Vn(i.cx,i.cy,c,u)),{},{angle:u,radius:c})}return N9},A0=function(t,n){var r=n.graphicalItems,i=n.dataStartIndex,a=n.dataEndIndex,o=(r??[]).reduce(function(l,c){var u=c.props.data;return u&&u.length?[].concat(jd(l),jd(u)):l},[]);return o.length>0?o:t&&t.length&&de(i)&&de(a)?t.slice(i,a+1):[]};function P9(e){return e==="number"?[0,"auto"]:void 0}var cC=function(t,n,r,i){var a=t.graphicalItems,o=t.tooltipAxis,l=A0(n,t);return r<0||!a||!a.length||r>=l.length?null:a.reduce(function(c,u){var d,f=(d=u.props.data)!==null&&d!==void 0?d:n;f&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=r&&(f=f.slice(t.dataStartIndex,t.dataEndIndex+1));var h;if(o.dataKey&&!o.allowDuplicatedCategory){var p=f===void 0?l:f;h=Iv(p,o.dataKey,i)}else h=f&&f[r]||l[r];return h?[].concat(jd(c),[xH(u,h)]):c},[])},DM=function(t,n,r,i){var a=i||{x:t.chartX,y:t.chartY},o=fRe(a,r),l=t.orderedTooltipTicks,c=t.tooltipAxis,u=t.tooltipTicks,d=yCe(o,l,u,c);if(d>=0&&u){var f=u[d]&&u[d].value,h=cC(t,n,d,f),p=hRe(r,l,d,a);return{activeTooltipIndex:d,activeLabel:f,activePayload:h,activeCoordinate:p}}return null},pRe=function(t,n){var r=n.axes,i=n.graphicalItems,a=n.axisType,o=n.axisIdKey,l=n.stackGroups,c=n.dataStartIndex,u=n.dataEndIndex,d=t.layout,f=t.children,h=t.stackOffset,p=gH(d,a);return r.reduce(function(g,m){var v,b=m.type.defaultProps!==void 0?te(te({},m.type.defaultProps),m.props):m.props,y=b.type,w=b.dataKey,C=b.allowDataOverflow,j=b.allowDuplicatedCategory,S=b.scale,_=b.ticks,N=b.includeHidden,P=b[o];if(g[P])return g;var O=A0(t.data,{graphicalItems:i.filter(function(Q){var ae,q=o in Q.props?Q.props[o]:(ae=Q.type.defaultProps)===null||ae===void 0?void 0:ae[o];return q===P}),dataStartIndex:c,dataEndIndex:u}),T=O.length,E,k,D;UAe(b.domain,C,y)&&(E=NS(b.domain,null,C),p&&(y==="number"||S!=="auto")&&(D=ah(O,w,"category")));var A=P9(y);if(!E||E.length===0){var B,F=(B=b.domain)!==null&&B!==void 0?B:A;if(w){if(E=ah(O,w,y),y==="category"&&p){var R=sde(E);j&&R?(k=E,E=Sy(0,T)):j||(E=dR(F,E,m).reduce(function(Q,ae){return Q.indexOf(ae)>=0?Q:[].concat(jd(Q),[ae])},[]))}else if(y==="category")j?E=E.filter(function(Q){return Q!==""&&!lt(Q)}):E=dR(F,E,m).reduce(function(Q,ae){return Q.indexOf(ae)>=0||ae===""||lt(ae)?Q:[].concat(jd(Q),[ae])},[]);else if(y==="number"){var U=SCe(O,i.filter(function(Q){var ae,q,pe=o in Q.props?Q.props[o]:(ae=Q.type.defaultProps)===null||ae===void 0?void 0:ae[o],Se="hide"in Q.props?Q.props.hide:(q=Q.type.defaultProps)===null||q===void 0?void 0:q.hide;return pe===P&&(N||!Se)}),w,a,d);U&&(E=U)}p&&(y==="number"||S!=="auto")&&(D=ah(O,w,"category"))}else p?E=Sy(0,T):l&&l[P]&&l[P].hasStack&&y==="number"?E=h==="expand"?[0,1]:yH(l[P].stackGroups,c,u):E=mH(O,i.filter(function(Q){var ae=o in Q.props?Q.props[o]:Q.type.defaultProps[o],q="hide"in Q.props?Q.props.hide:Q.type.defaultProps.hide;return ae===P&&(N||!q)}),y,d,!0);if(y==="number")E=sC(f,E,P,a,_),F&&(E=NS(F,E,C));else if(y==="category"&&F){var G=F,$=E.every(function(Q){return G.indexOf(Q)>=0});$&&(E=G)}}return te(te({},g),{},Le({},P,te(te({},b),{},{axisType:a,domain:E,categoricalDomain:D,duplicateDomain:k,originalDomain:(v=b.domain)!==null&&v!==void 0?v:A,isCategorical:p,layout:d})))},{})},mRe=function(t,n){var r=n.graphicalItems,i=n.Axis,a=n.axisType,o=n.axisIdKey,l=n.stackGroups,c=n.dataStartIndex,u=n.dataEndIndex,d=t.layout,f=t.children,h=A0(t.data,{graphicalItems:r,dataStartIndex:c,dataEndIndex:u}),p=h.length,g=gH(d,a),m=-1;return r.reduce(function(v,b){var y=b.type.defaultProps!==void 0?te(te({},b.type.defaultProps),b.props):b.props,w=y[o],C=P9("number");if(!v[w]){m++;var j;return g?j=Sy(0,p):l&&l[w]&&l[w].hasStack?(j=yH(l[w].stackGroups,c,u),j=sC(f,j,w,a)):(j=NS(C,mH(h,r.filter(function(S){var _,N,P=o in S.props?S.props[o]:(_=S.type.defaultProps)===null||_===void 0?void 0:_[o],O="hide"in S.props?S.props.hide:(N=S.type.defaultProps)===null||N===void 0?void 0:N.hide;return P===w&&!O}),"number",d),i.defaultProps.allowDataOverflow),j=sC(f,j,w,a)),te(te({},v),{},Le({},w,te(te({axisType:a},i.defaultProps),{},{hide:!0,orientation:ji(uRe,"".concat(a,".").concat(m%2),null),domain:j,originalDomain:C,isCategorical:g,layout:d})))}return v},{})},gRe=function(t,n){var r=n.axisType,i=r===void 0?"xAxis":r,a=n.AxisComp,o=n.graphicalItems,l=n.stackGroups,c=n.dataStartIndex,u=n.dataEndIndex,d=t.children,f="".concat(i,"Id"),h=Si(d,a),p={};return h&&h.length?p=pRe(t,{axes:h,graphicalItems:o,axisType:i,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:u}):o&&o.length&&(p=mRe(t,{Axis:a,graphicalItems:o,axisType:i,axisIdKey:f,stackGroups:l,dataStartIndex:c,dataEndIndex:u})),p},vRe=function(t){var n=uo(t),r=ws(n,!1,!0);return{tooltipTicks:r,orderedTooltipTicks:sP(r,function(i){return i.coordinate}),tooltipAxis:n,tooltipAxisBandSize:py(n,r)}},$M=function(t){var n=t.children,r=t.defaultShowTooltip,i=Kr(n,ud),a=0,o=0;return t.data&&t.data.length!==0&&(o=t.data.length-1),i&&i.props&&(i.props.startIndex>=0&&(a=i.props.startIndex),i.props.endIndex>=0&&(o=i.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:a,dataEndIndex:o,activeTooltipIndex:-1,isTooltipActive:!!r}},yRe=function(t){return!t||!t.length?!1:t.some(function(n){var r=Ns(n&&n.type);return r&&r.indexOf("Bar")>=0})},IM=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},xRe=function(t,n){var r=t.props,i=t.graphicalItems,a=t.xAxisMap,o=a===void 0?{}:a,l=t.yAxisMap,c=l===void 0?{}:l,u=r.width,d=r.height,f=r.children,h=r.margin||{},p=Kr(f,ud),g=Kr(f,$o),m=Object.keys(c).reduce(function(j,S){var _=c[S],N=_.orientation;return!_.mirror&&!_.hide?te(te({},j),{},Le({},N,j[N]+_.width)):j},{left:h.left||0,right:h.right||0}),v=Object.keys(o).reduce(function(j,S){var _=o[S],N=_.orientation;return!_.mirror&&!_.hide?te(te({},j),{},Le({},N,ji(j,"".concat(N))+_.height)):j},{top:h.top||0,bottom:h.bottom||0}),b=te(te({},v),m),y=b.bottom;p&&(b.bottom+=p.props.height||ud.defaultProps.height),g&&n&&(b=wCe(b,i,r,n));var w=u-b.left-b.right,C=d-b.top-b.bottom;return te(te({brushBottom:y},b),{},{width:Math.max(w,0),height:Math.max(C,0)})},bRe=function(t,n){if(n==="xAxis")return t[n].width;if(n==="yAxis")return t[n].height},WP=function(t){var n=t.chartName,r=t.GraphicalChild,i=t.defaultTooltipEventType,a=i===void 0?"axis":i,o=t.validateTooltipEventTypes,l=o===void 0?["axis"]:o,c=t.axisComponents,u=t.legendContent,d=t.formatAxisMap,f=t.defaultProps,h=function(b,y){var w=y.graphicalItems,C=y.stackGroups,j=y.offset,S=y.updateId,_=y.dataStartIndex,N=y.dataEndIndex,P=b.barSize,O=b.layout,T=b.barGap,E=b.barCategoryGap,k=b.maxBarSize,D=IM(O),A=D.numericAxisName,B=D.cateAxisName,F=yRe(w),R=[];return w.forEach(function(U,G){var $=A0(b.data,{graphicalItems:[U],dataStartIndex:_,dataEndIndex:N}),Q=U.type.defaultProps!==void 0?te(te({},U.type.defaultProps),U.props):U.props,ae=Q.dataKey,q=Q.maxBarSize,pe=Q["".concat(A,"Id")],Se=Q["".concat(B,"Id")],L={},ne=c.reduce(function(me,ce){var le=y["".concat(ce.axisType,"Map")],Oe=Q["".concat(ce.axisType,"Id")];le&&le[Oe]||ce.axisType==="zAxis"||dc();var Ye=le[Oe];return te(te({},me),{},Le(Le({},ce.axisType,Ye),"".concat(ce.axisType,"Ticks"),ws(Ye)))},L),re=ne[B],ve=ne["".concat(B,"Ticks")],xe=C&&C[pe]&&C[pe].hasStack&&DCe(U,C[pe].stackGroups),J=Ns(U.type).indexOf("Bar")>=0,nt=py(re,ve),Be=[],$t=F&&xCe({barSize:P,stackGroups:C,totalSize:bRe(ne,B)});if(J){var It,Yt,V=lt(q)?k:q,K=(It=(Yt=py(re,ve,!0))!==null&&Yt!==void 0?Yt:V)!==null&&It!==void 0?It:0;Be=bCe({barGap:T,barCategoryGap:E,bandSize:K!==nt?K:nt,sizeList:$t[Se],maxBarSize:V}),K!==nt&&(Be=Be.map(function(me){return te(te({},me),{},{position:te(te({},me.position),{},{offset:me.position.offset-K/2})})}))}var ee=U&&U.type&&U.type.getComposedData;ee&&R.push({props:te(te({},ee(te(te({},ne),{},{displayedData:$,props:b,dataKey:ae,item:U,bandSize:nt,barPosition:Be,offset:j,stackedData:xe,layout:O,dataStartIndex:_,dataEndIndex:N}))),{},Le(Le(Le({key:U.key||"item-".concat(G)},A,ne[A]),B,ne[B]),"animationId",S)),childIndex:yde(U,b.children),item:U})}),R},p=function(b,y){var w=b.props,C=b.dataStartIndex,j=b.dataEndIndex,S=b.updateId;if(!aO({props:w}))return null;var _=w.children,N=w.layout,P=w.stackOffset,O=w.data,T=w.reverseStackOrder,E=IM(N),k=E.numericAxisName,D=E.cateAxisName,A=Si(_,r),B=ACe(O,A,"".concat(k,"Id"),"".concat(D,"Id"),P,T),F=c.reduce(function(Q,ae){var q="".concat(ae.axisType,"Map");return te(te({},Q),{},Le({},q,gRe(w,te(te({},ae),{},{graphicalItems:A,stackGroups:ae.axisType===k&&B,dataStartIndex:C,dataEndIndex:j}))))},{}),R=xRe(te(te({},F),{},{props:w,graphicalItems:A}),y==null?void 0:y.legendBBox);Object.keys(F).forEach(function(Q){F[Q]=d(w,F[Q],R,Q.replace("Map",""),n)});var U=F["".concat(D,"Map")],G=vRe(U),$=h(w,te(te({},F),{},{dataStartIndex:C,dataEndIndex:j,updateId:S,graphicalItems:A,stackGroups:B,offset:R}));return te(te({formattedGraphicalItems:$,graphicalItems:A,offset:R,stackGroups:B},G),F)},g=function(v){function b(y){var w,C,j;return JAe(this,b),j=nRe(this,b,[y]),Le(j,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Le(j,"accessibilityManager",new FAe),Le(j,"handleLegendBBoxUpdate",function(S){if(S){var _=j.state,N=_.dataStartIndex,P=_.dataEndIndex,O=_.updateId;j.setState(te({legendBBox:S},p({props:j.props,dataStartIndex:N,dataEndIndex:P,updateId:O},te(te({},j.state),{},{legendBBox:S}))))}}),Le(j,"handleReceiveSyncEvent",function(S,_,N){if(j.props.syncId===S){if(N===j.eventEmitterSymbol&&typeof j.props.syncMethod!="function")return;j.applySyncEvent(_)}}),Le(j,"handleBrushChange",function(S){var _=S.startIndex,N=S.endIndex;if(_!==j.state.dataStartIndex||N!==j.state.dataEndIndex){var P=j.state.updateId;j.setState(function(){return te({dataStartIndex:_,dataEndIndex:N},p({props:j.props,dataStartIndex:_,dataEndIndex:N,updateId:P},j.state))}),j.triggerSyncEvent({dataStartIndex:_,dataEndIndex:N})}}),Le(j,"handleMouseEnter",function(S){var _=j.getMouseInfo(S);if(_){var N=te(te({},_),{},{isTooltipActive:!0});j.setState(N),j.triggerSyncEvent(N);var P=j.props.onMouseEnter;Je(P)&&P(N,S)}}),Le(j,"triggeredAfterMouseMove",function(S){var _=j.getMouseInfo(S),N=_?te(te({},_),{},{isTooltipActive:!0}):{isTooltipActive:!1};j.setState(N),j.triggerSyncEvent(N);var P=j.props.onMouseMove;Je(P)&&P(N,S)}),Le(j,"handleItemMouseEnter",function(S){j.setState(function(){return{isTooltipActive:!0,activeItem:S,activePayload:S.tooltipPayload,activeCoordinate:S.tooltipPosition||{x:S.cx,y:S.cy}}})}),Le(j,"handleItemMouseLeave",function(){j.setState(function(){return{isTooltipActive:!1}})}),Le(j,"handleMouseMove",function(S){S.persist(),j.throttleTriggeredAfterMouseMove(S)}),Le(j,"handleMouseLeave",function(S){j.throttleTriggeredAfterMouseMove.cancel();var _={isTooltipActive:!1};j.setState(_),j.triggerSyncEvent(_);var N=j.props.onMouseLeave;Je(N)&&N(_,S)}),Le(j,"handleOuterEvent",function(S){var _=vde(S),N=ji(j.props,"".concat(_));if(_&&Je(N)){var P,O;/.*touch.*/i.test(_)?O=j.getMouseInfo(S.changedTouches[0]):O=j.getMouseInfo(S),N((P=O)!==null&&P!==void 0?P:{},S)}}),Le(j,"handleClick",function(S){var _=j.getMouseInfo(S);if(_){var N=te(te({},_),{},{isTooltipActive:!0});j.setState(N),j.triggerSyncEvent(N);var P=j.props.onClick;Je(P)&&P(N,S)}}),Le(j,"handleMouseDown",function(S){var _=j.props.onMouseDown;if(Je(_)){var N=j.getMouseInfo(S);_(N,S)}}),Le(j,"handleMouseUp",function(S){var _=j.props.onMouseUp;if(Je(_)){var N=j.getMouseInfo(S);_(N,S)}}),Le(j,"handleTouchMove",function(S){S.changedTouches!=null&&S.changedTouches.length>0&&j.throttleTriggeredAfterMouseMove(S.changedTouches[0])}),Le(j,"handleTouchStart",function(S){S.changedTouches!=null&&S.changedTouches.length>0&&j.handleMouseDown(S.changedTouches[0])}),Le(j,"handleTouchEnd",function(S){S.changedTouches!=null&&S.changedTouches.length>0&&j.handleMouseUp(S.changedTouches[0])}),Le(j,"handleDoubleClick",function(S){var _=j.props.onDoubleClick;if(Je(_)){var N=j.getMouseInfo(S);_(N,S)}}),Le(j,"handleContextMenu",function(S){var _=j.props.onContextMenu;if(Je(_)){var N=j.getMouseInfo(S);_(N,S)}}),Le(j,"triggerSyncEvent",function(S){j.props.syncId!==void 0&&Pw.emit(Tw,j.props.syncId,S,j.eventEmitterSymbol)}),Le(j,"applySyncEvent",function(S){var _=j.props,N=_.layout,P=_.syncMethod,O=j.state.updateId,T=S.dataStartIndex,E=S.dataEndIndex;if(S.dataStartIndex!==void 0||S.dataEndIndex!==void 0)j.setState(te({dataStartIndex:T,dataEndIndex:E},p({props:j.props,dataStartIndex:T,dataEndIndex:E,updateId:O},j.state)));else if(S.activeTooltipIndex!==void 0){var k=S.chartX,D=S.chartY,A=S.activeTooltipIndex,B=j.state,F=B.offset,R=B.tooltipTicks;if(!F)return;if(typeof P=="function")A=P(R,S);else if(P==="value"){A=-1;for(var U=0;U<R.length;U++)if(R[U].value===S.activeLabel){A=U;break}}var G=te(te({},F),{},{x:F.left,y:F.top}),$=Math.min(k,G.x+G.width),Q=Math.min(D,G.y+G.height),ae=R[A]&&R[A].value,q=cC(j.state,j.props.data,A),pe=R[A]?{x:N==="horizontal"?R[A].coordinate:$,y:N==="horizontal"?Q:R[A].coordinate}:N9;j.setState(te(te({},S),{},{activeLabel:ae,activeCoordinate:pe,activePayload:q,activeTooltipIndex:A}))}else j.setState(S)}),Le(j,"renderCursor",function(S){var _,N=j.state,P=N.isTooltipActive,O=N.activeCoordinate,T=N.activePayload,E=N.offset,k=N.activeTooltipIndex,D=N.tooltipAxisBandSize,A=j.getTooltipEventType(),B=(_=S.props.active)!==null&&_!==void 0?_:P,F=j.props.layout,R=S.key||"_recharts-cursor";return M.createElement(qAe,{key:R,activeCoordinate:O,activePayload:T,activeTooltipIndex:k,chartName:n,element:S,isActive:B,layout:F,offset:E,tooltipAxisBandSize:D,tooltipEventType:A})}),Le(j,"renderPolarAxis",function(S,_,N){var P=ji(S,"type.axisType"),O=ji(j.state,"".concat(P,"Map")),T=S.type.defaultProps,E=T!==void 0?te(te({},T),S.props):S.props,k=O&&O[E["".concat(P,"Id")]];return x.cloneElement(S,te(te({},k),{},{className:pt(P,k.className),key:S.key||"".concat(_,"-").concat(N),ticks:ws(k,!0)}))}),Le(j,"renderPolarGrid",function(S){var _=S.props,N=_.radialLines,P=_.polarAngles,O=_.polarRadius,T=j.state,E=T.radiusAxisMap,k=T.angleAxisMap,D=uo(E),A=uo(k),B=A.cx,F=A.cy,R=A.innerRadius,U=A.outerRadius;return x.cloneElement(S,{polarAngles:Array.isArray(P)?P:ws(A,!0).map(function(G){return G.coordinate}),polarRadius:Array.isArray(O)?O:ws(D,!0).map(function(G){return G.coordinate}),cx:B,cy:F,innerRadius:R,outerRadius:U,key:S.key||"polar-grid",radialLines:N})}),Le(j,"renderLegend",function(){var S=j.state.formattedGraphicalItems,_=j.props,N=_.children,P=_.width,O=_.height,T=j.props.margin||{},E=P-(T.left||0)-(T.right||0),k=hH({children:N,formattedGraphicalItems:S,legendWidth:E,legendContent:u});if(!k)return null;var D=k.item,A=RM(k,KAe);return x.cloneElement(D,te(te({},A),{},{chartWidth:P,chartHeight:O,margin:T,onBBoxUpdate:j.handleLegendBBoxUpdate}))}),Le(j,"renderTooltip",function(){var S,_=j.props,N=_.children,P=_.accessibilityLayer,O=Kr(N,Zn);if(!O)return null;var T=j.state,E=T.isTooltipActive,k=T.activeCoordinate,D=T.activePayload,A=T.activeLabel,B=T.offset,F=(S=O.props.active)!==null&&S!==void 0?S:E;return x.cloneElement(O,{viewBox:te(te({},B),{},{x:B.left,y:B.top}),active:F,label:A,payload:F?D:[],coordinate:k,accessibilityLayer:P})}),Le(j,"renderBrush",function(S){var _=j.props,N=_.margin,P=_.data,O=j.state,T=O.offset,E=O.dataStartIndex,k=O.dataEndIndex,D=O.updateId;return x.cloneElement(S,{key:S.key||"_recharts-brush",onChange:eg(j.handleBrushChange,S.props.onChange),data:P,x:de(S.props.x)?S.props.x:T.left,y:de(S.props.y)?S.props.y:T.top+T.height+T.brushBottom-(N.bottom||0),width:de(S.props.width)?S.props.width:T.width,startIndex:E,endIndex:k,updateId:"brush-".concat(D)})}),Le(j,"renderReferenceElement",function(S,_,N){if(!S)return null;var P=j,O=P.clipPathId,T=j.state,E=T.xAxisMap,k=T.yAxisMap,D=T.offset,A=S.type.defaultProps||{},B=S.props,F=B.xAxisId,R=F===void 0?A.xAxisId:F,U=B.yAxisId,G=U===void 0?A.yAxisId:U;return x.cloneElement(S,{key:S.key||"".concat(_,"-").concat(N),xAxis:E[R],yAxis:k[G],viewBox:{x:D.left,y:D.top,width:D.width,height:D.height},clipPathId:O})}),Le(j,"renderActivePoints",function(S){var _=S.item,N=S.activePoint,P=S.basePoint,O=S.childIndex,T=S.isRange,E=[],k=_.props.key,D=_.item.type.defaultProps!==void 0?te(te({},_.item.type.defaultProps),_.item.props):_.item.props,A=D.activeDot,B=D.dataKey,F=te(te({index:O,dataKey:B,cx:N.x,cy:N.y,r:4,fill:AP(_.item),strokeWidth:2,stroke:"#fff",payload:N.payload,value:N.value},at(A,!1)),Lv(A));return E.push(b.renderActiveDot(A,F,"".concat(k,"-activePoint-").concat(O))),P?E.push(b.renderActiveDot(A,te(te({},F),{},{cx:P.x,cy:P.y}),"".concat(k,"-basePoint-").concat(O))):T&&E.push(null),E}),Le(j,"renderGraphicChild",function(S,_,N){var P=j.filterFormatItem(S,_,N);if(!P)return null;var O=j.getTooltipEventType(),T=j.state,E=T.isTooltipActive,k=T.tooltipAxis,D=T.activeTooltipIndex,A=T.activeLabel,B=j.props.children,F=Kr(B,Zn),R=P.props,U=R.points,G=R.isRange,$=R.baseLine,Q=P.item.type.defaultProps!==void 0?te(te({},P.item.type.defaultProps),P.item.props):P.item.props,ae=Q.activeDot,q=Q.hide,pe=Q.activeBar,Se=Q.activeShape,L=!!(!q&&E&&F&&(ae||pe||Se)),ne={};O!=="axis"&&F&&F.props.trigger==="click"?ne={onClick:eg(j.handleItemMouseEnter,S.props.onClick)}:O!=="axis"&&(ne={onMouseLeave:eg(j.handleItemMouseLeave,S.props.onMouseLeave),onMouseEnter:eg(j.handleItemMouseEnter,S.props.onMouseEnter)});var re=x.cloneElement(S,te(te({},P.props),ne));function ve(ce){return typeof k.dataKey=="function"?k.dataKey(ce.payload):null}if(L)if(D>=0){var xe,J;if(k.dataKey&&!k.allowDuplicatedCategory){var nt=typeof k.dataKey=="function"?ve:"payload.".concat(k.dataKey.toString());xe=Iv(U,nt,A),J=G&&$&&Iv($,nt,A)}else xe=U==null?void 0:U[D],J=G&&$&&$[D];if(Se||pe){var Be=S.props.activeIndex!==void 0?S.props.activeIndex:D;return[x.cloneElement(S,te(te(te({},P.props),ne),{},{activeIndex:Be})),null,null]}if(!lt(xe))return[re].concat(jd(j.renderActivePoints({item:P,activePoint:xe,basePoint:J,childIndex:D,isRange:G})))}else{var $t,It=($t=j.getItemByXY(j.state.activeCoordinate))!==null&&$t!==void 0?$t:{graphicalItem:re},Yt=It.graphicalItem,V=Yt.item,K=V===void 0?S:V,ee=Yt.childIndex,me=te(te(te({},P.props),ne),{},{activeIndex:ee});return[x.cloneElement(K,me),null,null]}return G?[re,null,null]:[re,null]}),Le(j,"renderCustomized",function(S,_,N){return x.cloneElement(S,te(te({key:"recharts-customized-".concat(N)},j.props),j.state))}),Le(j,"renderMap",{CartesianGrid:{handler:ag,once:!0},ReferenceArea:{handler:j.renderReferenceElement},ReferenceLine:{handler:ag},ReferenceDot:{handler:j.renderReferenceElement},XAxis:{handler:ag},YAxis:{handler:ag},Brush:{handler:j.renderBrush,once:!0},Bar:{handler:j.renderGraphicChild},Line:{handler:j.renderGraphicChild},Area:{handler:j.renderGraphicChild},Radar:{handler:j.renderGraphicChild},RadialBar:{handler:j.renderGraphicChild},Scatter:{handler:j.renderGraphicChild},Pie:{handler:j.renderGraphicChild},Funnel:{handler:j.renderGraphicChild},Tooltip:{handler:j.renderCursor,once:!0},PolarGrid:{handler:j.renderPolarGrid,once:!0},PolarAngleAxis:{handler:j.renderPolarAxis},PolarRadiusAxis:{handler:j.renderPolarAxis},Customized:{handler:j.renderCustomized}}),j.clipPathId="".concat((w=y.id)!==null&&w!==void 0?w:Xd("recharts"),"-clip"),j.throttleTriggeredAfterMouseMove=fW(j.triggeredAfterMouseMove,(C=y.throttleDelay)!==null&&C!==void 0?C:1e3/60),j.state={},j}return aRe(b,v),tRe(b,[{key:"componentDidMount",value:function(){var w,C;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(w=this.props.margin.left)!==null&&w!==void 0?w:0,top:(C=this.props.margin.top)!==null&&C!==void 0?C:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var w=this.props,C=w.children,j=w.data,S=w.height,_=w.layout,N=Kr(C,Zn);if(N){var P=N.props.defaultIndex;if(!(typeof P!="number"||P<0||P>this.state.tooltipTicks.length-1)){var O=this.state.tooltipTicks[P]&&this.state.tooltipTicks[P].value,T=cC(this.state,j,P,O),E=this.state.tooltipTicks[P].coordinate,k=(this.state.offset.top+S)/2,D=_==="horizontal",A=D?{x:E,y:k}:{y:E,x:k},B=this.state.formattedGraphicalItems.find(function(R){var U=R.item;return U.type.name==="Scatter"});B&&(A=te(te({},A),B.props.points[P].tooltipPosition),T=B.props.points[P].tooltipPayload);var F={activeTooltipIndex:P,isTooltipActive:!0,activeLabel:O,activePayload:T,activeCoordinate:A};this.setState(F),this.renderCursor(N),this.accessibilityManager.setIndex(P)}}}},{key:"getSnapshotBeforeUpdate",value:function(w,C){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==C.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==w.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==w.margin){var j,S;this.accessibilityManager.setDetails({offset:{left:(j=this.props.margin.left)!==null&&j!==void 0?j:0,top:(S=this.props.margin.top)!==null&&S!==void 0?S:0}})}return null}},{key:"componentDidUpdate",value:function(w){B1([Kr(w.children,Zn)],[Kr(this.props.children,Zn)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var w=Kr(this.props.children,Zn);if(w&&typeof w.props.shared=="boolean"){var C=w.props.shared?"axis":"item";return l.indexOf(C)>=0?C:a}return a}},{key:"getMouseInfo",value:function(w){if(!this.container)return null;var C=this.container,j=C.getBoundingClientRect(),S=Wbe(j),_={chartX:Math.round(w.pageX-S.left),chartY:Math.round(w.pageY-S.top)},N=j.width/C.offsetWidth||1,P=this.inRange(_.chartX,_.chartY,N);if(!P)return null;var O=this.state,T=O.xAxisMap,E=O.yAxisMap,k=this.getTooltipEventType(),D=DM(this.state,this.props.data,this.props.layout,P);if(k!=="axis"&&T&&E){var A=uo(T).scale,B=uo(E).scale,F=A&&A.invert?A.invert(_.chartX):null,R=B&&B.invert?B.invert(_.chartY):null;return te(te({},_),{},{xValue:F,yValue:R},D)}return D?te(te({},_),D):null}},{key:"inRange",value:function(w,C){var j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,S=this.props.layout,_=w/j,N=C/j;if(S==="horizontal"||S==="vertical"){var P=this.state.offset,O=_>=P.left&&_<=P.left+P.width&&N>=P.top&&N<=P.top+P.height;return O?{x:_,y:N}:null}var T=this.state,E=T.angleAxisMap,k=T.radiusAxisMap;if(E&&k){var D=uo(E);return pR({x:_,y:N},D)}return null}},{key:"parseEventsOfWrapper",value:function(){var w=this.props.children,C=this.getTooltipEventType(),j=Kr(w,Zn),S={};j&&C==="axis"&&(j.props.trigger==="click"?S={onClick:this.handleClick}:S={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var _=Lv(this.props,this.handleOuterEvent);return te(te({},_),S)}},{key:"addListener",value:function(){Pw.on(Tw,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){Pw.removeListener(Tw,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(w,C,j){for(var S=this.state.formattedGraphicalItems,_=0,N=S.length;_<N;_++){var P=S[_];if(P.item===w||P.props.key===w.key||C===Ns(P.item.type)&&j===P.childIndex)return P}return null}},{key:"renderClipPath",value:function(){var w=this.clipPathId,C=this.state.offset,j=C.left,S=C.top,_=C.height,N=C.width;return M.createElement("defs",null,M.createElement("clipPath",{id:w},M.createElement("rect",{x:j,y:S,height:_,width:N})))}},{key:"getXScales",value:function(){var w=this.state.xAxisMap;return w?Object.entries(w).reduce(function(C,j){var S=AM(j,2),_=S[0],N=S[1];return te(te({},C),{},Le({},_,N.scale))},{}):null}},{key:"getYScales",value:function(){var w=this.state.yAxisMap;return w?Object.entries(w).reduce(function(C,j){var S=AM(j,2),_=S[0],N=S[1];return te(te({},C),{},Le({},_,N.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(w){var C;return(C=this.state.xAxisMap)===null||C===void 0||(C=C[w])===null||C===void 0?void 0:C.scale}},{key:"getYScaleByAxisId",value:function(w){var C;return(C=this.state.yAxisMap)===null||C===void 0||(C=C[w])===null||C===void 0?void 0:C.scale}},{key:"getItemByXY",value:function(w){var C=this.state,j=C.formattedGraphicalItems,S=C.activeItem;if(j&&j.length)for(var _=0,N=j.length;_<N;_++){var P=j[_],O=P.props,T=P.item,E=T.type.defaultProps!==void 0?te(te({},T.type.defaultProps),T.props):T.props,k=Ns(T.type);if(k==="Bar"){var D=(O.data||[]).find(function(R){return NPe(w,R)});if(D)return{graphicalItem:P,payload:D}}else if(k==="RadialBar"){var A=(O.data||[]).find(function(R){return pR(w,R)});if(A)return{graphicalItem:P,payload:A}}else if(_0(P,S)||N0(P,S)||Sp(P,S)){var B=kTe({graphicalItem:P,activeTooltipItem:S,itemData:E.data}),F=E.activeIndex===void 0?B:E.activeIndex;return{graphicalItem:te(te({},P),{},{childIndex:F}),payload:Sp(P,S)?E.data[B]:P.props.data[B]}}}return null}},{key:"render",value:function(){var w=this;if(!aO(this))return null;var C=this.props,j=C.children,S=C.className,_=C.width,N=C.height,P=C.style,O=C.compact,T=C.title,E=C.desc,k=RM(C,GAe),D=at(k,!1);if(O)return M.createElement(fM,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},M.createElement(z1,Jc({},D,{width:_,height:N,title:T,desc:E}),this.renderClipPath(),oO(j,this.renderMap)));if(this.props.accessibilityLayer){var A,B;D.tabIndex=(A=this.props.tabIndex)!==null&&A!==void 0?A:0,D.role=(B=this.props.role)!==null&&B!==void 0?B:"application",D.onKeyDown=function(R){w.accessibilityManager.keyboardEvent(R)},D.onFocus=function(){w.accessibilityManager.focus()}}var F=this.parseEventsOfWrapper();return M.createElement(fM,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},M.createElement("div",Jc({className:pt("recharts-wrapper",S),style:te({position:"relative",cursor:"default",width:_,height:N},P)},F,{ref:function(U){w.container=U}}),M.createElement(z1,Jc({},D,{width:_,height:N,title:T,desc:E,style:dRe}),this.renderClipPath(),oO(j,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(x.Component);Le(g,"displayName",n),Le(g,"defaultProps",te({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},f)),Le(g,"getDerivedStateFromProps",function(v,b){var y=v.dataKey,w=v.data,C=v.children,j=v.width,S=v.height,_=v.layout,N=v.stackOffset,P=v.margin,O=b.dataStartIndex,T=b.dataEndIndex;if(b.updateId===void 0){var E=$M(v);return te(te(te({},E),{},{updateId:0},p(te(te({props:v},E),{},{updateId:0}),b)),{},{prevDataKey:y,prevData:w,prevWidth:j,prevHeight:S,prevLayout:_,prevStackOffset:N,prevMargin:P,prevChildren:C})}if(y!==b.prevDataKey||w!==b.prevData||j!==b.prevWidth||S!==b.prevHeight||_!==b.prevLayout||N!==b.prevStackOffset||!pu(P,b.prevMargin)){var k=$M(v),D={chartX:b.chartX,chartY:b.chartY,isTooltipActive:b.isTooltipActive},A=te(te({},DM(b,w,_)),{},{updateId:b.updateId+1}),B=te(te(te({},k),D),A);return te(te(te({},B),p(te({props:v},B),b)),{},{prevDataKey:y,prevData:w,prevWidth:j,prevHeight:S,prevLayout:_,prevStackOffset:N,prevMargin:P,prevChildren:C})}if(!B1(C,b.prevChildren)){var F,R,U,G,$=Kr(C,ud),Q=$&&(F=(R=$.props)===null||R===void 0?void 0:R.startIndex)!==null&&F!==void 0?F:O,ae=$&&(U=(G=$.props)===null||G===void 0?void 0:G.endIndex)!==null&&U!==void 0?U:T,q=Q!==O||ae!==T,pe=!lt(w),Se=pe&&!q?b.updateId:b.updateId+1;return te(te({updateId:Se},p(te(te({props:v},b),{},{updateId:Se,dataStartIndex:Q,dataEndIndex:ae}),b)),{},{prevChildren:C,dataStartIndex:Q,dataEndIndex:ae})}return null}),Le(g,"renderActiveDot",function(v,b,y){var w;return x.isValidElement(v)?w=x.cloneElement(v,b):Je(v)?w=v(b):w=M.createElement(C0,b),M.createElement(Kt,{className:"recharts-active-dot",key:y},w)});var m=x.forwardRef(function(b,y){return M.createElement(g,Jc({},b,{ref:y}))});return m.displayName=g.displayName,m},LM=WP({chartName:"LineChart",GraphicalChild:vd,axisComponents:[{axisType:"xAxis",AxisComp:Pi},{axisType:"yAxis",AxisComp:Ti}],formatAxisMap:MP}),Ly=WP({chartName:"BarChart",GraphicalChild:ns,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Pi},{axisType:"yAxis",AxisComp:Ti}],formatAxisMap:MP}),wRe=WP({chartName:"AreaChart",GraphicalChild:ul,axisComponents:[{axisType:"xAxis",AxisComp:Pi},{axisType:"yAxis",AxisComp:Ti}],formatAxisMap:MP});function jRe(){var b,y,w,C,j,S,_,N,P,O,T,E;const[e,t]=x.useState(!1),[n,r]=x.useState(null),{data:i,isLoading:a,error:o,refetch:l,isRefetching:c}=Tt({queryKey:["/api/system/server-stats"],refetchInterval:n}),{data:u,isLoading:d}=Tt({queryKey:["/api/system/server-stats/history"],refetchInterval:n}),f=()=>{const k=!e;t(k),r(k?5e3:null)},h=()=>{l()},p=(k,D=2)=>{if(k===0)return"0 Bytes";const A=1024,B=D<0?0:D,F=["Bytes","KB","MB","GB","TB"],R=Math.floor(Math.log(k)/Math.log(A));return parseFloat((k/Math.pow(A,R)).toFixed(B))+" "+F[R]},g=k=>!(u!=null&&u.data)||u.data.length===0?[]:u.data.map((D,A)=>{const B=new Date(D.timestamp);return{name:`${B.getHours()}:${B.getMinutes().toString().padStart(2,"0")}`,value:D[k],index:A}}),m=k=>{const D=Math.floor(k/86400),A=Math.floor(k%86400/3600),B=Math.floor(k%3600/60);return`${D}d ${A}h ${B}m`};if(a)return s.jsxs("div",{className:"flex items-center justify-center h-40",children:[s.jsx(We,{className:"h-8 w-8 animate-spin"}),s.jsx("span",{className:"ml-2",children:"Loading server statistics..."})]});if(o)return s.jsxs(qe,{className:"border-red-200",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{className:"text-red-600",children:"Error Loading Server Stats"}),s.jsx(ft,{children:"Could not load server statistics. Please try again later."})]}),s.jsx(Ke,{children:s.jsxs(Y,{onClick:h,variant:"outline",children:[s.jsx(Zl,{className:"h-4 w-4 mr-2"})," Try Again"]})})]});const v=i==null?void 0:i.data;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-medium",children:"Server Monitoring"}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(Y,{variant:"outline",size:"sm",onClick:f,className:e?"bg-green-50":"",children:e?"Auto Refresh: ON":"Auto Refresh: OFF"}),s.jsxs(Y,{variant:"outline",size:"sm",onClick:h,disabled:c,children:[c?s.jsx(We,{className:"h-4 w-4 animate-spin"}):s.jsx(Zl,{className:"h-4 w-4"}),s.jsx("span",{className:"ml-2",children:"Refresh"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs(qe,{children:[s.jsxs(Xe,{className:"pb-2",children:[s.jsx(Ze,{className:"text-base",children:"CPU Usage"}),s.jsx(ft,{children:"Current processor utilization"})]}),s.jsxs(Ke,{children:[s.jsxs("div",{className:"text-3xl font-bold mb-2",children:[v==null?void 0:v.cpuUsage.toFixed(1),"%"]}),s.jsx(Mg,{value:v==null?void 0:v.cpuUsage,className:"h-2"})]})]}),s.jsxs(qe,{children:[s.jsxs(Xe,{className:"pb-2",children:[s.jsx(Ze,{className:"text-base",children:"Memory Usage"}),s.jsx(ft,{children:"RAM utilization"})]}),s.jsxs(Ke,{children:[s.jsxs("div",{className:"text-3xl font-bold mb-2",children:[v==null?void 0:v.memoryUsage.toFixed(1),"%"]}),s.jsx(Mg,{value:v==null?void 0:v.memoryUsage,className:"h-2"}),s.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[p((v==null?void 0:v.memoryTotal)-(v==null?void 0:v.memoryFree))," of ",p(v==null?void 0:v.memoryTotal)]})]})]}),s.jsxs(qe,{children:[s.jsxs(Xe,{className:"pb-2",children:[s.jsx(Ze,{className:"text-base",children:"Network"}),s.jsx(ft,{children:"Current network activity"})]}),s.jsx(Ke,{children:s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground",children:"Active Connections"}),s.jsx("div",{className:"text-xl font-bold",children:v==null?void 0:v.networkStats.total_connections})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-muted-foreground",children:"Transfer Rate"}),s.jsxs("div",{className:"text-xl font-bold",children:[p((v==null?void 0:v.networkStats.rx_sec)+(v==null?void 0:v.networkStats.tx_sec)),"/s"]})]})]})})]})]}),s.jsxs(qe,{children:[s.jsx(Xe,{children:s.jsx(Ze,{children:"Server Information"})}),s.jsxs(Ke,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium",children:"Uptime"}),s.jsx("p",{className:"text-lg",children:m((v==null?void 0:v.uptime)||0)})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium",children:"System Load"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Mg,{value:(v==null?void 0:v.systemLoad)||0,className:"h-2 w-24"}),s.jsxs("p",{className:"text-lg",children:[(v==null?void 0:v.systemLoad)!==void 0?v.systemLoad.toFixed(1):"0.0","%"]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium",children:"Last Updated"}),s.jsx("p",{className:"text-lg",children:v?new Date(v.timestamp).toLocaleTimeString():"-"})]})]}),s.jsxs("div",{className:"border-t pt-4 mt-2",children:[s.jsx("h4",{className:"text-sm font-medium mb-2",children:"Operating System Information"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"OS Platform"}),s.jsx("p",{className:"text-sm font-medium",children:((b=v==null?void 0:v.osInfo)==null?void 0:b.platform)||"Linux"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Distribution"}),s.jsx("p",{className:"text-sm font-medium",children:((y=v==null?void 0:v.osInfo)==null?void 0:y.distro)||"Ubuntu/Debian/AlmaLinux"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Version"}),s.jsx("p",{className:"text-sm font-medium",children:((w=v==null?void 0:v.osInfo)==null?void 0:w.release)||"22.04 LTS"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Kernel"}),s.jsx("p",{className:"text-sm font-medium",children:((C=v==null?void 0:v.osInfo)==null?void 0:C.kernel)||"5.10.x"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Architecture"}),s.jsx("p",{className:"text-sm font-medium",children:((j=v==null?void 0:v.osInfo)==null?void 0:j.arch)||"x86_64"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Hostname"}),s.jsx("p",{className:"text-sm font-medium",children:((S=v==null?void 0:v.osInfo)==null?void 0:S.hostname)||"replit-server"})]})]})]}),s.jsxs("div",{className:"border-t pt-4 mt-2",children:[s.jsx("h4",{className:"text-sm font-medium mb-2",children:"CPU Information"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Processor"}),s.jsx("p",{className:"text-sm font-medium",children:((_=v==null?void 0:v.cpuDetails)==null?void 0:_.brand)||"Replit Virtual CPU"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Manufacturer"}),s.jsx("p",{className:"text-sm font-medium",children:((N=v==null?void 0:v.cpuDetails)==null?void 0:N.manufacturer)||"Replit"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Speed"}),s.jsxs("p",{className:"text-sm font-medium",children:[((P=v==null?void 0:v.cpuDetails)==null?void 0:P.speed)||2.8," GHz"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Logical Cores"}),s.jsx("p",{className:"text-sm font-medium",children:((O=v==null?void 0:v.cpuDetails)==null?void 0:O.cores)||4})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Physical Cores"}),s.jsx("p",{className:"text-sm font-medium",children:((T=v==null?void 0:v.cpuDetails)==null?void 0:T.physicalCores)||2})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Load Average"}),s.jsx("p",{className:"text-sm font-medium",children:((E=v==null?void 0:v.loadAverage)==null?void 0:E.map(k=>k.toFixed(2)).join(", "))||"0.00"})]})]})]})]})]}),s.jsxs(rm,{defaultValue:"cpu",children:[s.jsxs(Wd,{children:[s.jsx(la,{value:"cpu",children:"CPU History"}),s.jsx(la,{value:"memory",children:"Memory History"})]}),s.jsx(ca,{value:"cpu",className:"pt-4",children:s.jsxs(qe,{children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"CPU Usage History"}),s.jsx(ft,{children:"CPU utilization over time"})]}),s.jsx(Ke,{children:s.jsx("div",{className:"h-[300px]",children:d?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx(We,{className:"h-8 w-8 animate-spin"})}):u!=null&&u.data&&u.data.length>0?s.jsx(cc,{width:"100%",height:"100%",children:s.jsxs(LM,{data:g("cpuUsage"),children:[s.jsx(Yo,{strokeDasharray:"3 3"}),s.jsx(Pi,{dataKey:"name"}),s.jsx(Ti,{domain:[0,100],tickFormatter:k=>`${k}%`}),s.jsx(Zn,{formatter:k=>[`${k}%`,"CPU Usage"]}),s.jsx(vd,{type:"monotone",dataKey:"value",stroke:"#8884d8",strokeWidth:2,dot:!1,name:"CPU Usage"})]})}):s.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No historical data available yet"})})})]})}),s.jsx(ca,{value:"memory",className:"pt-4",children:s.jsxs(qe,{children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"Memory Usage History"}),s.jsx(ft,{children:"Memory utilization over time"})]}),s.jsx(Ke,{children:s.jsx("div",{className:"h-[300px]",children:d?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx(We,{className:"h-8 w-8 animate-spin"})}):u!=null&&u.data&&u.data.length>0?s.jsx(cc,{width:"100%",height:"100%",children:s.jsxs(LM,{data:g("memoryUsage"),children:[s.jsx(Yo,{strokeDasharray:"3 3"}),s.jsx(Pi,{dataKey:"name"}),s.jsx(Ti,{domain:[0,100],tickFormatter:k=>`${k}%`}),s.jsx(Zn,{formatter:k=>[`${k}%`,"Memory Usage"]}),s.jsx(vd,{type:"monotone",dataKey:"value",stroke:"#82ca9d",strokeWidth:2,dot:!1,name:"Memory Usage"})]})}):s.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No historical data available yet"})})})]})})]})]})}function SRe(){const{toast:e}=xn(),[t,n]=x.useState(!1),[r,i]=x.useState(!1),[a,o]=x.useState(""),[l,c]=x.useState(""),[u,d]=x.useState(""),[f,h]=x.useState(""),[p,g]=x.useState(!1);x.useEffect(()=>{m()},[]);const m=async()=>{try{n(!0);const b=await Qe("GET","/api/auth/access-code");b!=null&&b.success?o(b.accessCode):e({title:"Error",description:(b==null?void 0:b.message)||"Failed to load access code",variant:"destructive"})}catch(b){console.error("Error fetching access code:",b),e({title:"Error",description:"Unable to load access code. Please refresh the page and try again.",variant:"destructive"}),o("****")}finally{n(!1)}},v=async b=>{if(b.preventDefault(),l.trim()===""){e({title:"Validation Error",description:"Current access code is required",variant:"destructive"});return}if(u.trim()===""){e({title:"Validation Error",description:"New access code is required",variant:"destructive"});return}if(f!==u){e({title:"Validation Error",description:"New access code and confirmation do not match",variant:"destructive"});return}try{i(!0);const y=await Qe("POST","/api/auth/change-access-code",{currentCode:l,newCode:u,confirmNewCode:f});y.success?(e({title:"Success",description:"Access code has been updated successfully"}),c(""),d(""),h(""),g(!1),m()):e({title:"Error",description:y.message||"Failed to update access code",variant:"destructive"})}catch(y){e({title:"Error",description:y instanceof Error?y.message:"An unexpected error occurred",variant:"destructive"})}finally{i(!1)}};return s.jsxs(qe,{className:"mb-6",children:[s.jsxs(Xe,{children:[s.jsxs(Ze,{className:"flex items-center",children:[s.jsx(HY,{className:"mr-2 h-5 w-5"}),"Special Access URL Code"]}),s.jsx(ft,{children:"Change your application's special access URL code. You will need to use the new code in the /access/CODE URL."})]}),s.jsx(Ke,{children:t?s.jsx("div",{className:"flex justify-center py-4",children:s.jsx(We,{className:"h-6 w-6 animate-spin text-primary"})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx(un,{htmlFor:"current-code",children:"Current Access Code"}),s.jsxs("div",{className:"flex items-center mt-1",children:[s.jsx(ye,{id:"current-code",value:a,disabled:!0,className:"font-mono bg-muted"}),s.jsx(Y,{type:"button",variant:"outline",className:"ml-2",onClick:()=>g(!p),children:p?"Cancel":"Change"})]})]}),p&&s.jsx("form",{onSubmit:v,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(un,{htmlFor:"current-code-input",children:"Enter Current Access Code"}),s.jsx(ye,{id:"current-code-input",type:"password",value:l,onChange:b=>c(b.target.value),className:"mt-1",placeholder:"Enter current access code",required:!0})]}),s.jsxs("div",{children:[s.jsx(un,{htmlFor:"new-code",children:"New Access Code"}),s.jsx(ye,{id:"new-code",type:"password",value:u,onChange:b=>d(b.target.value),className:"mt-1",placeholder:"Enter new access code",required:!0})]}),s.jsxs("div",{children:[s.jsx(un,{htmlFor:"confirm-new-code",children:"Confirm New Access Code"}),s.jsx(ye,{id:"confirm-new-code",type:"password",value:f,onChange:b=>h(b.target.value),className:"mt-1",placeholder:"Confirm new access code",required:!0})]}),s.jsx("div",{className:"pt-2",children:s.jsx(Y,{type:"submit",className:"w-full",disabled:r,children:r?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Update Access Code"})})]})})]})})]})}function CRe(){const[e,t]=x.useState(!1),[n,r]=x.useState(""),[i,a]=x.useState(!1),o=async()=>{if(n!=="DELETE ALL DATA"){nn({title:"Confirmation Failed",description:"Please type the exact confirmation phrase.",variant:"destructive"});return}try{t(!0);const l=await fetch("/api/system/full-cleanup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirmText:n})});if(l.ok){const u=(await l.json()).result,d=[`${u.campaignsDeleted} campaigns`,`${u.urlsDeleted} URLs`,`${u.originalUrlRecordsDeleted} original URL records`,`${u.youtubeUrlRecordsDeleted||0} YouTube URL records`,`${u.trafficstarCampaignsDeleted||0} TrafficStar campaigns`,`${u.urlBudgetLogsDeleted||0} URL budget logs`,`${u.urlClickRecordsDeleted||0} URL click records`,`${u.urlClickLogsDeleted||0} URL click logs`,`${u.campaignClickRecordsDeleted||0} campaign click records`].join(", ");nn({title:"System Cleanup Complete",description:`Successfully deleted: ${d}`}),a(!1),r("")}else{const c=await l.json();nn({title:"Cleanup Failed",description:c.message||"System cleanup failed. Please try again.",variant:"destructive"})}}catch(l){nn({title:"Error",description:l instanceof Error?l.message:"An unexpected error occurred",variant:"destructive"})}finally{t(!1)}};return s.jsxs("div",{className:"container mx-auto px-4 py-10",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"System Settings"}),s.jsx("p",{className:"text-muted-foreground mt-2",children:"Advanced settings and maintenance tools for the application"})]}),s.jsxs("div",{className:"mb-10",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"Server Monitoring"}),s.jsx(jRe,{})]}),s.jsxs("div",{className:"mb-10",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"Security Settings"}),s.jsx(poe,{}),s.jsx(SRe,{})]}),s.jsxs("div",{className:"mb-10",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"Database Migrations"}),s.jsx(uoe,{}),s.jsx(doe,{})]}),s.jsxs("div",{className:"mt-12",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"System Cleanup"}),s.jsxs(qe,{className:"border-red-200",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{className:"text-red-600",children:"Delete All Data"}),s.jsx(ft,{children:"Permanently delete all campaigns, URLs, and email logs from the system. This action cannot be undone."})]}),s.jsx(Ke,{children:s.jsxs(Us,{open:i,onOpenChange:a,children:[s.jsx(Qu,{asChild:!0,children:s.jsxs(Y,{variant:"destructive",children:[s.jsx(Ul,{className:"mr-2 h-4 w-4"}),"Full System Cleanup"]})}),s.jsxs(Ka,{children:[s.jsxs(Ga,{children:[s.jsx(Qa,{children:"Are you absolutely sure?"}),s.jsx(Xa,{children:"This action will permanently delete all campaigns, URLs, and email logs. This action cannot be undone."})]}),s.jsxs("div",{className:"mt-4 mb-2",children:[s.jsx(un,{htmlFor:"confirm",className:"font-bold",children:'Type "DELETE ALL DATA" to confirm:'}),s.jsx(ye,{id:"confirm",value:n,onChange:l=>r(l.target.value),className:"mt-2",placeholder:"DELETE ALL DATA"})]}),s.jsxs(Ya,{children:[s.jsx(Ja,{disabled:e,children:"Cancel"}),s.jsx(Za,{onClick:l=>{l.preventDefault(),o()},disabled:e||n!=="DELETE ALL DATA",className:"bg-red-600 hover:bg-red-700",children:e?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete All Data"})]})]})]})})]})]})]})}const _Re=H.object({apiKey:H.string().min(10,"API key must be at least 10 characters")}),NRe=H.object({campaignId:H.coerce.number().positive("Campaign ID must be a positive number"),action:H.enum(["pause","activate"],{required_error:"Please select an action"})}),PRe=H.object({campaignId:H.coerce.number().positive("Campaign ID must be a positive number"),maxDaily:H.coerce.number().min(0,"Budget must be a positive number")}),TRe=H.object({campaignId:H.coerce.number().positive("Campaign ID must be a positive number"),dateFrom:H.string().optional(),dateUntil:H.string().optional()});function kRe(){var P,O,T,E,k,D;const[e,t]=x.useState("campaigns"),n=ki(),[r,i]=x.useState(null),[a,o]=x.useState(!1),[l,c]=x.useState(null),u=Ki({resolver:Gi(NRe),defaultValues:{campaignId:void 0,action:"pause"}}),d=Ki({resolver:Gi(PRe),defaultValues:{campaignId:1000866,maxDaily:15}}),f=Ki({resolver:Gi(TRe),defaultValues:{campaignId:995224,dateFrom:void 0,dateUntil:void 0}}),h=Ki({resolver:Gi(_Re),defaultValues:{apiKey:""}}),{data:p,isLoading:g}=Tt({queryKey:["/api/trafficstar/status"],refetchOnWindowFocus:!1}),m=!0,{data:v,isLoading:b,refetch:y}=Tt({queryKey:["/api/trafficstar/campaigns"],enabled:!!m,refetchOnWindowFocus:!1});yt({mutationFn:A=>Qe("/api/trafficstar/config","POST",A),onSuccess:()=>{nn({title:"TrafficStar API Configured",description:"API key has been saved successfully."}),n.invalidateQueries({queryKey:["/api/trafficstar/status"]}),h.reset()},onError:A=>{nn({title:"Failed to save API key",description:A instanceof Error?A.message:"An unknown error occurred",variant:"destructive"})}});const w=yt({mutationFn:A=>Qe("/api/trafficstar/campaigns/action","POST",A),onSuccess:()=>{nn({title:"Campaign Updated",description:"Campaign status has been updated successfully."}),n.invalidateQueries({queryKey:["/api/trafficstar/campaigns"]}),setTimeout(()=>{y()},1e3)},onError:A=>{nn({title:"Failed to update campaign",description:A instanceof Error?A.message:"An unknown error occurred",variant:"destructive"})}}),C=yt({mutationFn:A=>Qe("/api/trafficstar/campaigns/budget","POST",A),onSuccess:()=>{nn({title:"Budget Updated",description:"Campaign daily budget has been updated successfully."}),n.invalidateQueries({queryKey:["/api/trafficstar/campaigns"]}),setTimeout(()=>{y()},1e3)},onError:A=>{nn({title:"Failed to update budget",description:A instanceof Error?A.message:"An unknown error occurred",variant:"destructive"})}}),j=(A,B)=>{w.mutate({campaignId:A,action:B})},S=A=>{w.mutate({campaignId:A.campaignId,action:A.action}),u.reset({campaignId:null,action:A.action})},_=A=>{C.mutate({campaignId:A.campaignId,maxDaily:A.maxDaily})},N=async A=>{i(null),c(null),o(!0);try{const B=new URLSearchParams;A.dateFrom&&B.append("dateFrom",A.dateFrom),A.dateUntil&&B.append("dateUntil",A.dateUntil);const F=await fetch(`/api/trafficstar/campaigns/${A.campaignId}/spent?${B.toString()}`);if(!F.ok){const U=await F.json();throw new Error(U.message||"Failed to fetch spent value data")}const R=await F.json();i(R),nn({title:"Spent Value Data Retrieved",description:`Successfully fetched data for campaign ${A.campaignId}`})}catch(B){c(B instanceof Error?B.message:"An unknown error occurred"),nn({title:"Failed to Fetch Spent Value",description:B instanceof Error?B.message:"An unknown error occurred",variant:"destructive"})}finally{o(!1)}};return g?s.jsxs("div",{className:"flex justify-center items-center h-[calc(100vh-200px)]",children:[s.jsx(We,{className:"h-8 w-8 animate-spin mr-2"}),s.jsx("span",{children:"Loading TrafficStar status..."})]}):s.jsxs("div",{className:"container py-10",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:"TrafficStar API Integration"}),s.jsxs(qe,{className:"mb-6",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"Direct Campaign Control"}),s.jsx(ft,{children:"Pause or activate a campaign by entering its ID"})]}),s.jsx(Ke,{children:s.jsx(Da,{...u,children:s.jsx("form",{onSubmit:u.handleSubmit(S),className:"space-y-4",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsx(Ee,{control:u.control,name:"campaignId",render:({field:A})=>s.jsxs(Te,{className:"flex-1",children:[s.jsx(Pe,{children:"Campaign ID"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",placeholder:"Enter campaign ID",...A,value:A.value===void 0?"":A.value})}),s.jsx(De,{})]})}),s.jsx(Ee,{control:u.control,name:"action",render:({field:A})=>s.jsxs(Te,{className:"md:w-1/3",children:[s.jsx(Pe,{children:"Action"}),s.jsx(ke,{children:s.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",...A,children:[s.jsx("option",{value:"pause",children:"Pause Campaign"}),s.jsx("option",{value:"activate",children:"Activate Campaign"})]})}),s.jsx(De,{})]})}),s.jsx("div",{className:"flex items-end mb-2",children:s.jsx(Y,{type:"submit",disabled:w.isPending,className:"w-full md:w-auto",children:w.isPending?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"Apply Action"})})]})})})})]}),s.jsxs(qe,{className:"mb-6",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"Update Campaign Budget"}),s.jsx(ft,{children:"Set the daily budget for a campaign"})]}),s.jsx(Ke,{children:s.jsx(Da,{...d,children:s.jsx("form",{onSubmit:d.handleSubmit(_),className:"space-y-4",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsx(Ee,{control:d.control,name:"campaignId",render:({field:A})=>s.jsxs(Te,{className:"flex-1",children:[s.jsx(Pe,{children:"Campaign ID"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",placeholder:"Enter campaign ID",...A,value:A.value===void 0?"":A.value})}),s.jsx(De,{})]})}),s.jsx(Ee,{control:d.control,name:"maxDaily",render:({field:A})=>s.jsxs(Te,{className:"flex-1",children:[s.jsx(Pe,{children:"Daily Budget"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",step:"0.01",placeholder:"Enter daily budget",...A,value:A.value===void 0?"":A.value})}),s.jsx(De,{})]})}),s.jsx("div",{className:"flex items-end mb-2",children:s.jsx(Y,{type:"submit",disabled:C.isPending,className:"w-full md:w-auto",children:C.isPending?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):"Update Budget"})})]})})})})]}),s.jsxs(qe,{className:"mb-6",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"Get Campaign Spent Value"}),s.jsx(ft,{children:"Retrieve campaign costs and performance statistics"})]}),s.jsxs(Ke,{children:[s.jsx(Da,{...f,children:s.jsx("form",{onSubmit:f.handleSubmit(N),className:"space-y-4",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsx(Ee,{control:f.control,name:"campaignId",render:({field:A})=>s.jsxs(Te,{className:"flex-1",children:[s.jsx(Pe,{children:"Campaign ID"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",placeholder:"Enter campaign ID",...A,value:A.value===void 0?"":A.value})}),s.jsx(De,{})]})}),s.jsx(Ee,{control:f.control,name:"dateFrom",render:({field:A})=>s.jsxs(Te,{className:"flex-1",children:[s.jsx(Pe,{children:"From Date"}),s.jsx(ke,{children:s.jsx(ye,{type:"date",placeholder:"YYYY-MM-DD",...A})}),s.jsx(it,{children:"Start date (defaults to 7 days ago)"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:f.control,name:"dateUntil",render:({field:A})=>s.jsxs(Te,{className:"flex-1",children:[s.jsx(Pe,{children:"Until Date"}),s.jsx(ke,{children:s.jsx(ye,{type:"date",placeholder:"YYYY-MM-DD",...A})}),s.jsx(it,{children:"End date (defaults to today)"}),s.jsx(De,{})]})}),s.jsx("div",{className:"flex items-end mb-2",children:s.jsx(Y,{type:"submit",disabled:a,className:"w-full md:w-auto",children:a?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):s.jsxs(s.Fragment,{children:[s.jsx(l3,{className:"mr-2 h-4 w-4"}),"Get Spent Value"]})})})]})})}),l&&s.jsxs("div",{className:"mt-4 p-4 border border-red-200 rounded-md bg-red-50 text-red-700 flex items-start",children:[s.jsx(Ad,{className:"h-5 w-5 mr-2 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold",children:"Error retrieving data"}),s.jsx("p",{children:l})]})]}),r&&r.totals&&s.jsxs("div",{className:"mt-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Campaign Spend Results"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[s.jsxs("div",{className:"p-4 border rounded-md",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Spent"}),s.jsxs("div",{className:"text-2xl font-bold",children:["$",((P=r.totals.spent)==null?void 0:P.toFixed(2))||"0.00"]})]}),s.jsxs("div",{className:"p-4 border rounded-md",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"Impressions"}),s.jsx("div",{className:"text-2xl font-bold",children:((O=r.totals.impressions)==null?void 0:O.toLocaleString())||"0"})]}),s.jsxs("div",{className:"p-4 border rounded-md",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"Clicks"}),s.jsx("div",{className:"text-2xl font-bold",children:((T=r.totals.clicks)==null?void 0:T.toLocaleString())||"0"})]}),s.jsxs("div",{className:"p-4 border rounded-md",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"eCPM"}),s.jsxs("div",{className:"text-2xl font-bold",children:["$",((E=r.totals.ecpm)==null?void 0:E.toFixed(4))||"0.0000"]})]})]}),s.jsx("h4",{className:"font-medium mb-2",children:"Daily Statistics"}),s.jsx("div",{className:"rounded-md border overflow-hidden",children:s.jsxs(ma,{children:[s.jsx(ga,{children:s.jsxs(Rt,{children:[s.jsx(Ce,{children:"Date"}),s.jsx(Ce,{className:"text-right",children:"Impressions"}),s.jsx(Ce,{className:"text-right",children:"Clicks"}),s.jsx(Ce,{className:"text-right",children:"CTR"}),s.jsx(Ce,{className:"text-right",children:"Cost (USD)"}),s.jsx(Ce,{className:"text-right",children:"eCPM"})]})}),s.jsx(va,{children:!r.dailyStats||r.dailyStats.length===0?s.jsx(Rt,{children:s.jsx(ge,{colSpan:6,className:"text-center py-4",children:"No data available for the selected date range"})}):r.dailyStats.map((A,B)=>{var F,R,U;return s.jsxs(Rt,{children:[s.jsx(ge,{children:A.date?new Date(A.date).toLocaleDateString():"N/A"}),s.jsx(ge,{className:"text-right",children:((F=A.impressions)==null?void 0:F.toLocaleString())||"0"}),s.jsx(ge,{className:"text-right",children:((R=A.clicks)==null?void 0:R.toLocaleString())||"0"}),s.jsxs(ge,{className:"text-right",children:[((U=A.ctr)==null?void 0:U.toFixed(2))||"0.00","%"]}),s.jsxs(ge,{className:"text-right",children:["$",(A.price?parseFloat(A.price.toString()):0).toFixed(2)]}),s.jsxs(ge,{className:"text-right",children:["$",(A.ecpm?parseFloat(A.ecpm.toString()):0).toFixed(4)]})]},B)})})]})}),s.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["Date range: ",((k=r.dateRange)==null?void 0:k.from)||"N/A"," to ",((D=r.dateRange)==null?void 0:D.to)||"N/A"]})]})]})]}),s.jsxs(rm,{defaultValue:e,onValueChange:t,className:"w-full",children:[s.jsxs(Wd,{className:"grid w-full max-w-md grid-cols-2",children:[s.jsx(la,{value:"campaigns",children:"Campaigns"}),s.jsx(la,{value:"settings",children:"API Settings"})]}),s.jsxs(ca,{value:"campaigns",className:"mt-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"TrafficStar Campaigns"}),s.jsxs(Y,{onClick:()=>y(),variant:"outline",size:"sm",disabled:b,children:[b?s.jsx(We,{className:"h-4 w-4 animate-spin"}):s.jsx(Zl,{className:"h-4 w-4"}),s.jsx("span",{className:"ml-2",children:"Refresh"})]})]}),b?s.jsxs("div",{className:"flex justify-center items-center h-40",children:[s.jsx(We,{className:"h-8 w-8 animate-spin mr-2"}),s.jsx("span",{children:"Loading campaigns..."})]}):v&&v.length>0?s.jsx("div",{className:"space-y-4",children:v.map(A=>s.jsxs(qe,{className:"overflow-hidden",children:[s.jsxs(Xe,{className:"pb-2",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsx(Ze,{className:"text-xl",children:A.name}),s.jsx(Ft,{variant:A.active?"default":"secondary",children:A.active?"Active":"Paused"})]}),s.jsxs(ft,{children:["ID: ",A.id," • Status: ",A.status]})]}),s.jsxs(Ke,{className:"pb-2",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx(un,{className:"text-sm text-muted-foreground",children:"Daily Budget"}),s.jsxs("div",{className:"text-lg font-medium",children:["$",A.max_daily||0]})]}),s.jsxs("div",{children:[s.jsx(un,{className:"text-sm text-muted-foreground",children:"Pricing Model"}),s.jsx("div",{className:"text-lg font-medium",children:A.pricing_model||"Not set"})]}),s.jsxs("div",{children:[s.jsx(un,{className:"text-sm text-muted-foreground",children:"End Time"}),s.jsx("div",{className:"text-lg font-medium",children:A.schedule_end_time?_t(new Date(A.schedule_end_time),"PPP, p"):"Not set"})]})]}),s.jsxs("div",{className:"flex space-x-2 mt-4",children:[A.active?s.jsxs(Y,{variant:"outline",size:"sm",onClick:()=>j(A.id,"pause"),disabled:w.isPending,children:[s.jsx($s,{className:"h-4 w-4 mr-2"}),"Pause"]}):s.jsxs(Y,{variant:"outline",size:"sm",onClick:()=>j(A.id,"activate"),disabled:w.isPending,children:[s.jsx(Va,{className:"h-4 w-4 mr-2"}),"Activate"]}),s.jsxs(Y,{variant:"ghost",size:"sm",onClick:()=>{d.reset({campaignId:A.id,maxDaily:A.max_daily||0}),window.scrollTo({top:0,behavior:"smooth"})},children:[s.jsx(VY,{className:"h-4 w-4 mr-2"}),"Update Budget"]})]})]})]},A.id))}):s.jsxs(qe,{children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"No Campaigns Found"}),s.jsx(ft,{children:"Unable to retrieve campaign data or no campaigns exist."})]}),s.jsx(Ke,{children:s.jsxs(Y,{onClick:()=>y(),variant:"outline",children:[s.jsx(Zl,{className:"h-4 w-4 mr-2"}),"Refresh Campaigns"]})})]})]}),s.jsx(ca,{value:"settings",className:"mt-4",children:s.jsxs(qe,{children:[s.jsx(Xe,{children:s.jsx(Ze,{children:"API Status"})}),s.jsxs(Ke,{children:[s.jsxs("p",{className:"text-green-600 font-medium flex items-center",children:[s.jsx("span",{className:"bg-green-600 text-white rounded-full p-1 mr-2",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M20 6L9 17l-5-5"})})}),"API key is configured"]}),s.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"Your TrafficStar API key is stored securely as an environment variable. You can manage your TrafficStar campaigns directly from this interface."})]})]})})]})]})}function ERe(){return s.jsxs(qe,{className:"w-full",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"TrafficStar Test Component"}),s.jsx(ft,{children:"This test component has been removed"})]}),s.jsx(Ke,{children:s.jsxs(yc,{variant:"destructive",className:"mb-4",children:[s.jsx(Ad,{className:"h-4 w-4"}),s.jsx(zd,{children:"Component Removed"}),s.jsx(xc,{children:"The TrafficStar test component has been completely removed as per request. All auto-management code has been removed from the system."})]})}),s.jsx(el,{className:"flex justify-between",children:s.jsx("div",{className:"text-xs text-gray-500",children:"This is a placeholder component to prevent import errors."})})]})}var ORe="Separator",FM="horizontal",ARe=["horizontal","vertical"],T9=x.forwardRef((e,t)=>{const{decorative:n,orientation:r=FM,...i}=e,a=RRe(r)?r:FM,l=n?{role:"none"}:{"aria-orientation":a==="vertical"?a:void 0,role:"separator"};return s.jsx(Me.div,{"data-orientation":a,...l,...i,ref:t})});T9.displayName=ORe;function RRe(e){return ARe.includes(e)}var k9=T9;const Dg=x.forwardRef(({className:e,orientation:t="horizontal",decorative:n=!0,...r},i)=>s.jsx(k9,{ref:i,decorative:n,orientation:t,className:fe("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...r}));Dg.displayName=k9.displayName;function MRe(){const{toast:e}=xn(),[t,n]=x.useState("27"),[r,i]=x.useState(""),[a,o]=x.useState(!0),[l,c]=x.useState(!1),[u,d]=x.useState("10000"),[f,h]=x.useState("Test URL"),[p,g]=x.useState("https://example.com"),[m,v]=x.useState("active"),[b,y]=x.useState(null),w=async()=>{var S,_;c(!0);try{const N=await Ut.post(`/api/campaigns/${t}/urls`,{name:f,targetUrl:p,clickLimit:u,status:m});y(N.data),i(N.data.id.toString()),e({title:"URL Created",description:`Created URL ID: ${N.data.id} with ${N.data.clickLimit} clicks`})}catch(N){console.error("Error creating URL:",N),e({title:"Error",description:((_=(S=N.response)==null?void 0:S.data)==null?void 0:_.message)||"Failed to create URL",variant:"destructive"})}finally{c(!1)}},C=async()=>{var S,_;if(!r){e({title:"Error",description:"URL ID is required",variant:"destructive"});return}c(!0);try{const N=await Ut.post("/api/system/test-url-budget-update",{campaignId:parseInt(t),urlId:parseInt(r),immediate:a});y(N.data),e({title:"URL Budget Test",description:N.data.message||"Budget update process initiated"})}catch(N){console.error("Error testing URL budget:",N),e({title:"Error",description:((_=(S=N.response)==null?void 0:S.data)==null?void 0:_.message)||"Failed to test URL budget",variant:"destructive"})}finally{c(!1)}},j=async()=>{var S,_;c(!0);try{const P=(await Ut.get(`/api/campaigns/${t}`)).data.trafficstarCampaignId;if(!P){e({title:"Error",description:"Campaign has no TrafficStar ID",variant:"destructive"});return}const O=await Ut.get(`/api/trafficstar/campaigns/${P}`);y(O.data),e({title:"Campaign Info",description:`Campaign daily budget: $${O.data.max_daily}`})}catch(N){console.error("Error getting campaign info:",N),e({title:"Error",description:((_=(S=N.response)==null?void 0:S.data)==null?void 0:_.message)||"Failed to get campaign info",variant:"destructive"})}finally{c(!1)}};return s.jsxs(qe,{className:"w-full",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"URL Budget Testing"}),s.jsx(ft,{children:"Test the 10-minute delay mechanism for URL budget handling"})]}),s.jsxs(Ke,{children:[s.jsxs("div",{className:"grid gap-6",children:[s.jsxs("div",{className:"grid gap-3",children:[s.jsx(un,{htmlFor:"campaignId",children:"Campaign ID"}),s.jsx(ye,{id:"campaignId",value:t,onChange:S=>n(S.target.value),placeholder:"Enter campaign ID"})]}),s.jsx(Dg,{}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium",children:"Create New URL"}),s.jsxs("div",{className:"grid gap-3",children:[s.jsx(un,{htmlFor:"name",children:"URL Name"}),s.jsx(ye,{id:"name",value:f,onChange:S=>h(S.target.value),placeholder:"Enter URL name"})]}),s.jsxs("div",{className:"grid gap-3",children:[s.jsx(un,{htmlFor:"targetUrl",children:"Target URL"}),s.jsx(ye,{id:"targetUrl",value:p,onChange:S=>g(S.target.value),placeholder:"Enter target URL"})]}),s.jsxs("div",{className:"grid gap-3",children:[s.jsx(un,{htmlFor:"clickLimit",children:"Click Limit"}),s.jsx(ye,{id:"clickLimit",value:u,onChange:S=>d(S.target.value),placeholder:"Enter click limit"})]}),s.jsxs("div",{className:"grid gap-3",children:[s.jsx(un,{htmlFor:"status",children:"Status"}),s.jsxs(Nt,{value:m,onValueChange:v,children:[s.jsx(bt,{children:s.jsx(Pt,{placeholder:"Select status"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"active",children:"Active"}),s.jsx(X,{value:"paused",children:"Paused"})]})]})]}),s.jsx(Y,{onClick:w,disabled:l,children:l?"Creating...":"Create URL"})]}),s.jsx(Dg,{}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-medium",children:"Test URL Budget"}),s.jsxs("div",{className:"grid gap-3",children:[s.jsx(un,{htmlFor:"urlId",children:"URL ID"}),s.jsx(ye,{id:"urlId",value:r,onChange:S=>i(S.target.value),placeholder:"Enter URL ID"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Un,{id:"immediate",checked:a,onCheckedChange:S=>o(S)}),s.jsx(un,{htmlFor:"immediate",children:"Process Immediately (Skip 10-minute delay)"})]}),s.jsx(Y,{onClick:C,disabled:l,children:l?"Testing...":"Test URL Budget"})]}),s.jsx(Dg,{}),s.jsx(Y,{onClick:j,disabled:l,children:l?"Loading...":"Get Campaign Info"})]}),b&&s.jsxs("div",{className:"mt-6",children:[s.jsx("h3",{className:"text-lg font-medium mb-2",children:"Result:"}),s.jsx("pre",{className:"p-4 bg-slate-100 rounded-md overflow-auto max-h-72",children:JSON.stringify(b,null,2)})]})]}),s.jsx(el,{className:"flex flex-col space-y-4",children:s.jsxs("div",{className:"text-sm text-slate-500",children:[s.jsx("p",{children:s.jsx("strong",{children:"How URL Budget Handling Works:"})}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-2",children:[s.jsx("li",{children:"When a new URL is added to a campaign, its budget is tracked for a 10-minute delay"}),s.jsx("li",{children:"If multiple URLs are added during this period, their budgets are combined"}),s.jsx("li",{children:"After the delay, the combined budget is applied to the TrafficStar campaign"}),s.jsx("li",{children:"This prevents too many small budget updates and allows for batch processing"})]})]})})]})}function DRe({children:e}){return s.jsx("div",{className:"container py-8",children:e})}function $Re({title:e,description:t}){return s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold",children:e}),t&&s.jsx("p",{className:"text-muted-foreground mt-1",children:t})]})}function IRe(){return s.jsxs(DRe,{children:[s.jsx($Re,{title:"TrafficStar API Testing",description:"This page provides tools to test various TrafficStar API integrations"}),s.jsxs(rm,{defaultValue:"spent-value",className:"w-full",children:[s.jsxs(Wd,{className:"grid w-full grid-cols-2",children:[s.jsx(la,{value:"spent-value",children:"Spent Value Tests"}),s.jsx(la,{value:"url-budget",children:"URL Budget Tests"})]}),s.jsx(ca,{value:"spent-value",className:"mt-4",children:s.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.jsx(ERe,{})})}),s.jsx(ca,{value:"url-budget",className:"mt-4",children:s.jsx("div",{className:"grid grid-cols-1 gap-4",children:s.jsx(MRe,{})})})]})]})}const R0=({className:e,...t})=>s.jsx("nav",{role:"navigation","aria-label":"pagination",className:fe("mx-auto flex w-full justify-center",e),...t});R0.displayName="Pagination";const M0=x.forwardRef(({className:e,...t},n)=>s.jsx("ul",{ref:n,className:fe("flex flex-row items-center gap-1",e),...t}));M0.displayName="PaginationContent";const Nr=x.forwardRef(({className:e,...t},n)=>s.jsx("li",{ref:n,className:fe("",e),...t}));Nr.displayName="PaginationItem";const js=({className:e,isActive:t,size:n="icon",...r})=>s.jsx("a",{"aria-current":t?"page":void 0,className:fe(Hu({variant:t?"outline":"ghost",size:n}),e),...r});js.displayName="PaginationLink";const D0=({className:e,...t})=>s.jsxs(js,{"aria-label":"Go to previous page",size:"default",className:fe("gap-1 pl-2.5",e),...t,children:[s.jsx(ux,{className:"h-4 w-4"}),s.jsx("span",{children:"Previous"})]});D0.displayName="PaginationPrevious";const $0=({className:e,...t})=>s.jsxs(js,{"aria-label":"Go to next page",size:"default",className:fe("gap-1 pr-2.5",e),...t,children:[s.jsx("span",{children:"Next"}),s.jsx(dx,{className:"h-4 w-4"})]});$0.displayName="PaginationNext";const uC=({className:e,...t})=>s.jsxs("span",{"aria-hidden":!0,className:fe("flex h-9 w-9 items-center justify-center",e),...t,children:[s.jsx(fx,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"More pages"})]});uC.displayName="PaginationEllipsis";const LRe=IJ.extend({originalClickLimit:H.coerce.number().min(1,{message:"Click limit must be at least 1"})});function FRe(){var Ye,gn;const e=ki(),{toast:t}=xn(),[n,r]=x.useState(1),[i,a]=x.useState(10),[o,l]=x.useState(""),[c,u]=x.useState(null),[d,f]=x.useState("active"),[h,p]=x.useState(null),[g,m]=x.useState(!1),[v,b]=x.useState(null),[y,w]=x.useState(!1),[C,j]=x.useState(!1),[S,_]=x.useState([]),[N,P]=x.useState(!1),[O,T]=x.useState(!1);x.useEffect(()=>{r(1)},[o,c,d,i]);const E=yt({mutationFn:async()=>{try{return await(await Qe("POST","/api/system/click-protection/fix-trigger")).json()}catch(W){throw console.error("Error fixing click protection:",W),W}},onSuccess:W=>{t({title:"Success",description:`Click protection trigger fixed successfully: ${W.message||"Now updates from Original URL Records will propagate correctly"}`})},onError:W=>{t({title:"Failed to fix click protection",description:W.message,variant:"destructive"})}}),{data:k,isLoading:D,isError:A,error:B}=Tt({queryKey:["/api/original-url-records",n,i,o,c,d],queryFn:async()=>{const W=new URLSearchParams({page:n.toString(),limit:i.toString()});if(o)W.append("search",o),W.append("status","all"),console.log("Search mode: Searching across ALL records regardless of status or campaign");else{if(c){const sn=parseInt(c,10);console.log(`Setting campaign filter to ${sn} (${typeof sn})`),W.append("campaignId",sn.toString())}d&&d!=="all"&&W.append("status",d)}const Re=await fetch(`/api/original-url-records?${W.toString()}`);if(!Re.ok)throw new Error("Failed to fetch original URL records");return Re.json()}});x.useEffect(()=>{if(k!=null&&k.records){const W=k.records.map(sn=>sn.id);_(sn=>sn.filter(fl=>W.includes(fl)));const Re=S.length>0&&W.length>0&&W.every(sn=>S.includes(sn));P(Re)}},[k,S]);const F=yt({mutationFn:async W=>{try{return await(await Qe("POST","/api/original-url-records",W)).json()}catch(Re){throw console.error("Error in create mutation:",Re),Re}},onSuccess:()=>{t({title:"Success",description:"Original URL record created successfully"}),e.invalidateQueries({queryKey:["/api/original-url-records"]}),w(!1),ae.reset()},onError:W=>{t({title:"Failed to create record",description:W.message,variant:"destructive"})}}),R=yt({mutationFn:async W=>{try{return await(await Qe("PUT",`/api/original-url-records/${W.id}`,W.data)).json()}catch(Re){throw console.error("Error in update mutation:",Re),Re}},onSuccess:()=>{t({title:"Success",description:"Original URL record updated successfully"}),e.invalidateQueries({queryKey:["/api/original-url-records"]}),j(!1),q.reset(),p(null)},onError:W=>{t({title:"Failed to update record",description:W.message,variant:"destructive"})}}),U=yt({mutationFn:async W=>{try{return await(await Qe("DELETE",`/api/original-url-records/${W}`)).json()}catch(Re){throw console.error("Error in delete mutation:",Re),Re}},onSuccess:()=>{t({title:"Success",description:"Original URL record deleted successfully"}),e.invalidateQueries({queryKey:["/api/original-url-records"]}),m(!1),b(null)},onError:W=>{t({title:"Failed to delete record",description:W.message,variant:"destructive"})}}),G=yt({mutationFn:async W=>{try{return await(await Qe("POST",`/api/original-url-records/${W}/sync`)).json()}catch(Re){throw console.error("Error in sync mutation:",Re),Re}},onSuccess:W=>{t({title:"Success",description:`Original URL record synced successfully. ${W.updatedUrlCount} URLs updated.`}),e.invalidateQueries({queryKey:["/api/original-url-records"]}),e.invalidateQueries({queryKey:["/api/campaigns"]}),e.invalidateQueries({queryKey:["/api/urls"]})},onError:W=>{t({title:"Failed to sync record",description:W.message,variant:"destructive"})}}),$=yt({mutationFn:async W=>{try{return await Qe("POST",`/api/original-url-records/${W}/pause`)}catch(Re){throw console.error("Error in pause mutation:",Re),Re}},onSuccess:W=>{t({title:"Success",description:`Original URL record paused. ${W.updatedUrlCount} URLs paused.`}),e.invalidateQueries({queryKey:["/api/original-url-records"]}),e.invalidateQueries({queryKey:["/api/campaigns"]}),e.invalidateQueries({queryKey:["/api/urls"]})},onError:W=>{t({title:"Failed to pause record",description:W.message,variant:"destructive"})}}),Q=yt({mutationFn:async W=>{try{return await Qe("POST",`/api/original-url-records/${W}/resume`)}catch(Re){throw console.error("Error in resume mutation:",Re),Re}},onSuccess:W=>{t({title:"Success",description:`Original URL record resumed. ${W.updatedUrlCount} URLs resumed.`}),e.invalidateQueries({queryKey:["/api/original-url-records"]}),e.invalidateQueries({queryKey:["/api/campaigns"]}),e.invalidateQueries({queryKey:["/api/urls"]})},onError:W=>{t({title:"Failed to resume record",description:W.message,variant:"destructive"})}}),ae=Ki({resolver:Gi(LRe),defaultValues:{name:"",targetUrl:"",originalClickLimit:1e3}}),q=Ki({resolver:Gi(LJ),defaultValues:{name:"",targetUrl:"",originalClickLimit:1e3}}),pe=W=>{F.mutate(W)},Se=W=>{h&&R.mutate({id:h.id,data:W})},L=W=>{p(W),q.reset({name:W.name,targetUrl:W.targetUrl,originalClickLimit:W.originalClickLimit,status:W.status||"active"}),j(!0)},ne=W=>{b(W),m(!0)},re=W=>{G.mutate(W)},ve=W=>{$.mutate(W)},xe=W=>{Q.mutate(W)},J=W=>{r(W),e.invalidateQueries({queryKey:["/api/original-url-records"]})},nt=W=>{W.preventDefault(),r(1),e.invalidateQueries({queryKey:["/api/original-url-records"]})},Be=W=>{const Re=W.target.value;l(Re),setTimeout(()=>{e.invalidateQueries({queryKey:["/api/original-url-records"]})},300)},$t=()=>{l(""),r(1),e.invalidateQueries({queryKey:["/api/original-url-records"]})},It=W=>{f(W),e.invalidateQueries({queryKey:["/api/original-url-records"]})},{data:Yt}=Tt({queryKey:["/api/campaigns"],queryFn:async()=>{const W=await fetch("/api/campaigns");if(!W.ok)throw new Error("Failed to fetch campaigns");return W.json()}}),V=(W,Re)=>{_(Re?sn=>[...sn,W]:sn=>sn.filter(fl=>fl!==W))},K=W=>{P(W),W&&(k!=null&&k.records)?_(k.records.map(Re=>Re.id)):_([])},ee=async()=>{if(S.length!==0){T(!0);try{const W=await Qe("POST","/api/original-url-records/bulk/pause",{ids:S});t({title:"Success",description:`${S.length} records paused successfully.`}),e.invalidateQueries({queryKey:["/api/original-url-records"]}),e.invalidateQueries({queryKey:["/api/campaigns"]}),e.invalidateQueries({queryKey:["/api/urls"]}),_([]),P(!1)}catch(W){t({title:"Error",description:`Failed to pause records: ${W instanceof Error?W.message:String(W)}`,variant:"destructive"})}finally{T(!1)}}},me=async()=>{if(S.length!==0){T(!0);try{const W=await Qe("POST","/api/original-url-records/bulk/resume",{ids:S});t({title:"Success",description:`${S.length} records resumed successfully.`}),e.invalidateQueries({queryKey:["/api/original-url-records"]}),e.invalidateQueries({queryKey:["/api/campaigns"]}),e.invalidateQueries({queryKey:["/api/urls"]}),_([]),P(!1)}catch(W){t({title:"Error",description:`Failed to resume records: ${W instanceof Error?W.message:String(W)}`,variant:"destructive"})}finally{T(!1)}}},ce=async()=>{if(S.length!==0){T(!0);try{const W=await Qe("POST","/api/original-url-records/bulk/delete",{ids:S});t({title:"Success",description:`${S.length} records deleted successfully.`}),e.invalidateQueries({queryKey:["/api/original-url-records"]}),_([]),P(!1)}catch(W){t({title:"Error",description:`Failed to delete records: ${W instanceof Error?W.message:String(W)}`,variant:"destructive"})}finally{T(!1)}}},le=W=>{a(parseInt(W)),r(1),e.invalidateQueries({queryKey:["/api/original-url-records"]})},Oe=(k==null?void 0:k.totalPages)||1;return A?s.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[s.jsx("h2",{className:"text-xl font-bold text-destructive mb-2",children:"Error"}),s.jsx("p",{className:"text-muted-foreground",children:(B==null?void 0:B.message)||"Failed to load records"}),s.jsx(Y,{variant:"outline",className:"mt-4",onClick:()=>e.invalidateQueries({queryKey:["/api/original-url-records"]}),children:"Retry"})]}):s.jsxs("div",{className:"container mx-auto py-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Original URL Records"}),s.jsx(Y,{onClick:()=>E.mutate(),variant:"outline",size:"sm",className:"text-xs",disabled:E.isPending,children:E.isPending?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-3 w-3 animate-spin"}),"Fixing..."]}):s.jsx(s.Fragment,{children:"Fix Click Protection"})})]}),s.jsxs(Y,{onClick:()=>w(!0),children:[s.jsx(m3,{className:"mr-2 h-4 w-4"}),"Create New"]})]}),s.jsxs(qe,{children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"Master URL Records"}),s.jsx(ft,{children:"These records serve as the master data source for URL click quantities across the application. When values are edited here, they will propagate to all linked instances in campaigns."})]}),s.jsxs(Ke,{children:[s.jsxs("div",{className:"flex flex-col gap-4 mb-4",children:[s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs("form",{onSubmit:nt,className:"flex-1 flex gap-2",children:[s.jsx(ye,{placeholder:"Search by name or URL...",value:o,onChange:Be,className:"flex-1"}),s.jsxs(Y,{type:"submit",variant:"outline",children:[s.jsx(Jl,{className:"h-4 w-4 mr-2"}),"Search"]}),o&&s.jsxs(Y,{type:"button",variant:"ghost",onClick:$t,children:[s.jsx(zp,{className:"h-4 w-4 mr-2"}),"Clear"]})]}),s.jsxs("div",{className:"w-[180px]",children:[s.jsx("div",{className:"text-xs font-medium mb-1 text-muted-foreground",children:"Campaign Filter:"}),s.jsxs("select",{value:c||"",onChange:W=>{const Re=W.target.value;if(Re==="")console.log("Clearing campaign filter"),u(null);else{const sn=parseInt(Re,10);console.log(`Setting campaign filter to: ${sn} (${typeof sn})`),u(sn.toString())}r(1),e.invalidateQueries({queryKey:["/api/original-url-records"]})},className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[s.jsx("option",{value:"",children:"All campaigns"}),Yt==null?void 0:Yt.map(W=>s.jsx("option",{value:W.id.toString(),children:W.name},W.id))]})]}),s.jsxs("div",{className:"w-[150px]",children:[s.jsx("div",{className:"text-xs font-medium mb-1 text-muted-foreground",children:"Status Filter:"}),s.jsxs("select",{value:d,onChange:W=>It(W.target.value),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[s.jsx("option",{value:"active",children:"Active URLs"}),s.jsx("option",{value:"paused",children:"Paused URLs"}),s.jsx("option",{value:"deleted",children:"Deleted URLs"}),s.jsx("option",{value:"completed",children:"Completed URLs"}),s.jsx("option",{value:"all",children:"All URLs"})]})]}),s.jsxs("div",{className:"w-[150px]",children:[s.jsx("div",{className:"text-xs font-medium mb-1 text-muted-foreground",children:"Records Per Page:"}),s.jsxs("select",{value:i.toString(),onChange:W=>le(W.target.value),className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[s.jsx("option",{value:"5",children:"5 per page"}),s.jsx("option",{value:"25",children:"25 per page"}),s.jsx("option",{value:"50",children:"50 per page"}),s.jsx("option",{value:"100",children:"100 per page"}),s.jsx("option",{value:"250",children:"250 per page"}),s.jsx("option",{value:"500",children:"500 per page"}),s.jsx("option",{value:"1000",children:"1000 per page"})]})]})]}),S.length>0&&s.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-md",children:[s.jsxs("span",{className:"text-sm font-medium mr-2",children:[S.length," records selected"]}),s.jsxs(Y,{size:"sm",variant:"outline",onClick:me,disabled:O,className:"flex items-center gap-1",children:[O?s.jsx(We,{className:"h-3 w-3 animate-spin"}):s.jsx(Va,{className:"h-3 w-3"}),"Activate"]}),s.jsxs(Y,{size:"sm",variant:"outline",onClick:ee,disabled:O,className:"flex items-center gap-1",children:[O?s.jsx(We,{className:"h-3 w-3 animate-spin"}):s.jsx($s,{className:"h-3 w-3"}),"Pause"]}),s.jsxs(Y,{size:"sm",variant:"destructive",onClick:ce,disabled:O,className:"flex items-center gap-1",children:[O?s.jsx(We,{className:"h-3 w-3 animate-spin"}):s.jsx(Sn,{className:"h-3 w-3"}),"Delete"]}),s.jsx(Y,{size:"sm",variant:"ghost",onClick:()=>{_([]),P(!1)},className:"ml-auto",children:"Clear selection"})]})]}),D?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx(We,{className:"h-8 w-8 animate-spin text-primary"})}):((Ye=k==null?void 0:k.records)==null?void 0:Ye.length)===0?s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-muted-foreground",children:"No records found"})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"rounded-md border",children:s.jsxs(ma,{children:[s.jsx(ga,{children:s.jsxs(Rt,{children:[s.jsx(Ce,{className:"w-[40px]",children:s.jsx(Un,{checked:N,onCheckedChange:K,"aria-label":"Select all records"})}),s.jsx(Ce,{className:"w-[50px]",children:"ID"}),s.jsx(Ce,{className:"w-[200px]",children:"Name"}),s.jsx(Ce,{className:"w-[250px]",children:"Target URL"}),s.jsx(Ce,{className:"text-center",children:"Click Limit"}),s.jsx(Ce,{className:"w-[100px]",children:"Status"}),s.jsx(Ce,{className:"w-[150px]",children:"Last Updated"}),s.jsx(Ce,{className:"text-right w-[220px]",children:"Actions"})]})}),s.jsx(va,{children:(gn=k==null?void 0:k.records)==null?void 0:gn.map(W=>s.jsxs(Rt,{children:[s.jsx(ge,{children:s.jsx(Un,{checked:S.includes(W.id),onCheckedChange:Re=>V(W.id,!!Re),"aria-label":`Select record ${W.id}`})}),s.jsx(ge,{className:"font-medium",children:W.id}),s.jsx(ge,{children:W.name||"Unnamed"}),s.jsx(ge,{className:"truncate max-w-xs",children:W.targetUrl?s.jsx("a",{href:W.targetUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:W.targetUrl}):s.jsx("span",{className:"text-gray-400",children:"No URL"})}),s.jsx(ge,{className:"text-center",children:W.originalClickLimit?W.originalClickLimit.toLocaleString():0}),s.jsx(ge,{children:W.status==="paused"?s.jsxs("span",{className:"inline-flex items-center rounded-full bg-amber-100 px-2 py-1 text-xs font-medium text-amber-800",children:[s.jsx(Ul,{className:"mr-1 h-3 w-3"}),"Paused"]}):W.status==="completed"?s.jsx("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800",children:"Completed"}):W.status==="deleted"?s.jsx("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2 py-1 text-xs font-medium text-red-800",children:"Deleted"}):W.status==="rejected"?s.jsx("span",{className:"inline-flex items-center rounded-full bg-purple-100 px-2 py-1 text-xs font-medium text-purple-800",children:"Rejected"}):s.jsx("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2 py-1 text-xs font-medium text-green-800",children:"Active"})}),s.jsx(ge,{className:"text-muted-foreground",children:W.updatedAt?R3(new Date(W.updatedAt),{addSuffix:!0}):"N/A"}),s.jsx(ge,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[W.status==="paused"?s.jsx(Y,{variant:"outline",size:"icon",onClick:()=>xe(W.id),title:"Resume this URL",className:"text-green-500",disabled:Q.isPending,children:Q.isPending&&Q.variables===W.id?s.jsx(We,{className:"h-4 w-4 animate-spin"}):s.jsx(Va,{className:"h-4 w-4"})}):s.jsx(Y,{variant:"outline",size:"icon",onClick:()=>ve(W.id),title:"Pause this URL",className:"text-amber-500",disabled:$.isPending,children:$.isPending&&$.variables===W.id?s.jsx(We,{className:"h-4 w-4 animate-spin"}):s.jsx($s,{className:"h-4 w-4"})}),s.jsx(Y,{variant:"outline",size:"icon",onClick:()=>re(W.id),title:"Sync with all linked URLs",disabled:G.isPending&&G.variables===W.id,children:G.isPending&&G.variables===W.id?s.jsx(We,{className:"h-4 w-4 animate-spin"}):s.jsx(Zl,{className:"h-4 w-4"})}),s.jsx(Y,{variant:"outline",size:"icon",onClick:()=>L(W),title:"Edit record",children:s.jsx(tQ,{className:"h-4 w-4"})}),s.jsx(Y,{variant:"outline",size:"icon",onClick:()=>ne(W.id),className:"text-red-500",title:"Delete record",children:s.jsx(Sn,{className:"h-4 w-4"})})]})})]},W.id))})]})}),s.jsx("div",{className:"mt-4",children:s.jsx(R0,{children:s.jsxs(M0,{children:[s.jsx(Nr,{children:s.jsx(D0,{onClick:()=>J(Math.max(1,n-1)),className:n===1?"pointer-events-none opacity-50":""})}),Array.from({length:Oe},(W,Re)=>Re+1).map(W=>s.jsx(Nr,{children:s.jsx(js,{onClick:()=>J(W),isActive:W===n,children:W})},W)),s.jsx(Nr,{children:s.jsx($0,{onClick:()=>J(Math.min(Oe,n+1)),className:n===Oe?"pointer-events-none opacity-50":""})})]})})})]})]})]}),s.jsx(ti,{open:C,onOpenChange:j,children:s.jsxs(Dr,{children:[s.jsxs(Ji,{children:[s.jsx(ea,{children:"Edit Original URL Record"}),s.jsx(Do,{children:"Edit the master record for this URL. Changes will propagate to all linked instances."})]}),s.jsx(Da,{...q,children:s.jsxs("form",{onSubmit:q.handleSubmit(Se),className:"space-y-4",children:[s.jsx(Ee,{control:q.control,name:"name",render:({field:W})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Name"}),s.jsx(ke,{children:s.jsx(ye,{placeholder:"URL name or identifier",...W})}),s.jsx(De,{})]})}),s.jsx(Ee,{control:q.control,name:"targetUrl",render:({field:W})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Target URL"}),s.jsx(ke,{children:s.jsx(ye,{placeholder:"https://example.com",...W})}),s.jsx(De,{})]})}),s.jsx(Ee,{control:q.control,name:"originalClickLimit",render:({field:W})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Click Limit"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",placeholder:"1000",...W,onChange:Re=>W.onChange(parseInt(Re.target.value))})}),s.jsx(it,{children:"The maximum number of clicks allowed for this URL"}),s.jsx(De,{})]})}),s.jsx(Ee,{control:q.control,name:"status",render:({field:W})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Status"}),s.jsx(ke,{children:s.jsxs("select",{...W,className:"w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"paused",children:"Paused"}),s.jsx("option",{value:"completed",children:"Completed"}),s.jsx("option",{value:"deleted",children:"Deleted"}),s.jsx("option",{value:"rejected",children:"Rejected"})]})}),s.jsx(it,{children:"Current status of this URL record"}),s.jsx(De,{})]})}),s.jsxs($a,{children:[s.jsx(Y,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),s.jsx(Y,{type:"submit",disabled:R.isPending,children:R.isPending?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})})]})}),s.jsx(ti,{open:y,onOpenChange:w,children:s.jsxs(Dr,{children:[s.jsxs(Ji,{children:[s.jsx(ea,{children:"Create New Original URL Record"}),s.jsx(Do,{children:"Add a new master URL record to the system."})]}),s.jsx(Da,{...ae,children:s.jsxs("form",{onSubmit:ae.handleSubmit(pe),className:"space-y-4",children:[s.jsx(Ee,{control:ae.control,name:"name",render:({field:W})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Name"}),s.jsx(ke,{children:s.jsx(ye,{placeholder:"URL name or identifier",...W})}),s.jsx(De,{})]})}),s.jsx(Ee,{control:ae.control,name:"targetUrl",render:({field:W})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Target URL"}),s.jsx(ke,{children:s.jsx(ye,{placeholder:"https://example.com",...W})}),s.jsx(De,{})]})}),s.jsx(Ee,{control:ae.control,name:"originalClickLimit",render:({field:W})=>s.jsxs(Te,{children:[s.jsx(Pe,{children:"Click Limit"}),s.jsx(ke,{children:s.jsx(ye,{type:"number",placeholder:"1000",...W,onChange:Re=>W.onChange(parseInt(Re.target.value))})}),s.jsx(it,{children:"The maximum number of clicks allowed for this URL"}),s.jsx(De,{})]})}),s.jsxs($a,{children:[s.jsx(Y,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),s.jsx(Y,{type:"submit",disabled:F.isPending,children:F.isPending?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create"})]})]})})]})}),s.jsx(ti,{open:g,onOpenChange:m,children:s.jsxs(Dr,{children:[s.jsxs(Ji,{children:[s.jsx(ea,{children:"Confirm Deletion"}),s.jsx(Do,{children:"Are you sure you want to delete this original URL record? This action cannot be undone."})]}),s.jsxs($a,{children:[s.jsx(Y,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),s.jsx(Y,{variant:"destructive",onClick:()=>v!==null&&U.mutate(v),disabled:U.isPending,children:U.isPending?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}var ze=function(){return ze=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},ze.apply(this,arguments)};function URe(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function E9(e,t,n){for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}function dm(e){return e.mode==="multiple"}function fm(e){return e.mode==="range"}function I0(e){return e.mode==="single"}var BRe={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function VRe(e,t){return _t(e,"LLLL y",t)}function zRe(e,t){return _t(e,"d",t)}function WRe(e,t){return _t(e,"LLLL",t)}function HRe(e){return"".concat(e)}function qRe(e,t){return _t(e,"cccccc",t)}function KRe(e,t){return _t(e,"yyyy",t)}var GRe=Object.freeze({__proto__:null,formatCaption:VRe,formatDay:zRe,formatMonthCaption:WRe,formatWeekNumber:HRe,formatWeekdayName:qRe,formatYearCaption:KRe}),YRe=function(e,t,n){return _t(e,"do MMMM (EEEE)",n)},QRe=function(){return"Month: "},XRe=function(){return"Go to next month"},ZRe=function(){return"Go to previous month"},JRe=function(e,t){return _t(e,"cccc",t)},eMe=function(e){return"Week n. ".concat(e)},tMe=function(){return"Year: "},nMe=Object.freeze({__proto__:null,labelDay:YRe,labelMonthDropdown:QRe,labelNext:XRe,labelPrevious:ZRe,labelWeekNumber:eMe,labelWeekday:JRe,labelYearDropdown:tMe});function rMe(){var e="buttons",t=BRe,n=T_,r={},i={},a=1,o={},l=new Date;return{captionLayout:e,classNames:t,formatters:GRe,labels:nMe,locale:n,modifiersClassNames:r,modifiers:i,numberOfMonths:a,styles:o,today:l,mode:"default"}}function iMe(e){var t=e.fromYear,n=e.toYear,r=e.fromMonth,i=e.toMonth,a=e.fromDate,o=e.toDate;return r?a=Mr(r):t&&(a=new Date(t,0,1)),i?o=hx(i):n&&(o=new Date(n,11,31)),{fromDate:a?Vu(a):void 0,toDate:o?Vu(o):void 0}}var O9=x.createContext(void 0);function aMe(e){var t,n=e.initialProps,r=rMe(),i=iMe(n),a=i.fromDate,o=i.toDate,l=(t=n.captionLayout)!==null&&t!==void 0?t:r.captionLayout;l!=="buttons"&&(!a||!o)&&(l="buttons");var c;(I0(n)||dm(n)||fm(n))&&(c=n.onSelect);var u=ze(ze(ze({},r),n),{captionLayout:l,classNames:ze(ze({},r.classNames),n.classNames),components:ze({},n.components),formatters:ze(ze({},r.formatters),n.formatters),fromDate:a,labels:ze(ze({},r.labels),n.labels),mode:n.mode||r.mode,modifiers:ze(ze({},r.modifiers),n.modifiers),modifiersClassNames:ze(ze({},r.modifiersClassNames),n.modifiersClassNames),onSelect:c,styles:ze(ze({},r.styles),n.styles),toDate:o});return s.jsx(O9.Provider,{value:u,children:e.children})}function Gt(){var e=x.useContext(O9);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function A9(e){var t=Gt(),n=t.locale,r=t.classNames,i=t.styles,a=t.formatters.formatCaption;return s.jsx("div",{className:r.caption_label,style:i.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:a(e.displayMonth,{locale:n})})}function sMe(e){return s.jsx("svg",ze({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:s.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function R9(e){var t,n,r=e.onChange,i=e.value,a=e.children,o=e.caption,l=e.className,c=e.style,u=Gt(),d=(n=(t=u.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&n!==void 0?n:sMe;return s.jsxs("div",{className:l,style:c,children:[s.jsx("span",{className:u.classNames.vhidden,children:e["aria-label"]}),s.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:u.classNames.dropdown,style:u.styles.dropdown,value:i,onChange:r,children:a}),s.jsxs("div",{className:u.classNames.caption_label,style:u.styles.caption_label,"aria-hidden":"true",children:[o,s.jsx(d,{className:u.classNames.dropdown_icon,style:u.styles.dropdown_icon})]})]})}function oMe(e){var t,n=Gt(),r=n.fromDate,i=n.toDate,a=n.styles,o=n.locale,l=n.formatters.formatMonthCaption,c=n.classNames,u=n.components,d=n.labels.labelMonthDropdown;if(!r)return s.jsx(s.Fragment,{});if(!i)return s.jsx(s.Fragment,{});var f=[];if(QX(r,i))for(var h=Mr(r),p=r.getMonth();p<=i.getMonth();p++)f.push(wb(h,p));else for(var h=Mr(new Date),p=0;p<=11;p++)f.push(wb(h,p));var g=function(v){var b=Number(v.target.value),y=wb(Mr(e.displayMonth),b);e.onChange(y)},m=(t=u==null?void 0:u.Dropdown)!==null&&t!==void 0?t:R9;return s.jsx(m,{name:"months","aria-label":d(),className:c.dropdown_month,style:a.dropdown_month,onChange:g,value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:o}),children:f.map(function(v){return s.jsx("option",{value:v.getMonth(),children:l(v,{locale:o})},v.getMonth())})})}function lMe(e){var t,n=e.displayMonth,r=Gt(),i=r.fromDate,a=r.toDate,o=r.locale,l=r.styles,c=r.classNames,u=r.components,d=r.formatters.formatYearCaption,f=r.labels.labelYearDropdown,h=[];if(!i)return s.jsx(s.Fragment,{});if(!a)return s.jsx(s.Fragment,{});for(var p=i.getFullYear(),g=a.getFullYear(),m=p;m<=g;m++)h.push(Hk(N3(new Date),m));var v=function(y){var w=Hk(Mr(n),Number(y.target.value));e.onChange(w)},b=(t=u==null?void 0:u.Dropdown)!==null&&t!==void 0?t:R9;return s.jsx(b,{name:"years","aria-label":f(),className:c.dropdown_year,style:l.dropdown_year,onChange:v,value:n.getFullYear(),caption:d(n,{locale:o}),children:h.map(function(y){return s.jsx("option",{value:y.getFullYear(),children:d(y,{locale:o})},y.getFullYear())})})}function cMe(e,t){var n=x.useState(e),r=n[0],i=n[1],a=t===void 0?r:t;return[a,i]}function uMe(e){var t=e.month,n=e.defaultMonth,r=e.today,i=t||n||r||new Date,a=e.toDate,o=e.fromDate,l=e.numberOfMonths,c=l===void 0?1:l;if(a&&Wu(a,i)<0){var u=-1*(c-1);i=ia(a,u)}return o&&Wu(i,o)<0&&(i=o),Mr(i)}function dMe(){var e=Gt(),t=uMe(e),n=cMe(t,e.month),r=n[0],i=n[1],a=function(o){var l;if(!e.disableNavigation){var c=Mr(o);i(c),(l=e.onMonthChange)===null||l===void 0||l.call(e,c)}};return[r,a]}function fMe(e,t){for(var n=t.reverseMonths,r=t.numberOfMonths,i=Mr(e),a=Mr(ia(i,r)),o=Wu(a,i),l=[],c=0;c<o;c++){var u=ia(i,c);l.push(u)}return n&&(l=l.reverse()),l}function hMe(e,t){if(!t.disableNavigation){var n=t.toDate,r=t.pagedNavigation,i=t.numberOfMonths,a=i===void 0?1:i,o=r?a:1,l=Mr(e);if(!n)return ia(l,o);var c=Wu(n,e);if(!(c<a))return ia(l,o)}}function pMe(e,t){if(!t.disableNavigation){var n=t.fromDate,r=t.pagedNavigation,i=t.numberOfMonths,a=i===void 0?1:i,o=r?a:1,l=Mr(e);if(!n)return ia(l,-o);var c=Wu(l,n);if(!(c<=0))return ia(l,-o)}}var M9=x.createContext(void 0);function mMe(e){var t=Gt(),n=dMe(),r=n[0],i=n[1],a=fMe(r,t),o=hMe(r,t),l=pMe(r,t),c=function(f){return a.some(function(h){return k_(f,h)})},u=function(f,h){c(f)||(h&&M3(f,h)?i(ia(f,1+t.numberOfMonths*-1)):i(f))},d={currentMonth:r,displayMonths:a,goToMonth:i,goToDate:u,previousMonth:l,nextMonth:o,isDateDisplayed:c};return s.jsx(M9.Provider,{value:d,children:e.children})}function hm(){var e=x.useContext(M9);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function UM(e){var t,n=Gt(),r=n.classNames,i=n.styles,a=n.components,o=hm().goToMonth,l=function(d){o(ia(d,e.displayIndex?-e.displayIndex:0))},c=(t=a==null?void 0:a.CaptionLabel)!==null&&t!==void 0?t:A9,u=s.jsx(c,{id:e.id,displayMonth:e.displayMonth});return s.jsxs("div",{className:r.caption_dropdowns,style:i.caption_dropdowns,children:[s.jsx("div",{className:r.vhidden,children:u}),s.jsx(oMe,{onChange:l,displayMonth:e.displayMonth}),s.jsx(lMe,{onChange:l,displayMonth:e.displayMonth})]})}function gMe(e){return s.jsx("svg",ze({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:s.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function vMe(e){return s.jsx("svg",ze({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:s.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var Fy=x.forwardRef(function(e,t){var n=Gt(),r=n.classNames,i=n.styles,a=[r.button_reset,r.button];e.className&&a.push(e.className);var o=a.join(" "),l=ze(ze({},i.button_reset),i.button);return e.style&&Object.assign(l,e.style),s.jsx("button",ze({},e,{ref:t,type:"button",className:o,style:l}))});function yMe(e){var t,n,r=Gt(),i=r.dir,a=r.locale,o=r.classNames,l=r.styles,c=r.labels,u=c.labelPrevious,d=c.labelNext,f=r.components;if(!e.nextMonth&&!e.previousMonth)return s.jsx(s.Fragment,{});var h=u(e.previousMonth,{locale:a}),p=[o.nav_button,o.nav_button_previous].join(" "),g=d(e.nextMonth,{locale:a}),m=[o.nav_button,o.nav_button_next].join(" "),v=(t=f==null?void 0:f.IconRight)!==null&&t!==void 0?t:vMe,b=(n=f==null?void 0:f.IconLeft)!==null&&n!==void 0?n:gMe;return s.jsxs("div",{className:o.nav,style:l.nav,children:[!e.hidePrevious&&s.jsx(Fy,{name:"previous-month","aria-label":h,className:p,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:i==="rtl"?s.jsx(v,{className:o.nav_icon,style:l.nav_icon}):s.jsx(b,{className:o.nav_icon,style:l.nav_icon})}),!e.hideNext&&s.jsx(Fy,{name:"next-month","aria-label":g,className:m,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:i==="rtl"?s.jsx(b,{className:o.nav_icon,style:l.nav_icon}):s.jsx(v,{className:o.nav_icon,style:l.nav_icon})})]})}function BM(e){var t=Gt().numberOfMonths,n=hm(),r=n.previousMonth,i=n.nextMonth,a=n.goToMonth,o=n.displayMonths,l=o.findIndex(function(g){return k_(e.displayMonth,g)}),c=l===0,u=l===o.length-1,d=t>1&&(c||!u),f=t>1&&(u||!c),h=function(){r&&a(r)},p=function(){i&&a(i)};return s.jsx(yMe,{displayMonth:e.displayMonth,hideNext:d,hidePrevious:f,nextMonth:i,previousMonth:r,onPreviousClick:h,onNextClick:p})}function xMe(e){var t,n=Gt(),r=n.classNames,i=n.disableNavigation,a=n.styles,o=n.captionLayout,l=n.components,c=(t=l==null?void 0:l.CaptionLabel)!==null&&t!==void 0?t:A9,u;return i?u=s.jsx(c,{id:e.id,displayMonth:e.displayMonth}):o==="dropdown"?u=s.jsx(UM,{displayMonth:e.displayMonth,id:e.id}):o==="dropdown-buttons"?u=s.jsxs(s.Fragment,{children:[s.jsx(UM,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),s.jsx(BM,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):u=s.jsxs(s.Fragment,{children:[s.jsx(c,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),s.jsx(BM,{displayMonth:e.displayMonth,id:e.id})]}),s.jsx("div",{className:r.caption,style:a.caption,children:u})}function bMe(e){var t=Gt(),n=t.footer,r=t.styles,i=t.classNames.tfoot;return n?s.jsx("tfoot",{className:i,style:r.tfoot,children:s.jsx("tr",{children:s.jsx("td",{colSpan:8,children:n})})}):s.jsx(s.Fragment,{})}function wMe(e,t,n){for(var r=n?ec(new Date):za(new Date,{locale:e,weekStartsOn:t}),i=[],a=0;a<7;a++){var o=fr(r,a);i.push(o)}return i}function jMe(){var e=Gt(),t=e.classNames,n=e.styles,r=e.showWeekNumber,i=e.locale,a=e.weekStartsOn,o=e.ISOWeek,l=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,u=wMe(i,a,o);return s.jsxs("tr",{style:n.head_row,className:t.head_row,children:[r&&s.jsx("td",{style:n.head_cell,className:t.head_cell}),u.map(function(d,f){return s.jsx("th",{scope:"col",className:t.head_cell,style:n.head_cell,"aria-label":c(d,{locale:i}),children:l(d,{locale:i})},f)})]})}function SMe(){var e,t=Gt(),n=t.classNames,r=t.styles,i=t.components,a=(e=i==null?void 0:i.HeadRow)!==null&&e!==void 0?e:jMe;return s.jsx("thead",{style:r.head,className:n.head,children:s.jsx(a,{})})}function CMe(e){var t=Gt(),n=t.locale,r=t.formatters.formatDay;return s.jsx(s.Fragment,{children:r(e.date,{locale:n})})}var HP=x.createContext(void 0);function _Me(e){if(!dm(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return s.jsx(HP.Provider,{value:t,children:e.children})}return s.jsx(NMe,{initialProps:e.initialProps,children:e.children})}function NMe(e){var t=e.initialProps,n=e.children,r=t.selected,i=t.min,a=t.max,o=function(u,d,f){var h,p;(h=t.onDayClick)===null||h===void 0||h.call(t,u,d,f);var g=!!(d.selected&&i&&(r==null?void 0:r.length)===i);if(!g){var m=!!(!d.selected&&a&&(r==null?void 0:r.length)===a);if(!m){var v=r?E9([],r):[];if(d.selected){var b=v.findIndex(function(y){return Tr(u,y)});v.splice(b,1)}else v.push(u);(p=t.onSelect)===null||p===void 0||p.call(t,v,u,d,f)}}},l={disabled:[]};r&&l.disabled.push(function(u){var d=a&&r.length>a-1,f=r.some(function(h){return Tr(h,u)});return!!(d&&!f)});var c={selected:r,onDayClick:o,modifiers:l};return s.jsx(HP.Provider,{value:c,children:n})}function qP(){var e=x.useContext(HP);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function PMe(e,t){var n=t||{},r=n.from,i=n.to;return r&&i?Tr(i,e)&&Tr(r,e)?void 0:Tr(i,e)?{from:i,to:void 0}:Tr(r,e)?void 0:t1(r,e)?{from:e,to:i}:{from:r,to:e}:i?t1(e,i)?{from:i,to:e}:{from:e,to:i}:r?M3(e,r)?{from:e,to:r}:{from:r,to:e}:{from:e,to:void 0}}var KP=x.createContext(void 0);function TMe(e){if(!fm(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return s.jsx(KP.Provider,{value:t,children:e.children})}return s.jsx(kMe,{initialProps:e.initialProps,children:e.children})}function kMe(e){var t=e.initialProps,n=e.children,r=t.selected,i=r||{},a=i.from,o=i.to,l=t.min,c=t.max,u=function(p,g,m){var v,b;(v=t.onDayClick)===null||v===void 0||v.call(t,p,g,m);var y=PMe(p,r);(b=t.onSelect)===null||b===void 0||b.call(t,y,p,g,m)},d={range_start:[],range_end:[],range_middle:[],disabled:[]};if(a?(d.range_start=[a],o?(d.range_end=[o],Tr(a,o)||(d.range_middle=[{after:a,before:o}])):d.range_end=[a]):o&&(d.range_start=[o],d.range_end=[o]),l&&(a&&!o&&d.disabled.push({after:_s(a,l-1),before:fr(a,l-1)}),a&&o&&d.disabled.push({after:a,before:fr(a,l-1)}),!a&&o&&d.disabled.push({after:_s(o,l-1),before:fr(o,l-1)})),c){if(a&&!o&&(d.disabled.push({before:fr(a,-c+1)}),d.disabled.push({after:fr(a,c-1)})),a&&o){var f=Ta(o,a)+1,h=c-f;d.disabled.push({before:_s(a,h)}),d.disabled.push({after:fr(o,h)})}!a&&o&&(d.disabled.push({before:fr(o,-c+1)}),d.disabled.push({after:fr(o,c-1)}))}return s.jsx(KP.Provider,{value:{selected:r,onDayClick:u,modifiers:d},children:n})}function GP(){var e=x.useContext(KP);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function $g(e){return Array.isArray(e)?E9([],e):e!==void 0?[e]:[]}function EMe(e){var t={};return Object.entries(e).forEach(function(n){var r=n[0],i=n[1];t[r]=$g(i)}),t}var ua;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(ua||(ua={}));var OMe=ua.Selected,ls=ua.Disabled,AMe=ua.Hidden,RMe=ua.Today,Ew=ua.RangeEnd,Ow=ua.RangeMiddle,Aw=ua.RangeStart,MMe=ua.Outside;function DMe(e,t,n){var r,i=(r={},r[OMe]=$g(e.selected),r[ls]=$g(e.disabled),r[AMe]=$g(e.hidden),r[RMe]=[e.today],r[Ew]=[],r[Ow]=[],r[Aw]=[],r[MMe]=[],r);return e.fromDate&&i[ls].push({before:e.fromDate}),e.toDate&&i[ls].push({after:e.toDate}),dm(e)?i[ls]=i[ls].concat(t.modifiers[ls]):fm(e)&&(i[ls]=i[ls].concat(n.modifiers[ls]),i[Aw]=n.modifiers[Aw],i[Ow]=n.modifiers[Ow],i[Ew]=n.modifiers[Ew]),i}var D9=x.createContext(void 0);function $Me(e){var t=Gt(),n=qP(),r=GP(),i=DMe(t,n,r),a=EMe(t.modifiers),o=ze(ze({},i),a);return s.jsx(D9.Provider,{value:o,children:e.children})}function $9(){var e=x.useContext(D9);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function IMe(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function LMe(e){return!!(e&&typeof e=="object"&&"from"in e)}function FMe(e){return!!(e&&typeof e=="object"&&"after"in e)}function UMe(e){return!!(e&&typeof e=="object"&&"before"in e)}function BMe(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function VMe(e,t){var n,r=t.from,i=t.to;if(r&&i){var a=Ta(i,r)<0;a&&(n=[i,r],r=n[0],i=n[1]);var o=Ta(e,r)>=0&&Ta(i,e)>=0;return o}return i?Tr(i,e):r?Tr(r,e):!1}function zMe(e){return N_(e)}function WMe(e){return Array.isArray(e)&&e.every(N_)}function HMe(e,t){return t.some(function(n){if(typeof n=="boolean")return n;if(zMe(n))return Tr(e,n);if(WMe(n))return n.includes(e);if(LMe(n))return VMe(e,n);if(BMe(n))return n.dayOfWeek.includes(e.getDay());if(IMe(n)){var r=Ta(n.before,e),i=Ta(n.after,e),a=r>0,o=i<0,l=t1(n.before,n.after);return l?o&&a:a||o}return FMe(n)?Ta(e,n.after)>0:UMe(n)?Ta(n.before,e)>0:typeof n=="function"?n(e):!1})}function YP(e,t,n){var r=Object.keys(t).reduce(function(a,o){var l=t[o];return HMe(e,l)&&a.push(o),a},[]),i={};return r.forEach(function(a){return i[a]=!0}),n&&!k_(e,n)&&(i.outside=!0),i}function qMe(e,t){for(var n=Mr(e[0]),r=hx(e[e.length-1]),i,a,o=n;o<=r;){var l=YP(o,t),c=!l.disabled&&!l.hidden;if(!c){o=fr(o,1);continue}if(l.selected)return o;l.today&&!a&&(a=o),i||(i=o),o=fr(o,1)}return a||i}var KMe=365;function I9(e,t){var n=t.moveBy,r=t.direction,i=t.context,a=t.modifiers,o=t.retry,l=o===void 0?{count:0,lastFocused:e}:o,c=i.weekStartsOn,u=i.fromDate,d=i.toDate,f=i.locale,h={day:fr,week:e1,month:ia,year:FQ,startOfWeek:function(v){return i.ISOWeek?ec(v):za(v,{locale:f,weekStartsOn:c})},endOfWeek:function(v){return i.ISOWeek?P3(v):P_(v,{locale:f,weekStartsOn:c})}},p=h[n](e,r==="after"?1:-1);r==="before"&&u?p=UQ([u,p]):r==="after"&&d&&(p=BQ([d,p]));var g=!0;if(a){var m=YP(p,a);g=!m.disabled&&!m.hidden}return g?p:l.count>KMe?l.lastFocused:I9(p,{moveBy:n,direction:r,context:i,modifiers:a,retry:ze(ze({},l),{count:l.count+1})})}var L9=x.createContext(void 0);function GMe(e){var t=hm(),n=$9(),r=x.useState(),i=r[0],a=r[1],o=x.useState(),l=o[0],c=o[1],u=qMe(t.displayMonths,n),d=i??(l&&t.isDateDisplayed(l))?l:u,f=function(){c(i),a(void 0)},h=function(v){a(v)},p=Gt(),g=function(v,b){if(i){var y=I9(i,{moveBy:v,direction:b,context:p,modifiers:n});Tr(i,y)||(t.goToDate(y,i),h(y))}},m={focusedDay:i,focusTarget:d,blur:f,focus:h,focusDayAfter:function(){return g("day","after")},focusDayBefore:function(){return g("day","before")},focusWeekAfter:function(){return g("week","after")},focusWeekBefore:function(){return g("week","before")},focusMonthBefore:function(){return g("month","before")},focusMonthAfter:function(){return g("month","after")},focusYearBefore:function(){return g("year","before")},focusYearAfter:function(){return g("year","after")},focusStartOfWeek:function(){return g("startOfWeek","before")},focusEndOfWeek:function(){return g("endOfWeek","after")}};return s.jsx(L9.Provider,{value:m,children:e.children})}function QP(){var e=x.useContext(L9);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function YMe(e,t){var n=$9(),r=YP(e,n,t);return r}var XP=x.createContext(void 0);function QMe(e){if(!I0(e.initialProps)){var t={selected:void 0};return s.jsx(XP.Provider,{value:t,children:e.children})}return s.jsx(XMe,{initialProps:e.initialProps,children:e.children})}function XMe(e){var t=e.initialProps,n=e.children,r=function(a,o,l){var c,u,d;if((c=t.onDayClick)===null||c===void 0||c.call(t,a,o,l),o.selected&&!t.required){(u=t.onSelect)===null||u===void 0||u.call(t,void 0,a,o,l);return}(d=t.onSelect)===null||d===void 0||d.call(t,a,a,o,l)},i={selected:t.selected,onDayClick:r};return s.jsx(XP.Provider,{value:i,children:n})}function F9(){var e=x.useContext(XP);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function ZMe(e,t){var n=Gt(),r=F9(),i=qP(),a=GP(),o=QP(),l=o.focusDayAfter,c=o.focusDayBefore,u=o.focusWeekAfter,d=o.focusWeekBefore,f=o.blur,h=o.focus,p=o.focusMonthBefore,g=o.focusMonthAfter,m=o.focusYearBefore,v=o.focusYearAfter,b=o.focusStartOfWeek,y=o.focusEndOfWeek,w=function(F){var R,U,G,$;I0(n)?(R=r.onDayClick)===null||R===void 0||R.call(r,e,t,F):dm(n)?(U=i.onDayClick)===null||U===void 0||U.call(i,e,t,F):fm(n)?(G=a.onDayClick)===null||G===void 0||G.call(a,e,t,F):($=n.onDayClick)===null||$===void 0||$.call(n,e,t,F)},C=function(F){var R;h(e),(R=n.onDayFocus)===null||R===void 0||R.call(n,e,t,F)},j=function(F){var R;f(),(R=n.onDayBlur)===null||R===void 0||R.call(n,e,t,F)},S=function(F){var R;(R=n.onDayMouseEnter)===null||R===void 0||R.call(n,e,t,F)},_=function(F){var R;(R=n.onDayMouseLeave)===null||R===void 0||R.call(n,e,t,F)},N=function(F){var R;(R=n.onDayPointerEnter)===null||R===void 0||R.call(n,e,t,F)},P=function(F){var R;(R=n.onDayPointerLeave)===null||R===void 0||R.call(n,e,t,F)},O=function(F){var R;(R=n.onDayTouchCancel)===null||R===void 0||R.call(n,e,t,F)},T=function(F){var R;(R=n.onDayTouchEnd)===null||R===void 0||R.call(n,e,t,F)},E=function(F){var R;(R=n.onDayTouchMove)===null||R===void 0||R.call(n,e,t,F)},k=function(F){var R;(R=n.onDayTouchStart)===null||R===void 0||R.call(n,e,t,F)},D=function(F){var R;(R=n.onDayKeyUp)===null||R===void 0||R.call(n,e,t,F)},A=function(F){var R;switch(F.key){case"ArrowLeft":F.preventDefault(),F.stopPropagation(),n.dir==="rtl"?l():c();break;case"ArrowRight":F.preventDefault(),F.stopPropagation(),n.dir==="rtl"?c():l();break;case"ArrowDown":F.preventDefault(),F.stopPropagation(),u();break;case"ArrowUp":F.preventDefault(),F.stopPropagation(),d();break;case"PageUp":F.preventDefault(),F.stopPropagation(),F.shiftKey?m():p();break;case"PageDown":F.preventDefault(),F.stopPropagation(),F.shiftKey?v():g();break;case"Home":F.preventDefault(),F.stopPropagation(),b();break;case"End":F.preventDefault(),F.stopPropagation(),y();break}(R=n.onDayKeyDown)===null||R===void 0||R.call(n,e,t,F)},B={onClick:w,onFocus:C,onBlur:j,onKeyDown:A,onKeyUp:D,onMouseEnter:S,onMouseLeave:_,onPointerEnter:N,onPointerLeave:P,onTouchCancel:O,onTouchEnd:T,onTouchMove:E,onTouchStart:k};return B}function JMe(){var e=Gt(),t=F9(),n=qP(),r=GP(),i=I0(e)?t.selected:dm(e)?n.selected:fm(e)?r.selected:void 0;return i}function e2e(e){return Object.values(ua).includes(e)}function t2e(e,t){var n=[e.classNames.day];return Object.keys(t).forEach(function(r){var i=e.modifiersClassNames[r];if(i)n.push(i);else if(e2e(r)){var a=e.classNames["day_".concat(r)];a&&n.push(a)}}),n}function n2e(e,t){var n=ze({},e.styles.day);return Object.keys(t).forEach(function(r){var i;n=ze(ze({},n),(i=e.modifiersStyles)===null||i===void 0?void 0:i[r])}),n}function r2e(e,t,n){var r,i,a,o=Gt(),l=QP(),c=YMe(e,t),u=ZMe(e,c),d=JMe(),f=!!(o.onDayClick||o.mode!=="default");x.useEffect(function(){var S;c.outside||l.focusedDay&&f&&Tr(l.focusedDay,e)&&((S=n.current)===null||S===void 0||S.focus())},[l.focusedDay,e,n,f,c.outside]);var h=t2e(o,c).join(" "),p=n2e(o,c),g=!!(c.outside&&!o.showOutsideDays||c.hidden),m=(a=(i=o.components)===null||i===void 0?void 0:i.DayContent)!==null&&a!==void 0?a:CMe,v=s.jsx(m,{date:e,displayMonth:t,activeModifiers:c}),b={style:p,className:h,children:v,role:"gridcell"},y=l.focusTarget&&Tr(l.focusTarget,e)&&!c.outside,w=l.focusedDay&&Tr(l.focusedDay,e),C=ze(ze(ze({},b),(r={disabled:c.disabled,role:"gridcell"},r["aria-selected"]=c.selected,r.tabIndex=w||y?0:-1,r)),u),j={isButton:f,isHidden:g,activeModifiers:c,selectedDays:d,buttonProps:C,divProps:b};return j}function i2e(e){var t=x.useRef(null),n=r2e(e.date,e.displayMonth,t);return n.isHidden?s.jsx("div",{role:"gridcell"}):n.isButton?s.jsx(Fy,ze({name:"day",ref:t},n.buttonProps)):s.jsx("div",ze({},n.divProps))}function a2e(e){var t=e.number,n=e.dates,r=Gt(),i=r.onWeekNumberClick,a=r.styles,o=r.classNames,l=r.locale,c=r.labels.labelWeekNumber,u=r.formatters.formatWeekNumber,d=u(Number(t),{locale:l});if(!i)return s.jsx("span",{className:o.weeknumber,style:a.weeknumber,children:d});var f=c(Number(t),{locale:l}),h=function(p){i(t,n,p)};return s.jsx(Fy,{name:"week-number","aria-label":f,className:o.weeknumber,style:a.weeknumber,onClick:h,children:d})}function s2e(e){var t,n,r=Gt(),i=r.styles,a=r.classNames,o=r.showWeekNumber,l=r.components,c=(t=l==null?void 0:l.Day)!==null&&t!==void 0?t:i2e,u=(n=l==null?void 0:l.WeekNumber)!==null&&n!==void 0?n:a2e,d;return o&&(d=s.jsx("td",{className:a.cell,style:i.cell,children:s.jsx(u,{number:e.weekNumber,dates:e.dates})})),s.jsxs("tr",{className:a.row,style:i.row,children:[d,e.dates.map(function(f){return s.jsx("td",{className:a.cell,style:i.cell,role:"presentation",children:s.jsx(c,{displayMonth:e.displayMonth,date:f})},KX(f))})]})}function VM(e,t,n){for(var r=n!=null&&n.ISOWeek?P3(t):P_(t,n),i=n!=null&&n.ISOWeek?ec(e):za(e,n),a=Ta(r,i),o=[],l=0;l<=a;l++)o.push(fr(i,l));var c=o.reduce(function(u,d){var f=n!=null&&n.ISOWeek?T3(d):E3(d,n),h=u.find(function(p){return p.weekNumber===f});return h?(h.dates.push(d),u):(u.push({weekNumber:f,dates:[d]}),u)},[]);return c}function o2e(e,t){var n=VM(Mr(e),hx(e),t);if(t!=null&&t.useFixedWeeks){var r=YX(e,t);if(r<6){var i=n[n.length-1],a=i.dates[i.dates.length-1],o=e1(a,6-r),l=VM(e1(a,1),o,t);n.push.apply(n,l)}}return n}function l2e(e){var t,n,r,i=Gt(),a=i.locale,o=i.classNames,l=i.styles,c=i.hideHead,u=i.fixedWeeks,d=i.components,f=i.weekStartsOn,h=i.firstWeekContainsDate,p=i.ISOWeek,g=o2e(e.displayMonth,{useFixedWeeks:!!u,ISOWeek:p,locale:a,weekStartsOn:f,firstWeekContainsDate:h}),m=(t=d==null?void 0:d.Head)!==null&&t!==void 0?t:SMe,v=(n=d==null?void 0:d.Row)!==null&&n!==void 0?n:s2e,b=(r=d==null?void 0:d.Footer)!==null&&r!==void 0?r:bMe;return s.jsxs("table",{id:e.id,className:o.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&s.jsx(m,{}),s.jsx("tbody",{className:o.tbody,style:l.tbody,children:g.map(function(y){return s.jsx(v,{displayMonth:e.displayMonth,dates:y.dates,weekNumber:y.weekNumber},y.weekNumber)})}),s.jsx(b,{displayMonth:e.displayMonth})]})}function c2e(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var u2e=c2e()?x.useLayoutEffect:x.useEffect,Rw=!1,d2e=0;function zM(){return"react-day-picker-".concat(++d2e)}function f2e(e){var t,n=e??(Rw?zM():null),r=x.useState(n),i=r[0],a=r[1];return u2e(function(){i===null&&a(zM())},[]),x.useEffect(function(){Rw===!1&&(Rw=!0)},[]),(t=e??i)!==null&&t!==void 0?t:void 0}function h2e(e){var t,n,r=Gt(),i=r.dir,a=r.classNames,o=r.styles,l=r.components,c=hm().displayMonths,u=f2e(r.id?"".concat(r.id,"-").concat(e.displayIndex):void 0),d=r.id?"".concat(r.id,"-grid-").concat(e.displayIndex):void 0,f=[a.month],h=o.month,p=e.displayIndex===0,g=e.displayIndex===c.length-1,m=!p&&!g;i==="rtl"&&(t=[p,g],g=t[0],p=t[1]),p&&(f.push(a.caption_start),h=ze(ze({},h),o.caption_start)),g&&(f.push(a.caption_end),h=ze(ze({},h),o.caption_end)),m&&(f.push(a.caption_between),h=ze(ze({},h),o.caption_between));var v=(n=l==null?void 0:l.Caption)!==null&&n!==void 0?n:xMe;return s.jsxs("div",{className:f.join(" "),style:h,children:[s.jsx(v,{id:u,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),s.jsx(l2e,{id:d,"aria-labelledby":u,displayMonth:e.displayMonth})]},e.displayIndex)}function p2e(e){var t=Gt(),n=t.classNames,r=t.styles;return s.jsx("div",{className:n.months,style:r.months,children:e.children})}function m2e(e){var t,n,r=e.initialProps,i=Gt(),a=QP(),o=hm(),l=x.useState(!1),c=l[0],u=l[1];x.useEffect(function(){i.initialFocus&&a.focusTarget&&(c||(a.focus(a.focusTarget),u(!0)))},[i.initialFocus,c,a.focus,a.focusTarget,a]);var d=[i.classNames.root,i.className];i.numberOfMonths>1&&d.push(i.classNames.multiple_months),i.showWeekNumber&&d.push(i.classNames.with_weeknumber);var f=ze(ze({},i.styles.root),i.style),h=Object.keys(r).filter(function(g){return g.startsWith("data-")}).reduce(function(g,m){var v;return ze(ze({},g),(v={},v[m]=r[m],v))},{}),p=(n=(t=r.components)===null||t===void 0?void 0:t.Months)!==null&&n!==void 0?n:p2e;return s.jsx("div",ze({className:d.join(" "),style:f,dir:i.dir,id:i.id,nonce:r.nonce,title:r.title,lang:r.lang},h,{children:s.jsx(p,{children:o.displayMonths.map(function(g,m){return s.jsx(h2e,{displayIndex:m,displayMonth:g},m)})})}))}function g2e(e){var t=e.children,n=URe(e,["children"]);return s.jsx(aMe,{initialProps:n,children:s.jsx(mMe,{children:s.jsx(QMe,{initialProps:n,children:s.jsx(_Me,{initialProps:n,children:s.jsx(TMe,{initialProps:n,children:s.jsx($Me,{children:s.jsx(GMe,{children:t})})})})})})})}function v2e(e){return s.jsx(g2e,ze({},e,{children:s.jsx(m2e,{initialProps:e})}))}function Sd({className:e,classNames:t,showOutsideDays:n=!0,...r}){return s.jsx(v2e,{showOutsideDays:n,className:fe("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:fe(Hu({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:fe(Hu({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"text-muted-foreground opacity-50",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...i})=>s.jsx(ux,{className:"h-4 w-4"}),IconRight:({...i})=>s.jsx(dx,{className:"h-4 w-4"})},...r})}Sd.displayName="Calendar";var ZP="Popover",[U9,u$e]=da(ZP,[nl]),pm=nl(),[y2e,dl]=U9(ZP),B9=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:i,onOpenChange:a,modal:o=!1}=e,l=pm(t),c=x.useRef(null),[u,d]=x.useState(!1),[f=!1,h]=ra({prop:r,defaultProp:i,onChange:a});return s.jsx(_x,{...l,children:s.jsx(y2e,{scope:t,contentId:bi(),triggerRef:c,open:f,onOpenChange:h,onOpenToggle:x.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:u,onCustomAnchorAdd:x.useCallback(()=>d(!0),[]),onCustomAnchorRemove:x.useCallback(()=>d(!1),[]),modal:o,children:n})})};B9.displayName=ZP;var V9="PopoverAnchor",x2e=x.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,i=dl(V9,n),a=pm(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=i;return x.useEffect(()=>(o(),()=>l()),[o,l]),s.jsx(Xp,{...a,...r,ref:t})});x2e.displayName=V9;var z9="PopoverTrigger",W9=x.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,i=dl(z9,n),a=pm(n),o=ut(t,i.triggerRef),l=s.jsx(Me.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":Y9(i.open),...r,ref:o,onClick:he(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?l:s.jsx(Xp,{asChild:!0,...a,children:l})});W9.displayName=z9;var JP="PopoverPortal",[b2e,w2e]=U9(JP,{forceMount:void 0}),H9=e=>{const{__scopePopover:t,forceMount:n,children:r,container:i}=e,a=dl(JP,t);return s.jsx(b2e,{scope:t,forceMount:n,children:s.jsx(Fr,{present:n||a.open,children:s.jsx(Od,{asChild:!0,container:i,children:r})})})};H9.displayName=JP;var Cd="PopoverContent",q9=x.forwardRef((e,t)=>{const n=w2e(Cd,e.__scopePopover),{forceMount:r=n.forceMount,...i}=e,a=dl(Cd,e.__scopePopover);return s.jsx(Fr,{present:r||a.open,children:a.modal?s.jsx(j2e,{...i,ref:t}):s.jsx(S2e,{...i,ref:t})})});q9.displayName=Cd;var j2e=x.forwardRef((e,t)=>{const n=dl(Cd,e.__scopePopover),r=x.useRef(null),i=ut(t,r),a=x.useRef(!1);return x.useEffect(()=>{const o=r.current;if(o)return xx(o)},[]),s.jsx(Yp,{as:Ba,allowPinchZoom:!0,children:s.jsx(K9,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:he(e.onCloseAutoFocus,o=>{var l;o.preventDefault(),a.current||(l=n.triggerRef.current)==null||l.focus()}),onPointerDownOutside:he(e.onPointerDownOutside,o=>{const l=o.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;a.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:he(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),S2e=x.forwardRef((e,t)=>{const n=dl(Cd,e.__scopePopover),r=x.useRef(!1),i=x.useRef(!1);return s.jsx(K9,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{var o,l;(o=e.onCloseAutoFocus)==null||o.call(e,a),a.defaultPrevented||(r.current||(l=n.triggerRef.current)==null||l.focus(),a.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:a=>{var c,u;(c=e.onInteractOutside)==null||c.call(e,a),a.defaultPrevented||(r.current=!0,a.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=a.target;((u=n.triggerRef.current)==null?void 0:u.contains(o))&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&i.current&&a.preventDefault()}})}),K9=x.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:a,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:d,...f}=e,h=dl(Cd,n),p=pm(n);return vx(),s.jsx(Gp,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:a,children:s.jsx(gc,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:d,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:u,onDismiss:()=>h.onOpenChange(!1),children:s.jsx(Nx,{"data-state":Y9(h.open),role:"dialog",id:h.contentId,...p,...f,ref:t,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),G9="PopoverClose",C2e=x.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,i=dl(G9,n);return s.jsx(Me.button,{type:"button",...r,ref:t,onClick:he(e.onClick,()=>i.onOpenChange(!1))})});C2e.displayName=G9;var _2e="PopoverArrow",N2e=x.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,i=pm(n);return s.jsx(Px,{...i,...r,ref:t})});N2e.displayName=_2e;function Y9(e){return e?"open":"closed"}var P2e=B9,T2e=W9,k2e=H9,Q9=q9;const Ep=P2e,Op=T2e,_d=x.forwardRef(({className:e,align:t="center",sideOffset:n=4,...r},i)=>s.jsx(k2e,{children:s.jsx(Q9,{ref:i,align:t,sideOffset:n,className:fe("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));_d.displayName=Q9.displayName;function Uy({date:e,setDate:t,className:n}){return s.jsx("div",{className:fe("grid gap-2",n),children:s.jsxs(Ep,{children:[s.jsx(Op,{asChild:!0,children:s.jsxs(Y,{id:"date",variant:"outline",className:fe("w-full justify-start text-left font-normal",!e&&"text-muted-foreground"),children:[s.jsx(Fu,{className:"mr-2 h-4 w-4"}),e?_t(e,"PPP"):s.jsx("span",{children:"Pick a date"})]})}),s.jsx(_d,{className:"w-auto p-0",align:"start",children:s.jsx(Sd,{mode:"single",selected:e,onSelect:t,initialFocus:!0})})]})})}function E2e(){const[,e]=Ir(),[t,n]=x.useState(""),[r,i]=x.useState("today"),[a,o]=x.useState(_s(new Date,7)),[l,c]=x.useState(new Date),[u,d]=x.useState("all"),[f,h]=x.useState(1),[p]=x.useState(20),g={filterType:r,page:f.toString(),limit:p.toString()};t&&(g.search=t),u!=="all"&&(g.campaignId=u),r==="custom_range"&&a&&l&&(g.startDate=_t(a,"yyyy-MM-dd"),g.endDate=_t(l,"yyyy-MM-dd"));const{data:m}=Tt({queryKey:["/api/campaigns"],queryFn:async()=>{const k=await fetch("/api/campaigns");if(!k.ok)throw new Error("Failed to fetch campaigns");return k.json()}}),{data:v,isLoading:b,error:y}=Tt({queryKey:["/api/campaign-click-records",g],queryFn:async()=>{const k=new URLSearchParams(g),D=await fetch(`/api/campaign-click-records?${k}`);if(!D.ok)throw new Error("Failed to fetch campaign click records");return D.json()}}),w=(v==null?void 0:v.records)||[],C=(v==null?void 0:v.total)||0,j=Math.ceil(C/p),S=k=>{n(k.target.value),h(1)},_=k=>{i(k),h(1)},N=k=>{d(k),h(1)},P=k=>{k>=1&&k<=j&&h(k)},O=k=>{const D=new URLSearchParams({filterType:r,...r==="custom_range"?{startDate:_t(a||new Date,"yyyy-MM-dd"),endDate:_t(l||new Date,"yyyy-MM-dd")}:{}}).toString();e(`/campaign-click-detail/${k}?${D}`)},T=k=>{try{const D=n1(k);return _t(D,"MMM dd, yyyy HH:mm:ss")}catch{return k}},E=()=>{const k=[];if(j<=5)for(let A=1;A<=j;A++)k.push(s.jsx(Nr,{children:s.jsx(js,{isActive:f===A,onClick:()=>P(A),children:A})},A));else{k.push(s.jsx(Nr,{children:s.jsx(js,{isActive:f===1,onClick:()=>P(1),children:"1"})},1));let A=Math.max(2,f-1),B=Math.min(j-1,f+1);f<=3&&(B=Math.min(4,j-1)),f>=j-2&&(A=Math.max(2,j-3)),A>2&&k.push(s.jsx(Nr,{children:s.jsx(uC,{})},"ellipsis-start"));for(let F=A;F<=B;F++)k.push(s.jsx(Nr,{children:s.jsx(js,{isActive:f===F,onClick:()=>P(F),children:F})},F));B<j-1&&k.push(s.jsx(Nr,{children:s.jsx(uC,{})},"ellipsis-end")),k.push(s.jsx(Nr,{children:s.jsx(js,{isActive:f===j,onClick:()=>P(j),children:j})},j))}return k};return s.jsx("div",{className:"container mx-auto py-6 space-y-6",children:s.jsxs(qe,{children:[s.jsx(Xe,{children:s.jsx("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4",children:s.jsxs("div",{children:[s.jsx(Ze,{className:"text-2xl font-bold",children:"Campaign Click Records"}),s.jsx(ft,{children:"View and analyze individual campaign redirect traffic"})]})})}),s.jsxs(Ke,{children:[s.jsxs("div",{className:"grid gap-4 mb-6",children:[s.jsxs("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(ye,{placeholder:"Search by IP or URL...",value:t,onChange:S,className:"pl-9"}),s.jsx(Jl,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"})]}),s.jsx("div",{children:s.jsxs(Nt,{value:r,onValueChange:_,children:[s.jsxs(bt,{children:[s.jsx(Fu,{className:"mr-2 h-4 w-4"}),s.jsx(Pt,{placeholder:"Filter by Period"})]}),s.jsxs(wt,{children:[s.jsx(X,{value:"today",children:"Today"}),s.jsx(X,{value:"yesterday",children:"Yesterday"}),s.jsx(X,{value:"last_7_days",children:"Last 7 Days"}),s.jsx(X,{value:"last_30_days",children:"Last 30 Days"}),s.jsx(X,{value:"this_month",children:"This Month"}),s.jsx(X,{value:"last_month",children:"Last Month"}),s.jsx(X,{value:"custom_range",children:"Custom Date Range"})]})]})}),s.jsx("div",{children:s.jsxs(Nt,{value:u,onValueChange:N,children:[s.jsxs(bt,{children:[s.jsx(c3,{className:"mr-2 h-4 w-4"}),s.jsx(Pt,{placeholder:"Filter by Campaign"})]}),s.jsxs(wt,{children:[s.jsx(X,{value:"all",children:"All Campaigns"}),m==null?void 0:m.map(k=>s.jsx(X,{value:k.id.toString(),children:k.name},k.id))]})]})}),r==="custom_range"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsx(Uy,{selected:a,onSelect:o,disabled:b,placeholder:"Start Date"})}),s.jsx("div",{children:s.jsx(Uy,{selected:l,onSelect:c,disabled:b,placeholder:"End Date"})})]})]}),u!=="all"&&s.jsx("div",{className:"flex justify-end",children:s.jsxs(Y,{variant:"outline",size:"sm",onClick:()=>O(parseInt(u)),children:[s.jsx(l3,{className:"mr-2 h-4 w-4"}),"View Detailed Analysis"]})})]}),y?s.jsxs(yc,{variant:"destructive",className:"mb-6",children:[s.jsx(Ad,{className:"h-4 w-4"}),s.jsx(zd,{children:"Error"}),s.jsx(xc,{children:"Failed to load campaign click records. Please try again later."})]}):b?s.jsx("div",{className:"flex justify-center items-center py-20",children:s.jsx(We,{className:"h-12 w-12 animate-spin text-muted-foreground"})}):w.length===0?s.jsxs("div",{className:"text-center py-20 border rounded-md bg-muted/10",children:[s.jsx("p",{className:"text-muted-foreground mb-2",children:"No records found for the selected filters"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Try adjusting your search criteria or selecting a different date range"})]}):s.jsxs(s.Fragment,{children:[s.jsxs(ma,{className:"mb-6",children:[s.jsx(ga,{children:s.jsxs(Rt,{children:[s.jsx(Ce,{children:"Time"}),s.jsx(Ce,{children:"Campaign"}),s.jsx(Ce,{className:"hidden md:table-cell",children:"IP Address"}),s.jsx(Ce,{className:"hidden lg:table-cell",children:"Referrer"}),s.jsx(Ce,{children:"URL"}),s.jsx(Ce,{className:"w-[100px] text-right",children:"Actions"})]})}),s.jsx(va,{children:w.map(k=>s.jsxs(Rt,{children:[s.jsx(ge,{className:"font-medium",children:T(k.createdAt)}),s.jsx(ge,{children:k.campaignName}),s.jsx(ge,{className:"hidden md:table-cell",children:k.ip}),s.jsx(ge,{className:"hidden lg:table-cell max-w-[200px] truncate",children:k.referrer||"-"}),s.jsx(ge,{className:"max-w-[200px] truncate",children:k.originalUrl}),s.jsx(ge,{className:"text-right",children:s.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>O(k.campaignId),children:s.jsx(dx,{className:"h-4 w-4"})})})]},k.id))})]}),j>1&&s.jsx(R0,{children:s.jsxs(M0,{children:[s.jsx(D0,{onClick:()=>P(f-1),disabled:f===1}),E(),s.jsx($0,{onClick:()=>P(f+1),disabled:f===j})]})}),s.jsxs("div",{className:"text-sm text-muted-foreground text-center mt-4",children:["Showing ",Math.min((f-1)*p+1,C)," to ",Math.min(f*p,C)," of ",C," records"]})]})]})]})})}function O2e(){var O;const[e,t]=Ir(),[n,r]=x.useState(null),[i,a]=x.useState("today"),[o,l]=x.useState(_s(new Date,7)),[c,u]=x.useState(new Date),[d,f]=x.useState("daily");x.useEffect(()=>{const T=e.match(/\/campaign-click-detail\/(\d+)/);T&&T[1]&&r(parseInt(T[1]));const E=new URLSearchParams(e.split("?")[1]);if(E.has("filterType")&&a(E.get("filterType")||"today"),E.has("startDate")&&E.has("endDate"))try{l(n1(E.get("startDate")||"")),u(n1(E.get("endDate")||""))}catch(k){console.error("Error parsing dates:",k)}},[e]);const h=x.useMemo(()=>{const T={filterType:i,showHourly:"true",_timestamp:Date.now().toString()};return i==="custom_range"&&o&&c&&(T.startDate=_t(o,"yyyy-MM-dd"),T.endDate=_t(c,"yyyy-MM-dd")),console.log(`📊 Client sending request with filter: ${i}`,T),T},[i,o,c]),{data:p,isLoading:g}=Tt({queryKey:[`/api/campaigns/${n}`],enabled:!!n}),{data:m,isLoading:v}=Tt({queryKey:[`/api/campaign-click-records/summary/${n}`,i,o,c],queryFn:async()=>{const T={...h,_timestamp:Date.now().toString()},E=Object.entries(T).map(([D,A])=>`${encodeURIComponent(D)}=${encodeURIComponent(A)}`).join("&"),k=await fetch(`/api/campaign-click-records/summary/${n}?${E}`);if(!k.ok)throw new Error("Failed to fetch summary data");return await k.json()},enabled:!!n,onSuccess:T=>{console.log(`📊 Received filtered data for ${i} with ${(T==null?void 0:T.totalClicks)||0} total clicks`),console.log("📊 Filter info:",T==null?void 0:T.filterInfo)},onError:T=>{console.error("❌ Error fetching filtered data:",T)}}),b=T=>{console.log(`📊 Filter type changed from ${i} to ${T}`),a(T),T!=="custom_range"&&(T==="last_7_days"?l(_s(new Date,7)):T==="last_30_days"&&l(_s(new Date,30)),u(new Date))},y=()=>{t("/campaign-click-records")},w=()=>{},{toast:C}=xn(),j=yt({mutationFn:async()=>n?await(await Qe("POST","/api/campaign-click-records/generate-specific-test-data",{campaignId:n,clicksPerDay:20})).json():void 0,onSuccess:T=>{Cs.invalidateQueries({queryKey:[`/api/campaign-click-records/summary/${n}`]}),C({title:"Test data generated",description:`Created ${T.counts.total} test clicks across different time periods.`,duration:5e3})},onError:T=>{C({title:"Failed to generate test data",description:T instanceof Error?T.message:"Unknown error",variant:"destructive"})}}),S=()=>{if(!m)return console.log("No summary data available"),[{date:new Date().toISOString().split("T")[0],clicks:0}];const T=parseInt(m.totalClicks)||0;if(!m.dailyBreakdown||Object.keys(m.dailyBreakdown).length===0)return console.log("No daily breakdown data available"),[{date:new Date().toISOString().split("T")[0],clicks:T}];console.log("Raw daily breakdown data:",m.dailyBreakdown);const E=Object.entries(m.dailyBreakdown).map(([k,D])=>({date:k,clicks:D}));if(E.length===0){const k=new Date().toISOString().split("T")[0];E.push({date:k,clicks:T})}return console.log("Formatted daily data:",E),E},_=()=>{if(!m)return console.log("No summary data available"),Array.from({length:24},(E,k)=>({hour:`${k}:00`,clicks:0}));if(parseInt(m.totalClicks),!m.hourlyBreakdown)return console.log("No hourly breakdown data available"),Array.from({length:24},(E,k)=>({hour:`${k}:00`,clicks:0}));if(console.log("Raw hourly breakdown data:",m.hourlyBreakdown),m.hourlyBreakdown.length===0)return Array.from({length:24},(E,k)=>({hour:`${k}:00`,clicks:0}));const T=m.hourlyBreakdown.map(E=>({hour:`${E.hour}:00`,clicks:E.clicks}));return console.log("Formatted hourly data:",T),T},N=g||v,P=(T,E)=>[T,"Clicks"];return s.jsx("div",{className:"container mx-auto py-6 space-y-6",children:s.jsxs(qe,{children:[s.jsx(Xe,{children:s.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Y,{variant:"outline",size:"icon",onClick:y,children:s.jsx(ux,{className:"h-4 w-4"})}),s.jsxs("div",{children:[s.jsx(Ze,{className:"text-2xl font-bold",children:N?"Loading...":(p==null?void 0:p.name)||`Campaign #${n}`}),s.jsx(ft,{children:"Click statistics and performance analysis"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Y,{variant:"outline",size:"sm",onClick:()=>j.mutate(),disabled:j.isPending,children:j.isPending?s.jsxs(s.Fragment,{children:[s.jsx(We,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):s.jsxs(s.Fragment,{children:[s.jsx(BY,{className:"h-4 w-4 mr-2"}),"Generate Test Data"]})}),s.jsx(Y,{variant:"outline",size:"sm",asChild:!0,children:s.jsxs(Pn,{href:`/campaigns/${n}`,children:[s.jsx(c3,{className:"h-4 w-4 mr-2"}),"View Campaign Details"]})})]})]})}),s.jsxs(Ke,{children:[s.jsxs("div",{className:"grid gap-4 md:grid-cols-3 mb-6",children:[s.jsx("div",{children:s.jsxs(Nt,{value:i,onValueChange:b,children:[s.jsx(bt,{children:s.jsx(Pt,{placeholder:"Filter by Period"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"total",children:"All Time"}),s.jsx(X,{value:"today",children:"Today"}),s.jsx(X,{value:"yesterday",children:"Yesterday"}),s.jsx(X,{value:"last_7_days",children:"Last 7 Days"}),s.jsx(X,{value:"last_30_days",children:"Last 30 Days"}),s.jsx(X,{value:"this_month",children:"This Month"}),s.jsx(X,{value:"last_month",children:"Last Month"}),s.jsx(X,{value:"custom_range",children:"Custom Date Range"})]})]})}),i==="custom_range"&&s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsx(Uy,{date:o,setDate:l,placeholder:"Start Date"})}),s.jsx("div",{children:s.jsx(Uy,{date:c,setDate:u,placeholder:"End Date"})})]})]}),i==="custom_range"&&s.jsx("div",{className:"flex justify-end mb-6",children:s.jsx(Y,{onClick:w,disabled:!o||!c,children:"Apply Filter"})}),N?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(We,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid md:grid-cols-1 gap-6 mb-6",children:s.jsxs(qe,{className:"shadow-sm",children:[s.jsx(Xe,{className:"pb-2",children:s.jsx(Ze,{className:"text-sm font-medium",children:(O=m==null?void 0:m.filterInfo)!=null&&O.dateRange?`Clicks (${m.filterInfo.dateRange})`:i==="total"?"Total Clicks":i==="today"?"Clicks (Today)":i==="yesterday"?"Clicks (Yesterday)":i==="last_7_days"?"Clicks (Last 7 Days)":i==="last_30_days"?"Clicks (Last 30 Days)":i==="this_month"?"Clicks (This Month)":i==="last_month"?"Clicks (Last Month)":i==="custom_range"&&o&&c?`Clicks (${_t(o,"yyyy-MM-dd")} to ${_t(c,"yyyy-MM-dd")})`:"Filtered Clicks"})}),s.jsx(Ke,{children:s.jsx("div",{className:"text-2xl font-bold",children:(m==null?void 0:m.totalClicks)||0})})]})}),s.jsxs(rm,{value:d,onValueChange:f,className:"mb-6",children:[s.jsxs(Wd,{className:"grid w-full md:w-[400px] grid-cols-2",children:[s.jsx(la,{value:"daily",children:"Daily View"}),s.jsx(la,{value:"hourly",children:"Hourly View"})]}),s.jsx(ca,{value:"daily",className:"pt-4",children:s.jsx("div",{className:"h-80",children:s.jsx(cc,{width:"100%",height:"100%",children:s.jsxs(wRe,{data:S(),margin:{top:10,right:30,left:0,bottom:30},children:[s.jsx(Yo,{strokeDasharray:"3 3"}),s.jsx(Pi,{dataKey:"date"}),s.jsx(Ti,{}),s.jsx(Zn,{formatter:P}),s.jsx($o,{}),s.jsx(ul,{type:"monotone",dataKey:"clicks",name:"Clicks",stroke:"#8884d8",fill:"#8884d8",fillOpacity:.3})]})})})}),s.jsx(ca,{value:"hourly",className:"pt-4",children:s.jsx("div",{className:"h-80",children:s.jsx(cc,{width:"100%",height:"100%",children:s.jsxs(Ly,{data:_(),margin:{top:10,right:30,left:0,bottom:30},children:[s.jsx(Yo,{strokeDasharray:"3 3"}),s.jsx(Pi,{dataKey:"hour"}),s.jsx(Ti,{}),s.jsx(Zn,{formatter:P}),s.jsx($o,{}),s.jsx(ns,{dataKey:"clicks",name:"Clicks",fill:"#8884d8"})]})})})})]})]})]})]})})}function X9({heading:e,description:t,children:n}){return s.jsxs("div",{className:"flex items-center justify-between px-2",children:[s.jsxs("div",{className:"grid gap-1",children:[s.jsx("h1",{className:"font-bold text-3xl",children:e}),t&&s.jsx("p",{className:"text-muted-foreground",children:t})]}),n]})}function dC({children:e}){return s.jsx("div",{className:"flex-1 space-y-4 p-8 pt-6",children:e})}const A2e=({active:e,payload:t,label:n})=>e&&t&&t.length?s.jsxs("div",{className:"bg-background p-3 border rounded-md shadow-md",children:[s.jsx("p",{className:"font-medium",children:`${n}`}),s.jsx("p",{className:"text-primary",children:`${t[0].value} clicks`})]}):null;function R2e({data:e}){return!e||e.length===0?s.jsx("div",{children:"No data available"}):s.jsx("div",{className:"w-full h-[300px]",children:s.jsx(cc,{width:"100%",height:"100%",children:s.jsxs(Ly,{data:e,margin:{top:20,right:30,left:20,bottom:5},children:[s.jsx(Yo,{strokeDasharray:"3 3",vertical:!1}),s.jsx(Pi,{dataKey:"name"}),s.jsx(Ti,{allowDecimals:!1}),s.jsx(Zn,{content:s.jsx(A2e,{})}),s.jsx(ns,{dataKey:"value",fill:"currentColor",className:"text-primary fill-primary",radius:[4,4,0,0]})]})})})}/**
/var/www/UrlCampaignTracker/dist/public/assets/index-B823haLt.js:   */function qM(e,t){return e?PDe(e)?x.createElement(e,t):e:null}function PDe(e){return TDe(e)||typeof e=="function"||kDe(e)}function TDe(e){return typeof e=="function"&&(()=>{const t=Object.getPrototypeOf(e);return t.prototype&&t.prototype.isReactComponent})()}function kDe(e){return typeof e=="object"&&typeof e.$$typeof=="symbol"&&["react.memo","react.forward_ref"].includes(e.$$typeof.description)}function EDe(e){const t={state:{},onStateChange:()=>{},renderFallbackValue:null,...e},[n]=x.useState(()=>({current:yDe(t)})),[r,i]=x.useState(()=>n.current.initialState);return n.current.setOptions(a=>({...a,...e,state:{...r,...e.state},onStateChange:o=>{i(o),e.onStateChange==null||e.onStateChange(o)}})),n.current}function ODe({columns:e,data:t}){var l;const[n,r]=M.useState([]),[i,a]=M.useState([]),o=EDe({data:t,columns:e,getCoreRowModel:xDe(),getPaginationRowModel:_De(),onSortingChange:r,getSortedRowModel:NDe(),onColumnFiltersChange:a,getFilteredRowModel:CDe(),state:{sorting:n,columnFilters:i}});return s.jsxs("div",{children:[s.jsx("div",{className:"rounded-md border",children:s.jsxs(ma,{children:[s.jsx(ga,{children:o.getHeaderGroups().map(c=>s.jsx(Rt,{children:c.headers.map(u=>s.jsx(Ce,{children:u.isPlaceholder?null:qM(u.column.columnDef.header,u.getContext())},u.id))},c.id))}),s.jsx(va,{children:(l=o.getRowModel().rows)!=null&&l.length?o.getRowModel().rows.map(c=>s.jsx(Rt,{"data-state":c.getIsSelected()&&"selected",children:c.getVisibleCells().map(u=>s.jsx(ge,{children:qM(u.column.columnDef.cell,u.getContext())},u.id))},c.id)):s.jsx(Rt,{children:s.jsx(ge,{colSpan:e.length,className:"h-24 text-center",children:"No results."})})})]})}),s.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[s.jsx(Y,{variant:"outline",size:"sm",onClick:()=>o.previousPage(),disabled:!o.getCanPreviousPage(),children:"Previous"}),s.jsx(Y,{variant:"outline",size:"sm",onClick:()=>o.nextPage(),disabled:!o.getCanNextPage(),children:"Next"})]})]})}const ADe=[{accessorKey:"id",header:"ID",cell:({row:e})=>s.jsx("span",{className:"font-mono text-xs",children:e.getValue("id")})},{accessorKey:"name",header:"Name",cell:({row:e})=>s.jsx("span",{className:"font-medium",children:e.getValue("name")})},{accessorKey:"targetUrl",header:"URL",cell:({row:e})=>{const t=e.getValue("targetUrl");return s.jsxs("div",{className:"flex items-center space-x-1 max-w-[200px]",children:[s.jsx("span",{className:"truncate",children:t}),s.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0",children:s.jsx(Ds,{className:"h-3.5 w-3.5 text-muted-foreground hover:text-foreground"})})]})}},{accessorKey:"clicks",header:"Click Quantity",cell:({row:e})=>{const t=e.getValue("clicks"),n=e.original.filteredClicks||0;return s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"font-medium",children:n}),s.jsxs("span",{className:"text-xs text-muted-foreground",children:["Total: ",t]})]})}},{accessorKey:"status",header:"Status",cell:({row:e})=>{const t=e.getValue("status");return s.jsx(Ft,{variant:t==="active"?"default":t==="paused"?"outline":t==="deleted"?"destructive":"secondary",children:t.charAt(0).toUpperCase()+t.slice(1)})}},{accessorKey:"logs",header:"Logs",cell:({row:e})=>s.jsxs(ti,{children:[s.jsx(sN,{asChild:!0,children:s.jsxs(Y,{variant:"outline",size:"sm",className:"flex items-center gap-1",children:[s.jsx(p3,{className:"h-3.5 w-3.5"}),s.jsx("span",{children:"View Logs"})]})}),s.jsxs(Dr,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[s.jsx(Ji,{children:s.jsxs(ea,{children:["Click Logs for URL: ",e.getValue("name")]})}),s.jsx("div",{className:"p-4 bg-muted/50 rounded-md font-mono text-xs overflow-x-auto whitespace-pre",children:s.jsx(RDe,{urlId:e.getValue("id")})})]})]})},{accessorKey:"analytics",header:"Action",cell:({row:e})=>{const[,t]=Ir();return s.jsxs(Y,{variant:"default",size:"sm",className:"flex items-center gap-1",onClick:()=>t(`/detailed-url-record/${e.getValue("id")}`),children:[s.jsx(IY,{className:"h-3.5 w-3.5"}),s.jsx("span",{children:"Analytics"})]})}}];function RDe({urlId:e}){var i;const{data:t,isLoading:n,error:r}=Tt({queryKey:[`/api/url-click-records/raw/${e}`,e],queryFn:async()=>{const a=await fetch(`/api/url-click-records/raw/${e}`);if(!a.ok)throw new Error("Failed to fetch URL logs");return await a.json()}});return n?s.jsx("div",{className:"flex justify-center p-4",children:s.jsx(We,{className:"h-5 w-5 animate-spin"})}):r?s.jsxs("div",{className:"text-red-500",children:["Error loading logs: ",r.message]}):(i=t==null?void 0:t.rawLogs)!=null&&i.length?s.jsx("div",{children:t.rawLogs.map((a,o)=>s.jsx("div",{className:"py-1 border-b border-border last:border-0",children:a},o))}):s.jsx("div",{className:"text-muted-foreground",children:"No logs available for this URL."})}function MDe(){const[e,t]=x.useState("today"),[n,r]=x.useState(""),[i,a]=x.useState(_s(new Date,7)),[o,l]=x.useState(new Date),[c,u]=x.useState(1),[d]=x.useState(20),f={filterType:e,page:c.toString(),limit:d.toString(),timezone:"Asia/Kolkata"};n&&(f.search=n),e==="custom_range"&&i&&o&&(f.startDate=_t(i,"yyyy-MM-dd"),f.endDate=_t(o,"yyyy-MM-dd"));const{data:h,isLoading:p}=Tt({queryKey:["/api/urls"],queryFn:async()=>{const N=await fetch("/api/urls");if(!N.ok)throw new Error("Failed to fetch URLs");return N.json()}}),{data:g,isLoading:m,error:v,refetch:b}=Tt({queryKey:["/api/url-click-records/summary",f],queryFn:async()=>{const N=new URLSearchParams(f),P=await fetch(`/api/url-click-records/summary?${N.toString()}`);if(!P.ok)throw new Error("Failed to fetch URL click records summary");return P.json()}});x.useEffect(()=>{u(1)},[e,n]);const y=x.useMemo(()=>{var N;return console.log("URLs data:",h),console.log("Click data:",g),(N=h==null?void 0:h.urls)!=null&&N.length?h.urls.map(P=>{var T;const O=(T=g==null?void 0:g.urlBreakdown)==null?void 0:T.find(E=>E.urlId===P.id);return{...P,filteredClicks:(O==null?void 0:O.clicks)||0}}).filter(P=>{if(!n)return!0;const O=n.toLowerCase();return P.id.toString().includes(O)||P.name.toLowerCase().includes(O)||P.targetUrl.toLowerCase().includes(O)}):[]},[h,g,n]),w=x.useMemo(()=>g!=null&&g.dailyBreakdown?Object.entries(g.dailyBreakdown).map(([N,P])=>({name:N,value:Number(P)})):[],[g]),C=()=>{switch(e){case"today":return"Today";case"yesterday":return"Yesterday";case"last_2_days":return"Last 2 days";case"last_3_days":return"Last 3 days";case"last_4_days":return"Last 4 days";case"last_5_days":return"Last 5 days";case"last_6_days":return"Last 6 days";case"last_7_days":return"Last 7 days";case"this_month":return"This month";case"last_month":return"Last month";case"custom_range":return i&&o?`${_t(i,"MMM d, yyyy")} to ${_t(o,"MMM d, yyyy")}`:"Custom range";case"all_time":return"All time";default:return"URL clicks"}},j=x.useMemo(()=>{const N=(c-1)*d;return y.slice(N,N+d)},[y,c,d]),S=Math.ceil(y.length/d),_=N=>{r(N.target.value)};return s.jsxs(dC,{children:[s.jsx(X9,{heading:"URL Click Records",description:"View and analyze URL click data with Indian timezone (UTC+5:30)",children:s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(Y,{variant:"outline",onClick:()=>b(),children:"Refresh"})})}),s.jsxs(qe,{className:"mb-6",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"Search & Filter"}),s.jsx(ft,{children:"Find URLs by ID, Name or URL address"})]}),s.jsx(Ke,{children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-end",children:[s.jsxs("div",{className:"flex-1 w-full md:w-auto",children:[s.jsx("div",{className:"flex w-full items-center space-x-2",children:s.jsxs("div",{className:"relative flex-1",children:[s.jsx(Jl,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),s.jsx(ye,{type:"search",placeholder:"Search URLs by ID, name or URL...",className:"pl-8",value:n,onChange:_})]})}),s.jsxs("div",{className:"text-xs flex items-center gap-6 text-muted-foreground mt-2",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(WY,{className:"h-3 w-3"}),s.jsx("span",{children:"ID"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(p3,{className:"h-3 w-3"}),s.jsx("span",{children:"Name"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(GY,{className:"h-3 w-3"}),s.jsx("span",{children:"URL Address"})]})]})]}),s.jsx("div",{className:"w-full md:w-auto",children:s.jsxs(Nt,{value:e,onValueChange:N=>t(N),children:[s.jsx(bt,{className:"w-[200px]",children:s.jsx(Pt,{placeholder:"Select time period"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"today",children:"Today"}),s.jsx(X,{value:"yesterday",children:"Yesterday"}),s.jsx(X,{value:"last_2_days",children:"Last 2 days"}),s.jsx(X,{value:"last_3_days",children:"Last 3 days"}),s.jsx(X,{value:"last_4_days",children:"Last 4 days"}),s.jsx(X,{value:"last_5_days",children:"Last 5 days"}),s.jsx(X,{value:"last_6_days",children:"Last 6 days"}),s.jsx(X,{value:"last_7_days",children:"Last 7 days"}),s.jsx(X,{value:"this_month",children:"This month"}),s.jsx(X,{value:"last_month",children:"Last month"}),s.jsx(X,{value:"all_time",children:"All time"}),s.jsx(X,{value:"custom_range",children:"Custom date range"})]})]})}),e==="custom_range"&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"grid gap-2",children:s.jsxs(Ep,{children:[s.jsx(Op,{asChild:!0,children:s.jsxs(Y,{id:"date-from",variant:"outline",className:"w-[150px] justify-start text-left font-normal",children:[s.jsx(Fu,{className:"mr-2 h-4 w-4"}),i?_t(i,"PPP"):"From date"]})}),s.jsx(_d,{className:"w-auto p-0",children:s.jsx(Sd,{mode:"single",selected:i,onSelect:a,initialFocus:!0})})]})}),s.jsx("div",{className:"grid gap-2",children:s.jsxs(Ep,{children:[s.jsx(Op,{asChild:!0,children:s.jsxs(Y,{id:"date-to",variant:"outline",className:"w-[150px] justify-start text-left font-normal",children:[s.jsx(Fu,{className:"mr-2 h-4 w-4"}),o?_t(o,"PPP"):"To date"]})}),s.jsx(_d,{className:"w-auto p-0",children:s.jsx(Sd,{mode:"single",selected:o,onSelect:l,initialFocus:!0})})]})})]})]})})]}),s.jsxs(qe,{className:"mb-6",children:[s.jsxs(Xe,{children:[s.jsxs(Ze,{children:["URL Click Summary: ",C()]}),s.jsxs(ft,{children:["Total clicks for this period: ",(g==null?void 0:g.totalClicks)||0]})]}),s.jsx(Ke,{children:m?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(We,{className:"h-8 w-8 animate-spin text-primary"})}):w.length>0?s.jsx(R2e,{data:w}):s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No click data available for the selected period."})})]}),s.jsxs(qe,{children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"URL Records"}),s.jsxs(ft,{children:["All URLs with click counts for ",C()," | Searchable by ID, Name, and URL"]})]}),s.jsx(Ke,{children:p?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(We,{className:"h-8 w-8 animate-spin text-primary"})}):j.length>0?s.jsxs(s.Fragment,{children:[s.jsx(ODe,{columns:ADe,data:j}),s.jsxs("div",{className:"flex items-center justify-between mt-4",children:[s.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(c-1)*d+1," to ",Math.min(c*d,y.length)," of ",y.length," URLs"]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Y,{variant:"outline",size:"sm",onClick:()=>u(N=>Math.max(1,N-1)),disabled:c===1,children:"Previous"}),s.jsxs("div",{className:"text-sm",children:["Page ",c," of ",S||1]}),s.jsx(Y,{variant:"outline",size:"sm",onClick:()=>u(N=>Math.min(S,N+1)),disabled:c>=S,children:"Next"})]})]})]}):s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No URL records found matching your search criteria."})})]})]})}function DDe(){const{urlId:e}=j4(),t=parseInt(e||"0"),[n,r]=x.useState("today"),[i,a]=x.useState("daily"),[o,l]=x.useState(_s(new Date,7)),[c,u]=x.useState(new Date),[d,f]=x.useState("Asia/Kolkata"),h=()=>d==="Asia/Kolkata"?"IST (GMT+5:30)":"UTC (GMT+0:00)",p={filterType:n,timezone:d};n==="custom_range"&&o&&c&&(p.startDate=_t(o,"yyyy-MM-dd"),p.endDate=_t(c,"yyyy-MM-dd"));const{data:g,isLoading:m}=Tt({queryKey:[`/api/urls/${t}`],queryFn:async()=>{console.log(`Fetching URL details for ID: ${t}`);const j=await fetch(`/api/urls/${t}`);if(console.log(`URL details response status: ${j.status}`),!j.ok){const _=await j.text();throw console.error("Failed to fetch URL details:",_),new Error(`Failed to fetch URL details: ${j.status} ${_}`)}const S=await j.json();return console.log("URL data received:",S),S},retry:3,retryDelay:1e3}),{data:v,isLoading:b,refetch:y}=Tt({queryKey:[`/api/url-click-records/${t}`,p],queryFn:async()=>{console.log(`Fetching click data for URL ID: ${t} with params:`,p);const j=new URLSearchParams(p),S=await fetch(`/api/url-click-records/${t}?${j.toString()}`);if(console.log(`Click data response status: ${S.status}`),!S.ok){const N=await S.text();throw console.error("Failed to fetch URL click details:",N),new Error(`Failed to fetch URL click details: ${S.status} ${N}`)}const _=await S.json();return console.log("Click data received:",_),_},retry:3,retryDelay:1e3,enabled:!!g}),w=x.useMemo(()=>{if(!v)return[];if(i==="daily")return v.dailyBreakdown?Object.entries(v.dailyBreakdown).map(([j,S])=>({name:j,value:Number(S)})).sort((j,S)=>new Date(j.name).getTime()-new Date(S.name).getTime()):[];if(v.hourlyByDate){const j=Object.keys(v.hourlyByDate)[0];if(j&&v.hourlyByDate[j])return Object.entries(v.hourlyByDate[j]).map(([S,_])=>({name:S,value:Number(_)})).sort((S,_)=>{const N=parseInt(S.name.split(":")[0]),P=parseInt(_.name.split(":")[0]);return N-P})}return v.hourlyBreakdown?Object.entries(v.hourlyBreakdown).map(([j,S])=>({name:`${parseInt(j).toString().padStart(2,"0")}:00`,value:Number(S)})).sort((j,S)=>{const _=parseInt(j.name.split(":")[0]),N=parseInt(S.name.split(":")[0]);return _-N}):[]},[v,i]),C=()=>{switch(n){case"today":return"Today";case"yesterday":return"Yesterday";case"last_2_days":return"Last 2 days";case"last_3_days":return"Last 3 days";case"last_4_days":return"Last 4 days";case"last_5_days":return"Last 5 days";case"last_6_days":return"Last 6 days";case"last_7_days":return"Last 7 days";case"this_month":return"This month";case"last_month":return"Last month";case"this_year":return"This year";case"last_year":return"Last year";case"custom_range":return o&&c?`${_t(o,"MMM d, yyyy")} to ${_t(c,"MMM d, yyyy")}`:"Custom range";case"all_time":return"All time";default:return"URL clicks"}};return m||!g?s.jsx(dC,{children:s.jsx("div",{className:"flex items-center justify-center h-96",children:s.jsx(We,{className:"h-16 w-16 animate-spin text-primary"})})}):s.jsxs(dC,{children:[s.jsx(X9,{heading:`URL Analytics: ${g.name}`,description:`Detailed click analysis with ${d==="Asia/Kolkata"?"Indian":"UTC"} timezone (${h()})`,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Pn,{href:"/url-click-records",children:s.jsxs(Y,{variant:"outline",className:"flex items-center gap-1",children:[s.jsx(ux,{className:"h-4 w-4"}),s.jsx("span",{children:"Back to All URLs"})]})}),s.jsx(Y,{variant:"outline",onClick:()=>y(),children:"Refresh"})]})}),s.jsxs(qe,{className:"mb-6",children:[s.jsx(Xe,{children:s.jsx(Ze,{children:"URL Information"})}),s.jsx(Ke,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"ID"}),s.jsx("p",{className:"text-lg font-mono",children:g.id})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),s.jsx("p",{className:"text-lg",children:g.name})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Target URL"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("p",{className:"text-lg break-all",children:g.targetUrl}),s.jsx("a",{href:g.targetUrl,target:"_blank",rel:"noopener noreferrer",children:s.jsx(Ds,{className:"h-4 w-4 text-muted-foreground hover:text-foreground flex-shrink-0"})})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Total Clicks"}),s.jsx("p",{className:"text-lg font-semibold",children:g.clicks})]})]})})]}),s.jsxs(qe,{className:"mb-6",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"Filtering Options"}),s.jsx(ft,{children:"Select a time period to analyze click data"})]}),s.jsx(Ke,{children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-end",children:[s.jsx("div",{className:"w-full md:w-auto",children:s.jsxs(Nt,{value:n,onValueChange:j=>r(j),children:[s.jsx(bt,{className:"w-[200px]",children:s.jsx(Pt,{placeholder:"Select time period"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"today",children:"Today"}),s.jsx(X,{value:"yesterday",children:"Yesterday"}),s.jsx(X,{value:"last_2_days",children:"Last 2 days"}),s.jsx(X,{value:"last_3_days",children:"Last 3 days"}),s.jsx(X,{value:"last_4_days",children:"Last 4 days"}),s.jsx(X,{value:"last_5_days",children:"Last 5 days"}),s.jsx(X,{value:"last_6_days",children:"Last 6 days"}),s.jsx(X,{value:"last_7_days",children:"Last 7 days"}),s.jsx(X,{value:"this_month",children:"This month"}),s.jsx(X,{value:"last_month",children:"Last month"}),s.jsx(X,{value:"this_year",children:"This year"}),s.jsx(X,{value:"last_year",children:"Last year"}),s.jsx(X,{value:"all_time",children:"All time"}),s.jsx(X,{value:"custom_range",children:"Custom date range"})]})]})}),s.jsx("div",{className:"w-full md:w-auto",children:s.jsxs(Nt,{value:i,onValueChange:j=>a(j),children:[s.jsx(bt,{className:"w-[200px]",children:s.jsx(Pt,{placeholder:"Select view type"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"daily",children:"Daily View"}),s.jsx(X,{value:"hourly",children:"Hourly Breakdown"})]})]})}),s.jsx("div",{className:"w-full md:w-auto",children:s.jsxs(Nt,{value:d,onValueChange:j=>f(j),children:[s.jsx(bt,{className:"w-[200px]",children:s.jsx(Pt,{placeholder:"Select timezone"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"Asia/Kolkata",children:"Indian Time (IST/GMT+5:30)"}),s.jsx(X,{value:"UTC",children:"UTC/GMT+0:00"})]})]})}),n==="custom_range"&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"grid gap-2",children:s.jsxs(Ep,{children:[s.jsx(Op,{asChild:!0,children:s.jsxs(Y,{id:"date-from",variant:"outline",className:"w-[150px] justify-start text-left font-normal",children:[s.jsx(Fu,{className:"mr-2 h-4 w-4"}),o?_t(o,"PPP"):"From date"]})}),s.jsx(_d,{className:"w-auto p-0",children:s.jsx(Sd,{mode:"single",selected:o,onSelect:l,initialFocus:!0})})]})}),s.jsx("div",{className:"grid gap-2",children:s.jsxs(Ep,{children:[s.jsx(Op,{asChild:!0,children:s.jsxs(Y,{id:"date-to",variant:"outline",className:"w-[150px] justify-start text-left font-normal",children:[s.jsx(Fu,{className:"mr-2 h-4 w-4"}),c?_t(c,"PPP"):"To date"]})}),s.jsx(_d,{className:"w-auto p-0",children:s.jsx(Sd,{mode:"single",selected:c,onSelect:u,initialFocus:!0})})]})})]})]})})]}),s.jsxs(qe,{children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{children:[i==="daily"?"Daily":"Hourly"," Click Data: ",C()]}),i==="hourly"&&s.jsx(f3,{className:"h-4 w-4 text-muted-foreground"})]})}),s.jsxs(ft,{children:["Total clicks for this period: ",(v==null?void 0:v.totalClicks)||0]})]}),s.jsx(Ke,{children:b?s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(We,{className:"h-8 w-8 animate-spin text-primary"})}):i==="daily"&&w.length>0?s.jsx("div",{className:"h-[400px] w-full",children:s.jsx(cc,{width:"100%",height:"100%",children:s.jsxs(Ly,{data:w,margin:{top:10,right:10,left:10,bottom:40},children:[s.jsx(Pi,{dataKey:"name",angle:-45,textAnchor:"end",tick:{fontSize:12}}),s.jsx(Ti,{}),s.jsx(Zn,{formatter:j=>[`${j} clicks`,"Clicks"],labelFormatter:j=>`Date: ${j}`}),s.jsx(Yo,{stroke:"#eee",strokeDasharray:"5 5"}),s.jsx(ns,{dataKey:"value",fill:"#3366FF",radius:[4,4,0,0]})]})})}):i==="hourly"&&(v!=null&&v.hourlyByDate)&&Object.keys(v.hourlyByDate).length>0?s.jsx("div",{className:"space-y-8",children:Object.entries(v.hourlyByDate||{}).map(([j,S],_)=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Date: ",j]}),s.jsx("div",{className:"w-full overflow-auto",children:s.jsxs("table",{className:"w-full border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-secondary",children:[s.jsx("th",{className:"p-2 text-left",children:"Time"}),s.jsx("th",{className:"p-2 text-left",children:"Clicks"})]})}),s.jsxs("tbody",{children:[Object.entries(S).filter(([N,P])=>P>0).sort((N,P)=>{const O=parseInt(N[0].split(":")[0]),T=parseInt(P[0].split(":")[0]);return O-T}).map(([N,P],O)=>s.jsxs("tr",{className:O%2===0?"bg-card":"bg-muted",children:[s.jsx("td",{className:"p-2 border border-border",children:N}),s.jsx("td",{className:"p-2 border border-border",children:P})]},N)),!Object.entries(S).some(([N,P])=>P>0)&&s.jsx("tr",{children:s.jsx("td",{colSpan:2,className:"p-2 text-center text-muted-foreground",children:"No clicks recorded"})})]})]})}),_<Object.entries(v.hourlyByDate||{}).length-1&&s.jsx("div",{className:"mt-4 flex justify-center",children:s.jsx("p",{className:"text-xs text-muted-foreground",children:"Scroll down for next date"})})]},j))}):i==="hourly"&&w.length>0?s.jsx("div",{className:"h-[400px] w-full",children:s.jsx(cc,{width:"100%",height:"100%",children:s.jsxs(Ly,{data:w,margin:{top:10,right:10,left:10,bottom:40},children:[s.jsx(Pi,{dataKey:"name",angle:-45,textAnchor:"end",tick:{fontSize:12}}),s.jsx(Ti,{}),s.jsx(Zn,{formatter:j=>[`${j} clicks`,"Clicks"],labelFormatter:j=>`Hour: ${j}`}),s.jsx(Yo,{stroke:"#eee",strokeDasharray:"5 5"}),s.jsx(ns,{dataKey:"value",fill:"#3366FF",radius:[4,4,0,0]})]})})}):s.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No click data available for the selected period."})}),s.jsx(el,{className:"text-sm text-muted-foreground",children:s.jsxs("p",{children:["All times displayed in ",d==="Asia/Kolkata"?"Indian":"UTC"," timezone (",h(),")"]})})]})]})}function $De(){const{toast:e}=xn(),[t,n]=x.useState("all"),[r,i]=x.useState("all"),{data:a,isLoading:o}=Tt({queryKey:["/api/campaigns"],select:C=>C.filter(j=>j.trafficstarCampaignId)}),{data:l,isLoading:c,error:u,refetch:d}=Tt({queryKey:["/api/url-budget-logs"],queryFn:async()=>(await fetch("/api/url-budget-logs")).json(),enabled:r==="all"}),{data:f,isLoading:h,error:p,refetch:g}=Tt({queryKey:["/api/url-budget-logs",t],queryFn:async()=>(await fetch(`/api/url-budget-logs/${t}`)).json(),enabled:t!=="all"&&r==="campaign"}),m=C=>{i(C),C==="all"?d():t!=="all"&&g()},v=C=>{n(C),r==="campaign"&&C!=="all"&&g()},b=async()=>{if(confirm("Are you sure you want to clear all URL budget logs? This action cannot be undone."))try{if(!(await fetch("/api/url-budget-logs/clear",{method:"POST"})).ok)throw new Error("Failed to clear logs");e({title:"Success",description:"All URL budget logs have been cleared.",variant:"default"}),Cs.invalidateQueries({queryKey:["/api/url-budget-logs"]})}catch{e({title:"Error",description:"Failed to clear URL budget logs.",variant:"destructive"})}},y=async()=>{if(t==="all"){e({title:"Error",description:"Please select a specific campaign to clear logs.",variant:"destructive"});return}if(confirm(`Are you sure you want to clear URL budget logs for campaign ${t}? This action cannot be undone.`))try{if(!(await fetch(`/api/url-budget-logs/${t}/clear`,{method:"POST"})).ok)throw new Error("Failed to clear logs");e({title:"Success",description:`URL budget logs for campaign ${t} have been cleared.`,variant:"default"}),Cs.invalidateQueries({queryKey:["/api/url-budget-logs"]}),Cs.invalidateQueries({queryKey:["/api/url-budget-logs",t]})}catch{e({title:"Error",description:`Failed to clear URL budget logs for campaign ${t}.`,variant:"destructive"})}},w=r==="all"?(l==null?void 0:l.logs)||[]:(f==null?void 0:f.logs)||[];return s.jsx("div",{className:"container mx-auto px-4 py-6",children:s.jsxs(qe,{children:[s.jsx(Xe,{children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx(Ze,{children:"URL Budget Logs"}),s.jsx(ft,{children:"View and manage URL budget calculations for campaigns"})]}),s.jsxs(Y,{variant:"outline",size:"sm",onClick:()=>r==="all"?d():g(),className:"ml-auto",children:[s.jsx(Zl,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})}),s.jsx(Ke,{children:s.jsxs(rm,{value:r,onValueChange:m,className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsxs(Wd,{children:[s.jsx(la,{value:"all",children:"All Campaigns"}),s.jsx(la,{value:"campaign",children:"Specific Campaign"})]}),r==="campaign"&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(Nt,{value:t,onValueChange:v,children:[s.jsx(bt,{className:"w-[200px]",children:s.jsx(Pt,{placeholder:"Select a campaign"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"all",children:"All Campaigns"}),a==null?void 0:a.map(C=>s.jsx(X,{value:C.id.toString(),children:C.name},C.id))]})]}),s.jsxs(Y,{variant:"destructive",size:"sm",onClick:y,disabled:t==="all",children:[s.jsx(Sn,{className:"h-4 w-4 mr-2"}),"Clear Campaign Logs"]})]}),r==="all"&&s.jsxs(Y,{variant:"destructive",size:"sm",onClick:b,children:[s.jsx(Sn,{className:"h-4 w-4 mr-2"}),"Clear All Logs"]})]}),s.jsx(ca,{value:"all",className:"space-y-4",children:c?s.jsx("div",{className:"flex justify-center items-center py-8",children:s.jsx(We,{className:"h-8 w-8 animate-spin text-primary"})}):u?s.jsx("div",{className:"text-center py-4 text-red-500",children:"Error loading URL budget logs"}):w.length===0?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No URL budget logs found"}):s.jsx(KM,{logs:w})}),s.jsx(ca,{value:"campaign",className:"space-y-4",children:h?s.jsx("div",{className:"flex justify-center items-center py-8",children:s.jsx(We,{className:"h-8 w-8 animate-spin text-primary"})}):p?s.jsx("div",{className:"text-center py-4 text-red-500",children:"Error loading campaign URL budget logs"}):t==="all"?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"Please select a specific campaign to view logs"}):w.length===0?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No URL budget logs found for this campaign"}):s.jsx(KM,{logs:w})})]})})]})})}function KM({logs:e}){return s.jsx("div",{className:"border rounded-md",children:s.jsxs(ma,{children:[s.jsx(ga,{children:s.jsxs(Rt,{children:[s.jsx(Ce,{children:"URL ID"}),s.jsx(Ce,{children:"Campaign ID"}),s.jsx(Ce,{children:"URL Name"}),s.jsx(Ce,{children:"Price"}),s.jsx(Ce,{children:"Date & Time"})]})}),s.jsx(va,{children:e.map((t,n)=>s.jsxs(Rt,{children:[s.jsx(ge,{children:t.urlId}),s.jsx(ge,{children:t.campaignId}),s.jsx(ge,{className:"max-w-xs truncate",children:t.urlName}),s.jsxs(ge,{children:["$",parseFloat(t.price).toFixed(4)]}),s.jsx(ge,{children:t.dateTime.replace("::"," ")})]},n))})]})})}function IDe(){const{toast:e}=xn(),[t,n]=x.useState(1),[r,i]=x.useState(""),[a,o]=x.useState("all"),[l,c]=x.useState([]),[u]=x.useState(50),[d,f]=x.useState("all"),{data:h,isLoading:p,refetch:g}=Tt({queryKey:["/api/youtube-url-records",t,u,r,a],queryFn:async()=>{let N=`/api/youtube-url-records?page=${t}&limit=${u}`;r&&(N+=`&search=${encodeURIComponent(r)}`),a&&a!=="all"&&(N+=`&campaignId=${a}`);const P=await fetch(N);if(!P.ok)throw new Error("Failed to fetch YouTube URL records");return P.json()}}),{data:m}=Tt({queryKey:["/api/campaigns"],queryFn:async()=>{const N=await fetch("/api/campaigns");if(!N.ok)throw new Error("Failed to fetch campaigns");return N.json()}}),v=yt({mutationFn:async N=>{const P=await fetch("/api/youtube-url-records/bulk/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:N})});if(!P.ok)throw new Error("Failed to delete records");return P.json()},onSuccess:()=>{e({title:"Success",description:`${l.length} record(s) deleted successfully`}),c([]),Cs.invalidateQueries({queryKey:["/api/youtube-url-records"]})},onError:N=>{e({title:"Error",description:`Failed to delete records: ${N instanceof Error?N.message:"Unknown error"}`,variant:"destructive"})}}),b=()=>{l.length!==0&&window.confirm(`Are you sure you want to delete ${l.length} record(s)?`)&&v.mutate(l)},y=N=>{c(P=>P.includes(N)?P.filter(O=>O!==N):[...P,N])},w=()=>{const N=_();N.length!==0&&(l.length===N.length?c([]):c(N.map(P=>P.id)))},C=N=>{const P=N.deletionReason;if(P.includes("Direct Rejected")||P.startsWith("[Direct Rejected]")){let O=P;return P.includes("[Direct Rejected]")&&(O=P.replace("[Direct Rejected] ","")),O.includes("exceeds maximum duration")?s.jsx(Ft,{variant:"destructive",children:"Direct Rejected [Video exceeds maximum duration]"}):s.jsxs(Ft,{variant:"destructive",children:["Direct Rejected [",O,"]"]})}else return P.includes("Age restricted video")||P.includes("age_restricted")?s.jsx(Ft,{variant:"destructive",children:"Age Restricted"}):P.includes("Video made for kids")||P.includes("made_for_kids")?s.jsx(Ft,{children:"Made for Kids"}):P.includes("Video restricted in")||P.includes("country_restricted")?s.jsx(Ft,{variant:"secondary",children:"Country Restricted"}):P.includes("Private video")||P.includes("private")?s.jsx(Ft,{variant:"outline",children:"Private Video"}):P.includes("Video not found")||P.includes("deleted")||P.includes("unavailable")?s.jsx(Ft,{variant:"destructive",children:"Video not found (deleted or unavailable)"}):s.jsx(Ft,{children:P||"Unknown"})},j=N=>{if(!N)return"N/A";try{const P=new Date(N);return A3(P,new Date,{addSuffix:!0})}catch{return N}},S=N=>N.deletionReason.includes("Direct Rejected")||N.deletionReason.startsWith("[Direct Rejected]"),_=()=>h!=null&&h.records?d==="direct"?h.records.filter(N=>S(N)):d==="regular"?h.records.filter(N=>!S(N)):h.records:[];return s.jsx("div",{className:"container mx-auto py-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"YouTube URL Records"}),l.length>0&&s.jsxs(Y,{variant:"destructive",onClick:b,disabled:v.isPending,className:"flex items-center gap-2",children:[s.jsx(g3,{className:"h-4 w-4"}),v.isPending?"Deleting...":`Delete Selected (${l.length})`]})]}),s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsx(ye,{placeholder:"Search by name, URL, video ID or reason...",value:r,onChange:N=>i(N.target.value),className:"w-full"})}),s.jsx("div",{className:"w-full md:w-1/4",children:s.jsxs(Nt,{value:a,onValueChange:o,children:[s.jsx(bt,{children:s.jsx(Pt,{placeholder:"Filter by campaign"})}),s.jsxs(wt,{children:[s.jsx(X,{value:"all",children:"All Campaigns"}),m==null?void 0:m.map(N=>s.jsx(X,{value:N.id.toString(),children:N.name},N.id))]})]})}),s.jsx(Y,{onClick:()=>{n(1),g()},children:"Search"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium",children:"Filter by status:"}),s.jsxs("div",{className:"flex border rounded-md overflow-hidden",children:[s.jsx(Y,{type:"button",variant:d==="all"?"default":"outline",className:"rounded-none",onClick:()=>f("all"),children:"All Videos"}),s.jsx(Y,{type:"button",variant:d==="direct"?"default":"outline",className:"rounded-none",onClick:()=>f("direct"),children:"Rejected Videos"})]})]}),p?s.jsx("div",{className:"text-center py-8",children:"Loading records..."}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"rounded-md border",children:s.jsxs(ma,{children:[s.jsx(jV,{children:h!=null&&h.total?`Showing ${_().length} ${d==="direct"?"rejected":d==="regular"?"regular":""} YouTube URL records`:"No YouTube URL records found"}),s.jsx(ga,{children:s.jsxs(Rt,{children:[s.jsx(Ce,{className:"w-[50px]",children:s.jsx(Un,{checked:_().length>0&&l.length===_().length,onCheckedChange:w})}),s.jsx(Ce,{children:"URL Name"}),s.jsx(Ce,{children:"Campaign"}),s.jsx(Ce,{children:"Target URL"}),s.jsx(Ce,{children:"Video ID"}),s.jsx(Ce,{children:"Reason"}),s.jsx(Ce,{children:"Deleted"})]})}),s.jsx(va,{children:_().length>0?_().map(N=>s.jsxs(Rt,{children:[s.jsx(ge,{children:s.jsx(Un,{checked:l.includes(N.id),onCheckedChange:()=>y(N.id)})}),s.jsx(ge,{className:"font-medium",children:N.name}),s.jsx(ge,{children:N.campaignName}),s.jsx(ge,{className:"max-w-[200px] truncate",children:s.jsx("a",{href:N.targetUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:N.targetUrl})}),s.jsx(ge,{children:s.jsx("a",{href:`https://www.youtube.com/watch?v=${N.youtubeVideoId}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:N.youtubeVideoId})}),s.jsx(ge,{children:C(N)}),s.jsx(ge,{children:j(N.deletedAt)})]},N.id)):s.jsx(Rt,{children:s.jsx(ge,{colSpan:7,className:"text-center",children:"No YouTube URL records found"})})})]})}),(h==null?void 0:h.totalPages)>1&&s.jsx(R0,{children:s.jsxs(M0,{children:[s.jsx(Nr,{children:s.jsx(D0,{onClick:()=>n(N=>Math.max(1,N-1)),className:t===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:h.totalPages},(N,P)=>P+1).filter(N=>N===1||N===h.totalPages||N>=t-1&&N<=t+1).map((N,P,O)=>{const T=P>0&&O[P-1]!==N-1;return s.jsxs("div",{className:"flex items-center",children:[T&&s.jsx(Nr,{children:s.jsx("span",{className:"px-2",children:"..."})}),s.jsx(Nr,{children:s.jsx(js,{onClick:()=>n(N),isActive:t===N,className:"cursor-pointer",children:N})})]},N)}),s.jsx(Nr,{children:s.jsx($0,{onClick:()=>n(N=>Math.min(h.totalPages,N+1)),className:t===h.totalPages?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})]})})}function LDe(){const{toast:e}=xn(),[t,n]=x.useState(null),[r,i]=x.useState(null),[a,o]=x.useState(null),[l,c]=x.useState(""),[u,d]=x.useState(null),[f,h]=x.useState(null),{data:p,isLoading:g,isError:m,refetch:v}=Tt({queryKey:["/api/youtube-api-logs"],staleTime:3e4}),b=async P=>{try{await fetch(`/api/youtube-api-logs/${P}`,{method:"DELETE"}),e({title:"Log deleted",description:"The log entry has been deleted successfully."}),Cs.invalidateQueries({queryKey:["/api/youtube-api-logs"]})}catch{e({title:"Error",description:"Failed to delete log entry.",variant:"destructive"})}},y=async()=>{if(window.confirm("Are you sure you want to delete all YouTube API logs? This action cannot be undone."))try{await fetch("/api/youtube-api-logs",{method:"DELETE"}),e({title:"All logs deleted",description:"All YouTube API logs have been deleted successfully."}),Cs.invalidateQueries({queryKey:["/api/youtube-api-logs"]})}catch{e({title:"Error",description:"Failed to delete all logs.",variant:"destructive"})}},w=(p==null?void 0:p.logs.filter(P=>{var O;if(t&&P.logType!==t||r!==null&&P.campaignId!==r||a!==null&&P.isError!==a)return!1;if(l){const T=l.toLowerCase();return P.message.toLowerCase().includes(T)||((O=P.campaignName)==null?void 0:O.toLowerCase().includes(T))||!1||String(P.id).includes(l)||String(P.campaignId).includes(l)}return!0}))||[],C=p!=null&&p.logs?[...new Set(p.logs.map(P=>P.logType))]:[],j=p!=null&&p.logs?[...new Set(p.logs.filter(P=>P.campaignId!==null).map(P=>P.campaignId))]:[],S=()=>{n(null),i(null),o(null),c("")},_=P=>{h(P)},N=async P=>{try{const O=await fetch(`/api/campaigns/${P}/check-youtube`,{method:"POST"});if(!O.ok)throw new Error(`Error: ${O.status}`);const T=await O.json();e({title:"YouTube check triggered",description:T.message||"YouTube API check has been manually triggered."}),setTimeout(()=>{v()},1e3)}catch(O){e({title:"Error",description:`Failed to trigger YouTube API check: ${O instanceof Error?O.message:String(O)}`,variant:"destructive"})}};return s.jsxs("div",{className:"container mx-auto py-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"YouTube API Logs"}),s.jsx("p",{className:"text-muted-foreground",children:"Monitor and track all YouTube API activity and validation checks."})]}),s.jsxs("div",{className:"flex gap-2 mt-4 md:mt-0",children:[s.jsxs(Y,{variant:"outline",onClick:()=>v(),className:"flex items-center gap-1",children:[s.jsx(Zj,{className:"h-4 w-4"}),"Refresh"]}),s.jsxs(Y,{variant:"destructive",onClick:y,className:"flex items-center gap-1",children:[s.jsx(Sn,{className:"h-4 w-4"}),"Clear All"]})]})]}),s.jsxs(qe,{className:"mb-6",children:[s.jsxs(Xe,{className:"pb-3",children:[s.jsxs(Ze,{className:"text-lg flex items-center gap-2",children:[s.jsx(zY,{className:"h-5 w-5"}),"Filter Logs"]}),s.jsx(ft,{children:"Use these filters to narrow down the results."})]}),s.jsx(Ke,{children:s.jsxs("div",{className:"flex flex-col space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Want to see actual YouTube API calls? Select a campaign and force a check."}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(Nt,{value:(u==null?void 0:u.toString())||"select_campaign",onValueChange:P=>d(P==="select_campaign"?null:Number(P)),children:[s.jsx(bt,{className:"w-[180px]",children:s.jsx(Pt,{placeholder:"Select Campaign"})}),s.jsx(wt,{children:s.jsxs(Wm,{children:[s.jsx(Vf,{children:"Force Check Campaign"}),s.jsx(X,{value:"select_campaign",children:"Select Campaign"}),j.map(P=>P===null?null:s.jsxs(X,{value:P.toString(),children:["Campaign ",P]},P))]})})]}),s.jsxs(Y,{onClick:()=>{u?N(u):e({title:"Campaign required",description:"Please select a campaign first",variant:"destructive"})},className:"flex items-center gap-1",disabled:!u,children:[s.jsx(Ik,{className:"h-4 w-4"}),"Force Check"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx("div",{children:s.jsxs(Nt,{value:t||"all_types",onValueChange:P=>n(P==="all_types"?null:P),children:[s.jsx(bt,{children:s.jsx(Pt,{placeholder:"Log Type"})}),s.jsx(wt,{children:s.jsxs(Wm,{children:[s.jsx(Vf,{children:"Log Type"}),s.jsx(X,{value:"all_types",children:"All Types"}),C.map(P=>s.jsx(X,{value:P,children:P},P))]})})]})}),s.jsx("div",{children:s.jsxs(Nt,{value:(r==null?void 0:r.toString())||"all_campaigns",onValueChange:P=>i(P==="all_campaigns"?null:Number(P)),children:[s.jsx(bt,{children:s.jsx(Pt,{placeholder:"Campaign ID"})}),s.jsx(wt,{children:s.jsxs(Wm,{children:[s.jsx(Vf,{children:"Campaign ID"}),s.jsx(X,{value:"all_campaigns",children:"All Campaigns"}),j.map(P=>P===null?null:s.jsx(X,{value:P.toString(),children:P},P))]})})]})}),s.jsx("div",{children:s.jsxs(Nt,{value:a===null?"all_statuses":a?"true":"false",onValueChange:P=>{o(P==="all_statuses"?null:P==="true")},children:[s.jsx(bt,{children:s.jsx(Pt,{placeholder:"Error Status"})}),s.jsx(wt,{children:s.jsxs(Wm,{children:[s.jsx(Vf,{children:"Error Status"}),s.jsx(X,{value:"all_statuses",children:"All Statuses"}),s.jsx(X,{value:"true",children:"Errors Only"}),s.jsx(X,{value:"false",children:"Success Only"})]})})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ye,{placeholder:"Search logs...",value:l,onChange:P=>c(P.target.value),className:"flex-1"}),s.jsx(Y,{variant:"ghost",size:"icon",onClick:S,title:"Reset filters",children:s.jsx(Zj,{className:"h-4 w-4"})})]})]})]})})]}),s.jsx(qe,{children:s.jsx(Ke,{className:"p-0",children:g?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx(We,{className:"h-8 w-8 animate-spin text-primary"})}):m?s.jsxs("div",{className:"flex justify-center items-center h-64 text-destructive",children:[s.jsx(Ul,{className:"h-8 w-8 mr-2"}),s.jsx("p",{children:"Failed to load YouTube API logs. Please try again."})]}):w.length===0?s.jsxs("div",{className:"flex flex-col justify-center items-center h-64 text-muted-foreground",children:[s.jsx(Ik,{className:"h-12 w-12 mb-4"}),s.jsx("p",{children:"No YouTube API logs found matching your filters."}),s.jsx(Y,{variant:"link",onClick:S,className:"mt-2",children:"Reset Filters"})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs(ma,{children:[s.jsx(ga,{children:s.jsxs(Rt,{children:[s.jsx(Ce,{className:"w-[80px]",children:"ID"}),s.jsx(Ce,{className:"w-[120px]",children:"Type"}),s.jsx(Ce,{className:"w-[100px]",children:"Campaign"}),s.jsx(Ce,{children:"Message"}),s.jsx(Ce,{className:"w-[150px]",children:"Timestamp"}),s.jsx(Ce,{className:"w-[100px]",children:"Status"}),s.jsx(Ce,{className:"w-[100px] text-right",children:"Actions"})]})}),s.jsx(va,{children:w.map(P=>s.jsxs(Rt,{children:[s.jsx(ge,{className:"font-mono",children:P.id}),s.jsx(ge,{children:s.jsx(Ft,{variant:"outline",children:P.logType})}),s.jsx(ge,{children:P.campaignId?s.jsx(Ft,{variant:"secondary",children:P.campaignId}):s.jsx("span",{className:"text-muted-foreground text-sm",children:"System"})}),s.jsx(ge,{className:"max-w-[300px] truncate",children:P.message}),s.jsx(ge,{className:"whitespace-nowrap",children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(f3,{className:"h-3 w-3 text-muted-foreground"}),s.jsx("span",{title:new Date(P.timestamp).toLocaleString(),children:R3(new Date(P.timestamp),{addSuffix:!0})})]})}),s.jsx(ge,{children:P.isError?s.jsxs(Ft,{variant:"destructive",className:"flex items-center gap-1",children:[s.jsx(Ul,{className:"h-3 w-3"}),"Error"]}):s.jsxs(Ft,{variant:"success",className:"flex items-center gap-1 bg-green-100 text-green-800 hover:bg-green-200",children:[s.jsx(Dk,{className:"h-3 w-3"}),"Success"]})}),s.jsx(ge,{className:"text-right",children:s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsxs(ti,{children:[s.jsx(sN,{asChild:!0,children:s.jsx(Y,{variant:"ghost",size:"sm",onClick:()=>_(P),children:"View"})}),s.jsxs(Dr,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[s.jsxs(Ji,{children:[s.jsx(ea,{children:"YouTube API Log Details"}),s.jsx(Do,{children:"Detailed information about this API log entry."})]}),f&&s.jsxs("div",{className:"mt-4 space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:"Log ID"}),s.jsx("p",{className:"text-md",children:f.id})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:"Log Type"}),s.jsx("p",{className:"text-md",children:f.logType})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:"Campaign ID"}),s.jsx("p",{className:"text-md",children:f.campaignId||"N/A"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:"Campaign Name"}),s.jsx("p",{className:"text-md",children:f.campaignName||"N/A"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:"Status"}),s.jsx("p",{className:"text-md",children:f.isError?s.jsxs(Ft,{variant:"destructive",className:"flex items-center gap-1",children:[s.jsx(Ul,{className:"h-3 w-3"}),"Error"]}):s.jsxs(Ft,{variant:"success",className:"flex items-center gap-1 bg-green-100 text-green-800 hover:bg-green-200",children:[s.jsx(Dk,{className:"h-3 w-3"}),"Success"]})})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:"Timestamp"}),s.jsx("p",{className:"text-md",children:new Date(f.timestamp).toLocaleString()})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:"Message"}),s.jsx("p",{className:"text-md mt-1",children:f.message})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-semibold",children:"Details"}),f.details?s.jsx("pre",{className:"bg-muted p-4 rounded-md mt-1 overflow-auto max-h-[300px] text-sm",children:JSON.stringify(f.details,null,2)}):s.jsx("p",{className:"text-md mt-1 text-muted-foreground",children:"No details available"})]}),s.jsx("div",{className:"flex justify-between",children:s.jsxs(Y,{variant:"outline",size:"sm",onClick:()=>b(f.id),children:[s.jsx(Sn,{className:"h-4 w-4 mr-2"}),"Delete this log"]})})]})]})]}),s.jsx(Y,{variant:"ghost",size:"sm",onClick:()=>b(P.id),children:s.jsx(Sn,{className:"h-4 w-4"})})]})})]},P.id))})]})})})})]})}function FDe(){var d;const[e,t]=x.useState(""),[n,r]=x.useState(!1),[i,a]=x.useState(null),[o,l]=x.useState(null),c=async()=>{if(!e){l("Campaign ID is required");return}try{r(!0),l(null),console.log(`Testing reports API for campaign ID: ${e}`);const f=await fetch("/api/test-reports-api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:parseInt(e)})});if(!f.ok)throw new Error(`API request failed with status ${f.status}`);const h=await f.json();a(h),console.log("Reports API test result:",h)}catch(f){console.error("Error testing reports API:",f),l((f==null?void 0:f.message)||"An error occurred during the API test"),a(null)}finally{r(!1)}},u=f=>JSON.stringify(f,null,2);return s.jsxs(qe,{className:"w-full",children:[s.jsxs(Xe,{children:[s.jsx(Ze,{children:"TrafficStar Reports API Tester"}),s.jsx(ft,{children:"Test the spent value reports API with proper date formatting"})]}),s.jsx(Ke,{children:s.jsxs("div",{className:"grid w-full items-center gap-4",children:[s.jsxs("div",{className:"flex flex-col space-y-1.5",children:[s.jsx(un,{htmlFor:"campaign-id",children:"Campaign ID"}),s.jsx(ye,{id:"campaign-id",placeholder:"Enter TrafficStar campaign ID",value:e,onChange:f=>t(f.target.value)})]}),s.jsx(Y,{onClick:c,disabled:n||!e,children:n?"Testing...":"Test Reports API"}),o&&s.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md text-red-700",children:o}),i&&s.jsxs("div",{className:"mt-4",children:[s.jsx("h3",{className:"text-lg font-medium mb-2",children:"Results:"}),s.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md mb-3",children:[s.jsx("strong",{children:"Date:"})," ",i.date,s.jsx("br",{}),s.jsx("strong",{children:"Extracted Spent Value:"})," $",((d=i.extractedSpent)==null?void 0:d.toFixed(4))||"0.0000"]}),s.jsx("div",{className:"bg-slate-50 p-3 rounded-md overflow-auto max-h-60",children:s.jsx("pre",{className:"text-xs",children:u(i.rawResponse)})})]})]})})]})}function UDe(){return s.jsxs("div",{className:"container mx-auto py-8",children:[s.jsx("h1",{className:"text-2xl font-bold mb-6",children:"API Testing Tools"}),s.jsx("div",{className:"grid grid-cols-1 gap-8",children:s.jsx(FDe,{})})]})}function BDe(){const[e,t]=x.useState(""),[n,r]=x.useState(null),[i,a]=x.useState(!1),{verifyApiKey:o,isAuthenticated:l}=qx(),[,c]=Ir();x.useEffect(()=>{l&&c("/")},[l,c]);const u=async d=>{d.preventDefault(),r(null),a(!0);try{await o(e),c("/")}catch{r("Invalid API key. Please try again.")}finally{a(!1)}};return s.jsx("div",{className:"flex items-center justify-center min-h-screen bg-slate-50 p-4",children:s.jsxs(qe,{className:"w-full max-w-md p-6",children:[s.jsxs("div",{className:"mb-6 text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"URL Campaign Manager"}),s.jsx("p",{className:"text-gray-500",children:"Enter your secret API key to continue"})]}),n&&s.jsxs(yc,{variant:"destructive",className:"mb-4",children:[s.jsx(Ad,{className:"h-4 w-4 mr-2"}),s.jsx(xc,{children:n})]}),s.jsx("form",{onSubmit:u,children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"space-y-2",children:s.jsx(ye,{id:"apiKey",type:"password",value:e,onChange:d=>t(d.target.value),placeholder:"Enter API key",required:!0,className:"w-full",autoFocus:!0})}),s.jsx(Y,{type:"submit",className:"w-full",disabled:i,children:i?"Verifying...":"Login"})]})})]})})}function VDe(){Ir();const[e,t]=x.useState(!1),{logout:n}=qx(),[,r]=Ir(),i=()=>{t(!e)},a=()=>s.jsx("div",{className:"w-full border-b bg-white",children:s.jsxs("div",{className:"py-4 px-4 flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(KY,{className:"inline-block align-middle mr-2"}),s.jsx("span",{className:"font-bold text-lg align-middle",children:"URL Redirector"})]}),s.jsx("button",{onClick:i,className:"p-2 focus:outline-none",children:s.jsx(ZY,{className:"h-6 w-6"})})]})}),[o,l]=x.useState(!1),c=x.useRef(null);x.useEffect(()=>{if(e&&c.current){const p=()=>{if(!c.current)return;const g=c.current.clientHeight,m=c.current.scrollHeight;l(m>g)};return p(),setTimeout(p,100),window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)}},[e]);const u=()=>{c.current&&c.current.scrollBy({top:-200,behavior:"auto"})},d=()=>{c.current&&c.current.scrollBy({top:200,behavior:"auto"})},f=()=>s.jsxs("div",{className:`absolute top-[60px] left-0 right-0 bg-white z-50 shadow-md transition-all duration-300 ${e?"opacity-100":"opacity-0 pointer-events-none"}`,children:[o&&s.jsx("div",{className:"sticky top-0 w-full bg-white py-2 border-b text-center cursor-pointer z-10 shadow-sm hover:bg-gray-100 transition-colors",onClick:u,children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"inline-block text-primary",children:s.jsx("polyline",{points:"18 15 12 9 6 15"})}),s.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"Scroll up"})]})}),s.jsxs("div",{ref:c,className:"py-2 px-4 max-h-[70vh] overflow-y-auto",children:[s.jsx(Pn,{href:"/campaigns",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",stroke:"currentColor",strokeWidth:"2"}),s.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",stroke:"currentColor",strokeWidth:"2"}),s.jsx("rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",stroke:"currentColor",strokeWidth:"2"}),s.jsx("rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",stroke:"currentColor",strokeWidth:"2"})]}),s.jsx("span",{className:"font-medium",children:"Campaigns"})]})}),s.jsx(Pn,{href:"/urls",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),s.jsx("span",{className:"font-medium",children:"URL History"})]})}),s.jsx(Pn,{href:"/gmail-settings",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M22 6l-10 7L2 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),s.jsx("span",{className:"font-medium",children:"Gmail Settings"})]})}),s.jsx(Pn,{href:"/system-settings",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),s.jsx("span",{className:"font-medium",children:"System Settings"})]})}),s.jsx(Pn,{href:"/trafficstar",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M12 3v3m0 15v-3M9 12H3m18 0h-3M5.636 5.636l2.12 2.12m8.486 8.486l2.12 2.12M5.636 18.364l2.12-2.12m8.486-8.486l2.12-2.12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),s.jsx("circle",{cx:"12",cy:"12",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),s.jsx("span",{className:"font-medium",children:"TrafficStar API"})]})}),s.jsx(Pn,{href:"/original-url-records",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M21 16V8.00002C20.9996 7.6493 20.9071 7.30483 20.7315 7.00119C20.556 6.69754 20.3037 6.44539 20 6.27002L13 2.27002C12.696 2.09449 12.3511 2.00208 12 2.00208C11.6489 2.00208 11.304 2.09449 11 2.27002L4 6.27002C3.69626 6.44539 3.44398 6.69754 3.26846 7.00119C3.09294 7.30483 3.00036 7.6493 3 8.00002V16C3.00036 16.3508 3.09294 16.6952 3.26846 16.9989C3.44398 17.3025 3.69626 17.5547 4 17.73L11 21.73C11.304 21.9056 11.6489 21.998 12 21.998C12.3511 21.998 12.696 21.9056 13 21.73L20 17.73C20.3037 17.5547 20.556 17.3025 20.7315 16.9989C20.9071 16.6952 20.9996 16.3508 21 16Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M3.27002 6.96002L12 12.01L20.73 6.96002",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M12 22.08V12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),s.jsx("span",{className:"font-medium",children:"Original Click Values"})]})}),s.jsx(Pn,{href:"/campaign-click-records",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M3 12h18M3 6h18M3 18h18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("circle",{cx:"19",cy:"6",r:"3",fill:"currentColor"})]}),s.jsx("span",{className:"font-medium",children:"Campaign Click Records"})]})}),s.jsx(Pn,{href:"/url-click-records",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),s.jsx("span",{className:"font-medium",children:"URL Click Records"})]})}),s.jsx(Pn,{href:"/url-budget-logs",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M12 8c-2.68 0-4.83.58-6.04 1.5C4.73 10.42 4 11.53 4 12.5s.73 2.08 1.96 3c1.21.92 3.36 1.5 6.04 1.5 2.68 0 4.83-.58 6.04-1.5 1.23-.92 1.96-2.03 1.96-3s-.73-2.08-1.96-3C16.83 8.58 14.68 8 12 8z",stroke:"currentColor",strokeWidth:"2"}),s.jsx("path",{d:"M4 12.5v5c0 .97.73 2.08 1.96 3 1.21.92 3.36 1.5 6.04 1.5 2.68 0 4.83-.58 6.04-1.5 1.23-.92 1.96-2.03 1.96-3v-5",stroke:"currentColor",strokeWidth:"2"})]}),s.jsx("span",{className:"font-medium",children:"URL Budget Logs"})]})}),s.jsx(Pn,{href:"/youtube-url-records",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z",stroke:"currentColor",strokeWidth:"2"}),s.jsx("polygon",{points:"9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02",fill:"currentColor"})]}),s.jsx("span",{className:"font-medium",children:"YouTube URL Records"})]})}),s.jsx(Pn,{href:"/youtube-api-logs",className:"block py-3 border-b",onClick:()=>t(!1),children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("line",{x1:"12",y1:"12",x2:"16",y2:"12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),s.jsx("span",{className:"font-medium",children:"YouTube API Logs"})]})}),s.jsx("div",{className:"block py-3 border-b text-gray-400 cursor-not-allowed",children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),s.jsx("path",{d:"M12 8v4M12 16h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),s.jsx("span",{className:"font-medium",children:"Help & Support"})]})}),s.jsx("button",{className:"block w-full py-3 border-b text-red-600 hover:bg-red-50 transition-colors",onClick:()=>{n().then(()=>{t(!1),r("/login")})},children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(QY,{className:"w-5 h-5 mr-3"}),s.jsx("span",{className:"font-medium",children:"Logout"})]})})]}),o&&s.jsx("div",{className:"sticky bottom-0 w-full bg-white py-2 border-t text-center cursor-pointer z-10 shadow-sm hover:bg-gray-100 transition-colors",onClick:d,children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"inline-block text-primary",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})}),s.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"Scroll down"})]})})]}),h=()=>s.jsx("div",{className:`fixed inset-0 bg-black transition-opacity duration-300 ${e?"opacity-30":"opacity-0 pointer-events-none"}`,onClick:()=>t(!1)});return x.useEffect(()=>(e?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[e]),s.jsx(s.Fragment,{children:s.jsxs("div",{className:"w-full relative",children:[s.jsx(a,{}),s.jsx(f,{}),s.jsx(h,{})]})})}function zDe({children:e}){return s.jsxs("div",{className:"min-h-screen flex flex-col",children:[s.jsx(VDe,{}),s.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto",children:e})]})}function WDe({size:e="md",className:t}){const n={sm:"h-4 w-4 border-2",md:"h-6 w-6 border-2",lg:"h-10 w-10 border-3"};return s.jsx("div",{className:fe("animate-spin rounded-full border-solid border-primary border-t-transparent",n[e],t)})}function HDe({children:e}){const{isAuthenticated:t,isLoading:n}=qx(),[,r]=Ir();return x.useEffect(()=>{!n&&!t&&r("/login")},[n,t,r]),n?s.jsxs("div",{className:"flex items-center justify-center h-screen",children:[s.jsx(WDe,{size:"lg"}),s.jsx("span",{className:"ml-2 text-lg",children:"Loading..."})]}):t?s.jsx(s.Fragment,{children:e}):null}function qDe(){const[e]=Ir(),t=jc();return e.startsWith("/r/")||e.startsWith("/views/")||e.startsWith("/c/")?s.jsxs(pb,{children:[s.jsx(tn,{path:"/r/:campaignId/:urlId",component:Hm}),s.jsx(tn,{path:"/r/bridge/:campaignId/:urlId",component:Hm}),s.jsx(tn,{path:"/views/:customPath",component:Hm}),s.jsx(tn,{path:"/c/:campaignId",component:Hm})]}):e==="/login"?s.jsx(pb,{children:s.jsx(tn,{path:"/login",component:BDe})}):s.jsx(HDe,{children:s.jsx(zDe,{children:s.jsxs(pb,{children:[s.jsx(tn,{path:"/",children:s.jsx(dG,{to:"/campaigns"})}),s.jsx(tn,{path:"/campaigns/:id",children:s.jsx(Rse,{})}),s.jsx(tn,{path:"/campaigns",children:s.jsx(toe,{})}),s.jsx(tn,{path:"/urls",children:t?s.jsx(aoe,{}):s.jsx(roe,{})}),s.jsx(tn,{path:"/gmail-settings",children:s.jsx(coe,{})}),s.jsx(tn,{path:"/system-settings",children:s.jsx(CRe,{})}),s.jsx(tn,{path:"/trafficstar",children:s.jsx(kRe,{})}),s.jsx(tn,{path:"/redirect-test",children:s.jsx(soe,{})}),s.jsx(tn,{path:"/test-spent-value",children:s.jsx(IRe,{})}),s.jsx(tn,{path:"/original-url-records",children:s.jsx(FRe,{})}),s.jsx(tn,{path:"/campaign-click-records",children:s.jsx(E2e,{})}),s.jsx(tn,{path:"/campaign-click-detail/:id",children:s.jsx(O2e,{})}),s.jsx(tn,{path:"/url-click-records",children:s.jsx(MDe,{})}),s.jsx(tn,{path:"/detailed-url-record/:urlId",children:s.jsx(DDe,{})}),s.jsx(tn,{path:"/url-budget-logs",children:s.jsx($De,{})}),s.jsx(tn,{path:"/youtube-url-records",children:s.jsx(IDe,{})}),s.jsx(tn,{path:"/youtube-api-logs",children:s.jsx(LDe,{})}),s.jsx(tn,{path:"/api-tester",children:s.jsx(UDe,{})}),s.jsx(tn,{children:s.jsx(bZ,{})})]})})})}function KDe(){return s.jsx(OG,{client:Cs,children:s.jsxs(hoe,{children:[s.jsx(qDe,{}),s.jsx(xZ,{})]})})}const GDe=document.getElementById("root"),YDe=f4(GDe);YDe.render(s.jsx(x.StrictMode,{children:s.jsx(KDe,{})}));
/var/www/UrlCampaignTracker/dist/index.js:            console.log(`Created URL budget logs directory at ${this.logDirectory}`);
/var/www/UrlCampaignTracker/dist/index.js:            console.error(`Failed to create URL budget logs directory: ${error}`);
/var/www/UrlCampaignTracker/dist/index.js:       * Clear URL budget logs for a specific campaign and reset its tracking set
/var/www/UrlCampaignTracker/dist/index.js:          console.log(`\u{1F9F9} Cleared URL budget logs for campaign ${campaignId} - spent value dropped below threshold`);
/var/www/UrlCampaignTracker/dist/index.js:          console.error(`\u274C Failed to clear URL budget logs for campaign ${campaignId}: ${error}`);
/var/www/UrlCampaignTracker/dist/index.js:       * Get all URL budget logs for a specific campaign
/var/www/UrlCampaignTracker/dist/index.js:          console.error(`\u274C Failed to get URL budget logs for campaign ${campaignId}: ${error}`);
/var/www/UrlCampaignTracker/dist/index.js:       * Get all URL budget logs across all campaigns
/var/www/UrlCampaignTracker/dist/index.js:          console.error(`\u274C Failed to get all URL budget logs: ${error}`);
/var/www/UrlCampaignTracker/dist/index.js:        - ${urlBudgetLogsCount} URL budget logs
/var/www/UrlCampaignTracker/dist/index.js:        console.log(`\u2705 SYSTEM RESET: Deleted all URL budget logs (${urlBudgetLogsCount} records)`);
/var/www/UrlCampaignTracker/dist/index.js:    console.log(`\u{1F9F9} Cleared previous URL budget logs for clean test`);
/var/www/UrlCampaignTracker/dist/index.js:      message: "Successfully cleared URL budget logs",
/var/www/UrlCampaignTracker/dist/index.js:    console.error(`\u274C Error clearing URL budget logs: ${error}`);
/var/www/UrlCampaignTracker/dist/index.js:    console.error(`\u274C Error getting URL budget logs: ${error}`);
/var/www/UrlCampaignTracker/dist/index.js:      console.log("Fetching URL budget logs for all campaigns with TrafficStar integration");
/var/www/UrlCampaignTracker/dist/index.js:      console.error("Error fetching URL budget logs:", error);
/var/www/UrlCampaignTracker/dist/index.js:        error: "Failed to fetch URL budget logs"
/var/www/UrlCampaignTracker/dist/index.js:      console.log(`Fetching URL budget logs for campaign ${campaignId}`);
/var/www/UrlCampaignTracker/dist/index.js:      console.error(`Error fetching URL budget logs for campaign ${req.params.campaignId}:`, error);
/var/www/UrlCampaignTracker/dist/index.js:        error: "Failed to fetch URL budget logs for campaign"
/var/www/UrlCampaignTracker/dist/index.js:      console.log("Clearing all URL budget logs");
/var/www/UrlCampaignTracker/dist/index.js:        message: "All URL budget logs cleared successfully"
/var/www/UrlCampaignTracker/dist/index.js:      console.error("Error clearing URL budget logs:", error);
/var/www/UrlCampaignTracker/dist/index.js:        error: "Failed to clear URL budget logs"
/var/www/UrlCampaignTracker/dist/index.js:      console.log(`Clearing URL budget logs for campaign ${campaignId}`);
/var/www/UrlCampaignTracker/dist/index.js:        message: `URL budget logs for campaign ${campaignId} cleared successfully`
/var/www/UrlCampaignTracker/dist/index.js:      console.error(`Error clearing URL budget logs for campaign ${req.params.campaignId}:`, error);
/var/www/UrlCampaignTracker/dist/index.js:        error: "Failed to clear URL budget logs for campaign"
/var/www/UrlCampaignTracker/test-comprehensive-url-budget.js:// Function to clear all URL budget logs when spent value drops below threshold
/var/www/UrlCampaignTracker/test-comprehensive-url-budget.js:  console.log(`🧹 Cleared all URL budget logs and reset tracking - spent value dropped below threshold`);
/var/www/UrlCampaignTracker/test-trafficstar-cumulative-budget.cjs:// Clear URL budget logs
/var/www/UrlCampaignTracker/test-trafficstar-cumulative-budget.cjs:  console.log('🧹 Cleared all URL budget logs and reset tracking - spent value dropped below threshold');
/var/www/UrlCampaignTracker/test-trafficstar-budget-update.js:// Function to clear all URL budget logs when spent value drops below threshold
/var/www/UrlCampaignTracker/test-trafficstar-budget-update.js:  console.log(`🧹 Cleared all URL budget logs and reset tracking - spent value dropped below threshold`);
root@d026e9724:~# ^C
root@d026e9724:~#
